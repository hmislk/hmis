<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/admin/pricing/index.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="subcontent">
        <h:panelGroup>
            <h:form>
                <p:growl />

                <p:panel header="Add Investigation to Package" styleClass="panel-margin">

                    <div class="row">
                        <div class="col-5">
                            <p:panel header="Packages">
                                <p:selectOneListbox id="lstSelect" value="#{packageItemController.currentPackege}" scrollHeight="500" filter="true">
                                    <f:selectItems value="#{packageNameController.withoutInativeItems}" var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                    <f:ajax render="gpDetail packageItem dig" execute="lstSelect" />
                                </p:selectOneListbox>
                            </p:panel>

                        </div>
                        <div class="col-7">
                            <p:panelGrid columns="2" layout="tabular" class="w-100">
                                <f:facet name="header">
                                    <div class="d-flex gap-2 justify-content-end">


                                        <p:spacer width="20"/>
                                        <p:commandButton 
                                            id="btnadd"
                                            value="Add New Item" 
                                            action="#{packageItemController.addToPackage()}" 
                                            class="ui-button-success"
                                            icon="fas fa-plus" 
                                            ajax="false">
                                        </p:commandButton>
                                    </div>
                                </f:facet>
                                <p:outputLabel value="Item to add" ></p:outputLabel>
                                <p:autoComplete
                                    value="#{packageItemController.currentItem}"
                                    completeMethod="#{itemController.completeServicesPlusInvestigationsAll}"
                                    var="addingItem"
                                    class="w-100"
                                    inputStyleClass="w-100"
                                    itemLabel="#{addingItem.name}"
                                    itemValue="#{addingItem}"
                                    >
                                    <p:column headerText="Code" >
                                        #{addingItem.code}
                                    </p:column>
                                    <p:column headerText="Item" >
                                        #{addingItem.name}
                                    </p:column>
                                    <p:column headerText="Category" >
                                        #{addingItem.category.name}
                                    </p:column>
                                    <p:column headerText="Parent Category" >
                                        #{addingItem.category.parentCategory.name}
                                    </p:column>
                                    <p:column headerText="Department" >
                                        #{addingItem.department.name}
                                    </p:column>
                                </p:autoComplete>


                                <h:outputText value="Remove the Item at the Time of Billing" class="mt-1" ></h:outputText>
                                <p:selectBooleanButton 
                                    id="editrd" 
                                    onLabel="Yes" 
                                    offLabel="No"
                                    class="w=100"
                                    onIcon="pi pi-check" 
                                    offIcon="pi pi-times" 
                                    value="#{packageItemController.canRemovePackageItemfromPackage}" 
                                    >
                                </p:selectBooleanButton>


                                <h:outputText value="Institution" class="mt-2"/>
                                <p:selectOneMenu id="cmbInstitution" value="#{packageItemController.institution}" class="w-100">
                                    <f:selectItem itemLabel="Please select an Institution"/>
                                    <f:selectItems value="#{institutionController.companies}" var="ins" itemLabel="#{ins.name}" itemValue="#{ins}" />
                                    <f:ajax execute="cmbInstitution" render="cmbDepartment" event="change"/> 
                                </p:selectOneMenu>

                                <h:outputText value="Department"/>
                                <p:selectOneMenu id="cmbDepartment" value="#{packageItemController.department}" class="w-100">
                                    <f:selectItem itemLabel="Please select an Department"/>
                                    <f:selectItems value="#{departmentController.getInsDepartments(packageItemController.institution)}" var="dep" itemLabel="#{dep.name}" itemValue="#{dep}" />
                                </p:selectOneMenu>

                            </p:panelGrid>
                        </div>
                    </div>   

                    <div class="row">
                        <div class="col-12">
                            <p:panel >
                                <f:facet name="header">
                                    <div class="d-flex justify-content-between">
                                        <h:outputText id="lblName" value="Package Items" class="mt-2" ></h:outputText>
                                        <div class="d-flex gap-2">
                                            <p:commandButton 
                                                value="To Add New Item" 
                                                type="button" 
                                                actionListener="#{packageItemController.clearValus()}"
                                                icon="fa fa-plus" 
                                                onclick="PF('dlg3').show()"/>

                                            <p:commandButton 
                                                value="To Edit Item"
                                                actionListener="#{packageItemController.clearValus()}"
                                                class="ui-button-warning" 
                                                rendered="false"
                                                icon="fas fa-pencil"  
                                                onclick="PF('dlg1').show()">
                                            </p:commandButton>

                                            <p:commandButton 
                                                value="Remove" 
                                                action="#{packageItemController.removeFromPackage()}" 
                                                class="ui-button-danger" 
                                                icon="fas fa-trash"  
                                                ajax="false">
                                            </p:commandButton>
                                        </div>

                                    </div>
                                </f:facet>

                                <p:dataTable 
                                    id="packageItem" 
                                    selection="#{packageItemController.current}"
                                    value="#{packageItemController.items}" 
                                    var="i" 
                                    rowKey="#{i.id}"
                                    selectionMode="single"
                                    >
                                    <p:ajax process="@this" update=":#{p:resolveFirstComponentWithId('digEdit',view).clientId}" event="rowSelect"/>
                                    <p:column headerText="Item">
                                        <h:outputText value="#{i.item.name}"/>
                                    </p:column>
                                    <p:column headerText="Department">
                                        <h:outputText value="#{i.department.name}"/>
                                    </p:column>
                                    <p:column headerText="Status" >
                                        <p:badge 
                                            value="#{i.item.canRemoveItemfromPackage?'Can Remove Item':'Can not Remove Item'}" 
                                            severity="#{i.item.canRemoveItemfromPackage?'success':'warning'}"
                                            >
                                        </p:badge>
                                    </p:column>     
                                </p:dataTable>
                            </p:panel>
                        </div>
                    </div>

                    <p:dialog rendered="false" header="Edit #{packageItemController.current.item} Item" modal="true" widgetVar="dlg1" id="digEdit" minHeight="400" width="800" showEffect="fade" focus="btnEdit" closeOnEscape="true">

                        <div class="row">
                            <div class="col-5">
                                <h:outputText value="Item" style="font-size: 16px; font-weight: 600;"></h:outputText>
                            </div>
                            <div class="col-7">
                                <p:inputText 
                                    autocomplete="off"
                                    class="w-100"
                                    style="font-size: 16px; font-weight: 600;"
                                    disabled="true"
                                    value="#{packageItemController.current.item.name}">
                                </p:inputText>
                            </div>
                        </div>

                        <div class="row mt-2">
                            <div class="col-5">
                                <h:outputText 
                                    value="Remove the Item at the Time of Billing" 
                                    class="mt-2" 
                                    style="font-size: 16px; font-weight: 600;">

                                </h:outputText>
                            </div>

                            <div class="col-7">
                                <p:selectBooleanButton 
                                    onLabel="Yes" 
                                    offLabel="No"
                                    class=""
                                    onIcon="pi pi-check" 
                                    offIcon="pi pi-times" 
                                    value="#{packageItemController.current.item.canRemoveItemfromPackage}" 
                                    style="width:6rem" >
                                </p:selectBooleanButton>
                            </div>
                        </div>

                        #{packageItemController.current.item.canRemoveItemfromPackage}

                        <f:facet name="footer">
                            <p:commandButton 
                                id="btnEdit"
                                value="Edit" 
                                action="#{packageItemController.EditPackageItem()}" 
                                style="width:150px;"
                                class="ui-button-success"
                                icon="fas fa-plus" 
                                ajax="false">
                            </p:commandButton>
                        </f:facet>
                    </p:dialog>

                    <p:dialog header="Add Item for #{packageItemController.currentPackege.name} Package" modal="true" widgetVar="dlg3" id="dig" minHeight="500" width="1600" showEffect="fade" focus="btnadd" closeOnEscape="true">

                    </p:dialog>

                </p:panel>
            </h:form>
        </h:panelGroup>
    </ui:define>
</ui:composition>
