<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:body>

        <ui:composition template="/admin/users/user_list.xhtml">

            <ui:define name="users"> 
                <f:view>
                    <p:panel >
                        <f:facet name="header" >
                            <i class="fa fa-user-cog"></i>
                            <h:outputLabel class="mx-2 mt-2" value="Manage User"/>
                            <p:commandButton 
                                ajax="false" value="Save" style="float: right;" 
                                action="#{webUserController.saveUser()}" 
                                icon="fa fa-save"
                                class="ui-button-warning">
                            </p:commandButton>
                        </f:facet>

                        <h:panelGrid columns="3">

                            <p:outputLabel value="User Name " style="width: 100px;" for="name" class="mb-2" />
                            <p:outputLabel value=":" style="width: 20px;" class="mb-2"/>
                            <p:outputLabel  id="name" value="#{webUserController.current.name}" class="mb-2 form-control" style="width: 300px;"/>

                            <p:outputLabel value="Staff " style="width: 100px;" for="staff" />
                            <p:outputLabel value=":" style="width: 20px;"/>
                            <p:autoComplete  forceSelection="true" id="staff"
                                             value="#{webUserController.current.staff}" 
                                             completeMethod="#{staffController.completeStaff}" 
                                             var="mys" class="w-100" inputStyleClass="w-100"
                                             itemLabel="#{mys.person.nameWithTitle}" 
                                             itemValue="#{mys}"
                                             >
                            </p:autoComplete>

                            <!-- Institution Row -->
                            <p:outputLabel value="Institution" style="width: 100px;" for="institution" />
                            <p:outputLabel value=":" style="width: 20px;" />
                            <p:selectOneMenu id="institution"
                                             value="#{webUserController.current.institution}"
                                             style="width: 300px;" filter="true">
                                <f:selectItem itemLabel="Select Institution" />
                                <f:selectItems value="#{institutionController.companies}" var="ins"
                                               itemLabel="#{ins.name}" itemValue="#{ins}" />
                                <p:ajax update="site departmentBlock" process="@this" />
                            </p:selectOneMenu>

                            <!-- Site Row -->
                            <p:outputLabel value="Site" style="width: 100px;" for="site" />
                            <p:outputLabel value=":" style="width: 20px;" />
                            <p:selectOneMenu id="site"
                                             value="#{webUserController.current.site}"
                                             style="width: 300px;" filter="true">
                                <f:selectItem itemLabel="Select Site" />
                                <f:selectItems value="#{institutionController.sites}" var="s"
                                               itemLabel="#{s.name}" itemValue="#{s}" />
                                <p:ajax update="departmentBlock" process="@this" />
                            </p:selectOneMenu>

                            <!-- Department Row (Rendered Depending on Institution and Site) -->
                            <p:outputLabel value="Department" style="width: 100px;" />
                            <p:outputLabel value=":" style="width: 20px;" />
                            <h:panelGroup id="departmentBlock">

                                <p:selectOneMenu rendered="#{webUserController.current.institution eq null and webUserController.current.site eq null}"
                                                 value="#{webUserController.current.department}"
                                                 style="width: 300px;" filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="Select Department" />
                                    <f:selectItems value="#{departmentController.getDepartmentsOfInstitutionAndSite()}" var="d"
                                                   itemLabel="#{d.name}" itemValue="#{d}" />
                                </p:selectOneMenu>

                                <p:selectOneMenu rendered="#{webUserController.current.institution eq null and webUserController.current.site ne null}"
                                                 value="#{webUserController.current.department}"
                                                 style="width: 300px;" filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="Select Department" />
                                    <f:selectItems value="#{departmentController.getDepartmentsOfInstitutionAndSite(webUserController.current.site)}" var="d"
                                                   itemLabel="#{d.name}" itemValue="#{d}" />
                                </p:selectOneMenu>

                                <p:selectOneMenu rendered="#{webUserController.current.institution ne null and webUserController.current.site eq null}"
                                                 value="#{webUserController.current.department}"
                                                 style="width: 300px;" filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="Select Department" />
                                    <f:selectItems value="#{departmentController.getDepartmentsOfInstitutionAndSiteForInstitution(webUserController.current.institution)}" var="d"
                                                   itemLabel="#{d.name}" itemValue="#{d}" />
                                </p:selectOneMenu>

                                <p:selectOneMenu rendered="#{webUserController.current.institution ne null and webUserController.current.site ne null}"
                                                 value="#{webUserController.current.department}"
                                                 style="width: 300px;" filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="Select Department" />
                                    <f:selectItems value="#{departmentController.getDepartmentsOfInstitutionAndSite(webUserController.current.institution, webUserController.current.site)}" var="d"
                                                   itemLabel="#{d.name}" itemValue="#{d}" />
                                </p:selectOneMenu>

                            </h:panelGroup>


                            <p:outputLabel for="loginPage" value="Login Page" />
                            <p:outputLabel value=":" style="width: 20px;"/>
                            <p:selectOneMenu 
                                id="loginPage"
                                filterMatchMode="contains"
                                styleClass="w-100 mt-1 form-control"
                                value="#{webUserController.current.loginPage}"
                                rendered="#{!webUserController.createOnlyUserForExsistingUser}">
                                <f:selectItem itemLabel="-- Select Login Page --" itemValue="" />
                                <f:selectItems value="#{enumController.loginPages}"
                                               var="lp"
                                               itemLabel="#{lp.label}"
                                               itemValue="#{lp}" />
                            </p:selectOneMenu>

                            <p:outputLabel value="Email " style="width: 100px;" for="email" />
                            <p:outputLabel value=":" style="width: 20px;"/>
                            <p:inputText id="email" value="#{webUserController.current.email}" title="Email" style="width: 300px;"/>

                            <p:outputLabel value="Mobile " style="width: 100px;" for="telNo" />
                            <p:outputLabel value=":" style="width: 20px;"/>
                            <p:inputText id="telNo" value="#{webUserController.current.telNo}" title="TelNo" style="width: 300px;"/>

                            <p:outputLabel value="Code " style="width: 100px;" for="code" />
                            <p:outputLabel value=":" style="width: 20px;"/>
                            <p:inputText id="code" value="#{webUserController.current.code}" title="Code" style="width: 300px;" />

                            <p:outputLabel value="User is Active" class=" m-1"></p:outputLabel>
                            <p:outputLabel value=":" style="width: 20px;"/>
                            <p:selectBooleanCheckbox value="#{webUserController.current.activated}" >
                            </p:selectBooleanCheckbox>

                        </h:panelGrid>
                    </p:panel>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
