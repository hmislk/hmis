<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="bill" />
        <cc:attribute name="ShowProfit" type="java.lang.Boolean"/>
        <cc:attribute name="ShowRetailValue" type="java.lang.Boolean"/>
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>

        <style type="text/css">
            <h:outputText escape="false"
            value="#{configOptionApplicationController.getLongTextValueByKey('Pharmacy Direct Purchase without Costing Receipt CSS')}"/>
        </style>

        <div class="receipt-container">

            <div class="receipt-header-section">
                <h:outputText escape="false"
                              value="#{configOptionApplicationController.getLongTextValueByKey('Pharmacy Direct Purchase without Costing Receipt Header')}"/>
            </div>

            <div class="receipt-body-section">



                <div class="receipt-institution-name">
                    <h:outputLabel value="#{cc.attrs.bill.creater.department.printingName}"/>
                </div>

                <div class="receipt-institution-contact">
                    <h:outputLabel value="#{cc.attrs.bill.creater.department.address}"/>
                </div>

                <div class="receipt-title">
                    <h:outputLabel value="PURCHASE BILL"/>
                </div>

                <div class="receipt-details-table">
                    <h:panelGrid columns="4" styleClass="receipt-details-table">    
                        <h:outputLabel value="Purchase Date" />
                        <h:outputLabel value="#{cc.attrs.bill.createdAt}">
                            <f:convertDateTime timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.shortDateFormat}" />
                        </h:outputLabel>

                        <h:outputLabel value="Direct GRN No" />
                        <h:outputLabel value="#{cc.attrs.bill.deptId}" />

                        <h:outputLabel value="Invoice Date" />
                        <h:outputLabel value="#{cc.attrs.bill.invoiceDate}">
                            <f:convertDateTime timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.shortDateFormat}" />
                        </h:outputLabel>

                        <h:outputLabel value="Invoice No" />  
                        <h:outputLabel value="#{cc.attrs.bill.invoiceNumber}" /> 

                        <h:outputLabel value="Supplier" />
                        <h:outputLabel value="#{cc.attrs.bill.fromInstitution.name}" />

                    </h:panelGrid>
                </div>

                <p:spacer height="15px"/>

                <div class="receipt-items-table">
                    <p:dataTable rowIndexVar="rowIndex"
                                 value="#{cc.attrs.bill.billItems}" 
                                 var="bip"
                                 styleClass="receipt-items-table">

                        <p:column>
                            <f:facet name="header">Item</f:facet>
                            <h:outputText value="#{bip.item.name}" />
                            <h:outputText value=" (#{bip.item.code})" />
                        </p:column>

                        <p:column>
                            <f:facet name="header">Expiry</f:facet>
                            <h:outputLabel value="#{bip.pharmaceuticalBillItem.doe}">
                                <f:convertDateTime timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.shortDateFormat}" />
                            </h:outputLabel>
                        </p:column>

                        <p:column>
                            <f:facet name="header">QTY</f:facet>
                            <h:outputLabel value="#{bip.pharmaceuticalBillItem.qty}">
                                <f:convertNumber pattern="#,##0" />
                            </h:outputLabel>
                        </p:column>

                        <p:column>
                            <f:facet name="header">Free</f:facet>
                            <h:outputLabel value="#{bip.pharmaceuticalBillItem.freeQty}">
                                <f:convertNumber pattern="#,##0" />
                            </h:outputLabel>
                        </p:column>

                        <p:column>
                            <f:facet name="header">P. Rate</f:facet>
                            <h:outputLabel value="#{bip.pharmaceuticalBillItem.purchaseRate}">
                                <f:convertNumber pattern="#,##0.00" />
                            </h:outputLabel>
                        </p:column>

                        <p:column>
                            <f:facet name="header">Last P.R.</f:facet>
                            <h:outputLabel value="#{bip.pharmaceuticalBillItem.lastPurchaseRate}">
                                <f:convertNumber pattern="#,##0.00" />
                            </h:outputLabel>
                        </p:column>

                        <p:column>
                            <f:facet name="header">P. Value</f:facet>
                            <h:outputLabel value="#{bip.pharmaceuticalBillItem.purchaseRate * bip.pharmaceuticalBillItem.qty}">
                                <f:convertNumber pattern="#,##0.00" />
                            </h:outputLabel>
                        </p:column>

                        <p:column>
                            <f:facet name="header">Re. Rate</f:facet>
                            <h:outputLabel value="#{bip.pharmaceuticalBillItem.retailRate}">
                                <f:convertNumber pattern="#,##0.00" />
                            </h:outputLabel>
                        </p:column>

                        <p:column rendered="#{cc.attrs.ShowRetailValue}"
                                  styleClass="#{configOptionApplicationController.getBooleanValueByKey('Print RetailValue in Direct Purchase Bill', true) ? 'showRetailValue' : 'hideRetailValue'}">
                            <f:facet name="header">Re. Value</f:facet>
                            <h:outputLabel value="#{bip.pharmaceuticalBillItem.retailRate * (bip.pharmaceuticalBillItem.qty + bip.pharmaceuticalBillItem.freeQty)}">
                                <f:convertNumber pattern="#,##0.00" />
                            </h:outputLabel>
                        </p:column>

                        <p:column rendered="#{cc.attrs.ShowProfit}"
                                  styleClass="#{configOptionApplicationController.getBooleanValueByKey('Print Profit % in Direct Purchase Bill', true) ? 'showProfit' : 'hideProfit'}">
                            <f:facet name="header">Profit %</f:facet>
                            <h:outputText value="#{((bip.pharmaceuticalBillItem.retailRate - bip.pharmaceuticalBillItem.purchaseRate ) / bip.pharmaceuticalBillItem.purchaseRate) * 100}">
                                <f:convertNumber pattern="0.0" />
                            </h:outputText>
                        </p:column>

                        <!-- Footer section as before, retained if needed -->

                    </p:dataTable>
                </div>

                <p:spacer height="5px"/>

                <div class="receipt-cashier">
                    <h:outputLabel value="Prepared By : #{cc.attrs.bill.creater.webUserPerson.nameWithTitle}" />
                </div>

            </div>

            <div class="receipt-footer-section">
                <h:outputText escape="false"
                              value="#{configOptionApplicationController.getLongTextValueByKey('Pharmacy Direct Purchase without Costing Receipt Footer')}"/>
            </div>

        </div>




    </cc:implementation>
</html>
