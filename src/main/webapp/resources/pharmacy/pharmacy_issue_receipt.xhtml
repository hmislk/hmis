<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">


    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="bill" type="com.divudi.core.entity.Bill"/>
        <cc:attribute name="duplicate" />
        <cc:attribute name="cancel" />
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>

        <style>
            <h:outputText escape="false"
            value="#{configOptionApplicationController.getLongTextValueByKey('Pharmacy Issue Receipt CSS')}"/>
        </style>


        <h:outputText escape="false"
                      value="#{configOptionApplicationController.getLongTextValueByKey('Pharmacy Issue Receipt Header')}"/>

        <div class="receipt-container">
            <div class="receipt-header">
                <div class="receipt-institution-name">
                    <h:outputLabel value="#{cc.attrs.bill.department.printingName}" />
                </div>
                <div class="receipt-institution-contact">
                    <h:outputLabel value="#{cc.attrs.bill.department.address}" /><br />
                    <h:outputLabel value="#{cc.attrs.bill.department.telephone1}" />
                    <h:outputLabel value=" #{cc.attrs.bill.department.telephone2}" /><br />
                    <h:outputLabel value="#{cc.attrs.bill.department.fax}" />
                </div>
            </div>

            <div class="receipt-title">
                <h:outputLabel value="Pharmacy Disposal Issue Receipt" />
                <h:outputLabel value="**Duplicate**"  rendered="#{cc.attrs.duplicate eq true}" /> 
                <h:outputLabel value="**Cancelled**"  rendered="#{cc.attrs.bill.cancelled eq true or cc.attrs.cancel eq true}" />
            </div>

            <div class="receipt-separator"><hr /></div>

            <div class="receipt-bill-details">
                <table class="receipt-details-table">
                    <!-- Table rows for bill metadata -->
                    <tr>
                        <td><h:outputLabel value="Date" styleClass="label" /></td>
                        <td><h:outputLabel value=":" /></td>
                        <td>
                            <h:outputLabel value="#{cc.attrs.bill.createdAt}">
                                <f:convertDateTime pattern="dd/MM/yy" />
                            </h:outputLabel>
                            <h:outputLabel value="#{cc.attrs.bill.createdAt}">
                                <f:convertDateTime timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.shortTimeFormat}" />
                            </h:outputLabel>
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><h:outputLabel value="Receipt No" styleClass="label" /></td>
                        <td><h:outputLabel value=":" /></td>
                        <td colspan="4"><h:outputLabel value="#{cc.attrs.bill.deptId}" /></td>
                    </tr>

                    <h:panelGroup rendered="#{cc.attrs.bill.invoiceNumber ne null}">
                        <tr>
                            <td><h:outputLabel value="Request No" styleClass="label" /></td>
                            <td><h:outputLabel value=":" /></td>
                            <td colspan="4"><h:outputLabel value="#{cc.attrs.bill.invoiceNumber}" /></td>
                        </tr>
                    </h:panelGroup>

                    <tr>
                        <td><h:outputLabel value="Payment Method" styleClass="label" rendered="#{cc.attrs.bill.paymentMethod ne null}" /></td>
                        <td><h:outputLabel value=":" rendered="#{cc.attrs.bill.paymentMethod ne null}" /></td>
                        <td><h:outputLabel value="#{cc.attrs.bill.paymentMethod}" rendered="#{cc.attrs.bill.paymentMethod ne null}" /></td>
                    </tr>

                    <tr>
                        <td><h:outputLabel value="Payment Scheme" styleClass="label" rendered="#{cc.attrs.bill.paymentScheme.printingName ne null}" /></td>
                        <td><h:outputLabel value=":" rendered="#{cc.attrs.bill.paymentScheme.printingName ne null}" /></td>
                        <td><h:outputLabel value="#{cc.attrs.bill.paymentScheme.printingName}" rendered="#{cc.attrs.bill.paymentScheme.printingName ne null}" /></td>
                    </tr>

                    <tr>
                        <td><h:outputLabel value="Patient Name" styleClass="label" rendered="#{cc.attrs.bill.patient.person.nameWithTitle ne null}" /></td>
                        <td><h:outputLabel value=":" rendered="#{cc.attrs.bill.patient.person.nameWithTitle ne null}" /></td>
                        <td colspan="4"><h:outputLabel value="#{cc.attrs.bill.patient.person.nameWithTitle}" rendered="#{cc.attrs.bill.patient.person.nameWithTitle ne null}" /></td>
                    </tr>

                    <tr>
                        <td><h:outputLabel value="Staff Name" styleClass="label" rendered="#{cc.attrs.bill.toStaff.person.nameWithTitle ne null}" /></td>
                        <td><h:outputLabel value=":" rendered="#{cc.attrs.bill.toStaff.person.nameWithTitle ne null}" /></td>
                        <td colspan="4"><h:outputLabel value="#{cc.attrs.bill.toStaff.person.nameWithTitle}" rendered="#{cc.attrs.bill.toStaff.person.nameWithTitle ne null}" /></td>
                    </tr>

                    <tr>
                        <td><h:outputLabel value="From Unit" styleClass="label" /></td>
                        <td><h:outputLabel value=":" /></td>
                        <td colspan="4"><h:outputLabel value="#{cc.attrs.bill.department.name}" /></td>
                    </tr>

                    <h:panelGroup rendered="#{cc.attrs.bill.toDepartment ne null}">
                        <tr>
                            <td><h:outputLabel value="To Unit" styleClass="label" /></td>
                            <td><h:outputLabel value=":" /></td>
                            <td colspan="4"><h:outputLabel value="#{cc.attrs.bill.toDepartment.name}" /></td>
                        </tr>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{cc.attrs.bill.toInstitution ne null}">
                        <tr>
                            <td><h:outputLabel value="Company" styleClass="label" /></td>
                            <td><h:outputLabel value=":" /></td>
                            <td colspan="4"><h:outputLabel value="#{cc.attrs.bill.toInstitution.name}" /></td>
                        </tr>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{cc.attrs.bill.comments ne null}">
                        <tr>
                            <td><h:outputLabel value="Comment" styleClass="label" /></td>
                            <td><h:outputLabel value=":" /></td>
                            <td colspan="4"><h:outputLabel value="#{cc.attrs.bill.comments}" /></td>
                        </tr>
                    </h:panelGroup>

                </table>
            </div>

            <div class="receipt-separator"><hr /></div>

            <div class="receipt-items-section">
                <table class="receipt-items-table">
                    <thead>
                        <tr>
                            <th class="item-name">Item</th>
                            <th class="item-code">Code</th>
                            <th class="item-qty">Qty</th>
                            <th class="item-rate">Issue Rate</th>

                            <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Retail Rate',true)}">
                                <th class="item-rate">Retail Rate</th>
                            </ui:fragment>
                            <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Purchase Rate',true)}">
                                <th class="item-rate">Purchase Rate</th>
                            </ui:fragment>
                            <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Cost Rate',true)}">
                                <th class="item-rate">Cost Rate</th>
                            </ui:fragment>
                            <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Issue Value',true)}">
                                <th class="item-value">Issue Value</th>
                            </ui:fragment>
                            <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Retail Value',true)}">
                                <th class="item-value">Retail Value</th>
                            </ui:fragment>
                            <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Purchase Value',true)}">
                                <th class="item-value">Purchase Value</th>
                            </ui:fragment>
                            <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Cost Value',true)}">
                                <th class="item-value">Cost Value</th>
                            </ui:fragment>
                        </tr>

                    </thead>
                    <tbody>
                        <ui:repeat value="#{cc.attrs.bill.billItems}" var="bip">
                            <tr>
                                <td class="item-name">
                                    <h:outputLabel value="#{bip.item.name}" />
                                </td>
                                <td class="item-code">
                                    <h:outputLabel value="#{bip.item.code}" />
                                </td>
                                <td class="item-qty">
                                    <h:outputLabel value="#{bip.qty}">
                                        <f:convertNumber pattern="#,##0.00" />
                                    </h:outputLabel>
                                </td>
                                <td class="item-rate">
                                    <h:outputLabel value="#{bip.billItemFinanceDetails.lineGrossRate}">
                                        <f:convertNumber pattern="#,##0.00" />
                                    </h:outputLabel>
                                </td>
                                <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Retail Rate',true)}">
                                    <td class="item-rate">
                                        <h:outputLabel value="#{bip.pharmaceuticalBillItem.itemBatch.retailsaleRate}">
                                            <f:convertNumber pattern="#,##0.00" />
                                        </h:outputLabel>
                                    </td>
                                </ui:fragment>
                                <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Purchase Rate',true)}">
                                    <td class="item-rate">
                                        <h:outputLabel value="#{bip.pharmaceuticalBillItem.itemBatch.purcahseRate}">
                                            <f:convertNumber pattern="#,##0.00" />
                                        </h:outputLabel>
                                    </td>
                                </ui:fragment>
                                <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Cost Rate',true)}">
                                    <td class="item-rate">
                                        <h:outputLabel value="#{bip.pharmaceuticalBillItem.itemBatch.costRate}">
                                            <f:convertNumber pattern="#,##0.00" />
                                        </h:outputLabel>
                                    </td>
                                </ui:fragment>
                                <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Issue Value',true)}">
                                    <td class="item-value">
                                        <h:outputLabel value="#{bip.billItemFinanceDetails.lineNetTotal}">
                                            <f:convertNumber pattern="#,##0.00" />
                                        </h:outputLabel>
                                    </td>
                                </ui:fragment>
                                <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Retail Value',true)}">
                                    <td class="item-value">
                                        <h:outputLabel value="#{bip.billItemFinanceDetails.valueAtRetailRate}">
                                            <f:convertNumber pattern="#,##0.00" />
                                        </h:outputLabel>
                                    </td>
                                </ui:fragment>
                                <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Purchase Value',true)}">
                                    <td class="item-value">
                                        <h:outputLabel value="#{bip.billItemFinanceDetails.valueAtPurchaseRate}">
                                            <f:convertNumber pattern="#,##0.00" />
                                        </h:outputLabel>
                                    </td>
                                </ui:fragment>
                                <ui:fragment rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Cost Value',true)}">
                                    <td class="item-value">
                                        <h:outputLabel value="#{bip.billItemFinanceDetails.valueAtCostRate}">
                                            <f:convertNumber pattern="#,##0.00" />
                                        </h:outputLabel>
                                    </td>
                                </ui:fragment>
                            </tr>

                        </ui:repeat>
                    </tbody>
                </table>
            </div>

            <div class="receipt-separator"><hr /></div>

            <div class="receipt-summary">
                <table class="receipt-summary-table">
                    <tr>
                        <td class="summary-label">Number of Items</td>
                        <td class="summary-value">
                            <h:outputLabel value="#{cc.attrs.bill.billItems.size()}">
                                <f:convertNumber pattern="#,##0" />
                            </h:outputLabel>
                        </td>
                    </tr>
                    <tr>
                        <td class="summary-label">Total</td>
                        <td class="summary-value">
                            <h:outputLabel value="#{cc.attrs.bill.total}" styleClass="total-amount">
                                <f:convertNumber pattern="#,##0.00" />
                            </h:outputLabel>
                        </td>
                    </tr>

                    <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Retail Value',true)}">
                        <tr>
                            <td class="summary-label">Total Sale Value</td>
                            <td class="summary-value">
                                <h:outputLabel value="#{cc.attrs.bill.billFinanceDetails.totalRetailSaleValue}">
                                    <f:convertNumber pattern="#,##0.00" />
                                </h:outputLabel>
                            </td>
                        </tr>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Cost Value',true)}">
                        <tr>
                            <td class="summary-label">Total Cost Value</td>
                            <td class="summary-value">
                                <h:outputLabel value="#{cc.attrs.bill.billFinanceDetails.totalCostValue}">
                                    <f:convertNumber pattern="#,##0.00" />
                                </h:outputLabel>
                            </td>
                        </tr>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Pharmacy Disposals - Display Purchase Value',true)}">
                        <tr>
                            <td class="summary-label">Total Purchase Value</td>
                            <td class="summary-value">
                                <h:outputLabel value="#{cc.attrs.bill.billFinanceDetails.totalPurchaseValue}">
                                    <f:convertNumber pattern="#,##0.00" />
                                </h:outputLabel>
                            </td>
                        </tr>
                    </h:panelGroup>
                </table>
            </div>

            <div class="receipt-staff-info">
                <table class="receipt-staff-table">
                    <tr>
                        <td class="staff-label">Created By:</td>
                        <td class="staff-value"><h:outputLabel value="#{cc.attrs.bill.creater.name}" /></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td class="staff-label">Created At:</td>
                        <td class="staff-value">
                            <h:outputLabel value="#{cc.attrs.bill.createdAt}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                            </h:outputLabel>
                        </td>
                    </tr>
<!--                    <tr>-->
<!--                        <td class="staff-label">Created At:</td>-->
<!--                        <td class="staff-value">-->
<!--                            <h:outputLabel value="#{cc.attrs.bill.createdAt}">-->
<!--                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />-->
<!--                            </h:outputLabel>-->
<!--                        </td>-->
<!--                    </tr>-->
                    <tr>
                        <td class="staff-label">Generated By:</td>
                        <td class="staff-value">
                            <h:outputLabel value="#{sessionController.loggedUser.name}"/>
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td class="staff-label">Generated At:</td>
                          <td class="staff-value">
                              <h:outputLabel value="#{sessionController.currentDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                            </h:outputLabel>
                        </td>
                    </tr>
<!--                    <tr>-->
<!--                        <td class="staff-label">Generated At:</td>-->
<!--                        <td class="staff-value">_________________________</td>-->
<!--                    </tr>-->
                </table>
            </div>
        </div>

        <h:outputText escape="false"
                      value="#{configOptionApplicationController.getLongTextValueByKey('Pharmacy Issue Receipt Footer')}"/>




    </cc:implementation>
</html>
