<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">

    <!-- INTERFACE -->
    <cc:interface>
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>
        <h1><h:outputText value="View Barcode" class="d-flex justify-content-center mt-4"/> </h1>
        <p:panel>
            <f:facet name="header">
                <div class="d-flex justify-content-between">
                    <div class="d-flex gap-2">
                        <i class="fa fa-barcode mt-3" aria-hidden="true"></i>
                        <h:outputLabel value="Barcode Sticker" class="mt-2"/>
                    </div>
                    <div class="d-flex gap-2">
                        <h:outputLabel value="Print Individual Barcodes" class="mt-2"/>
                        <p:selectBooleanButton id="cheindbar" onIcon="pi pi-check" offIcon="pi pi-times" value="#{laboratoryManagementController.printIndividualBarcodes}">
                            <p:ajax process="cheindbar" update="test barcode" event="change"></p:ajax>
                        </p:selectBooleanButton>
                        <div class="d-flex gap-3">
                            <p:commandButton 
                                icon="fa-solid fa-flask-vial"
                                value="To Sample List" 
                                class="ui-button-warning"
                                ajax="false"
                                action="#{laboratoryManagementController.navigateToDTOSamplesFromSelectedBill(laboratoryManagementController.currentBill)}" >
                            </p:commandButton>
                        </div>
                    </div>
                </div>
            </f:facet>

            <h:panelGroup id="barcode">
                <h:panelGroup id="allBatchBarcode" rendered="#{laboratoryManagementController.printIndividualBarcodes eq false}">
                    <p:commandButton
                        ajax="false" 
                        class="mb-4 mx-5 ui-button-info"
                        icon="fa fa-print"
                        value="Print All">
                        <p:printer target="batchBarcode"></p:printer>
                    </p:commandButton>
                    <h:panelGroup id="batchBarcode">
                        <ui:repeat value="#{laboratoryManagementController.selectedBillBarcodes}" var="smpIx">
                            <ui:repeat value="#{smpIx.patientSampleWrappers}" var="psc">
                                <div class="sticker">
                                    <div class="patient-info">
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Sample ID PHN in Sample Stickers', true)}">
                                            <span class="sample-id">
                                                #{psc.patientSample.idStr}&nbsp;&nbsp;
                                            </span>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient Age in Sample Stickers')}">
                                            <span class="patient-age">
                                                #{psc.patientSample.patient.person.ageAsShortString}&nbsp;&nbsp;
                                            </span>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient Sex in Sample Stickers')}">
                                            <span class="patient-sex">
                                                #{psc.patientSample.patient.person.sex.shortLabel}&nbsp;&nbsp;
                                            </span>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient ID in Sample Stickers')}">
                                            <span class="patient-id">
                                                #{psc.patientSample.patient.person.id}&nbsp;&nbsp;
                                            </span>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Bill Type (IP/OP/CC) in Sample Stickers')}">
                                            <span class="patient-id">
                                                #{psc.patientSample.bill.ipOpOrCc}&nbsp;&nbsp;
                                            </span>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Barcode Generated Time in Sample Stickers')}">
                                            <span class="patient-id">
                                                <h:outputLabel value="#{psc.patientSample.barcodeGeneratedAt}">
                                                    <f:convertDateTime pattern="#{configOptionApplicationController.getShortTextValueByKey('Date Time Format for Barcode Generated Time in Sample Stickers','d/M/yy-hh:mm')}"></f:convertDateTime>
                                                </h:outputLabel>
                                                &nbsp;&nbsp;
                                            </span>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient PHN in Sample Stickers')}">
                                            <span class="patient-phn">
                                                #{psc.patientSample.patient.phn}
                                            </span>
                                        </h:panelGroup>
                                        <span class="patient-name">
                                            #{psc.patientSample.patient.person.name}&nbsp;&nbsp;
                                        </span>
                                    </div>
                                    <div class="patient-sample-info">
                                        <ui:repeat value="#{patientInvestigationController.getPatientSampleComponentsByPatientSample(psc.patientSample)}" var="psw">
                                            <span class="sample-component" style="font-weight: 800">
                                                #{psw.nameTranscient}&nbsp;&nbsp;
                                            </span>
                                        </ui:repeat>
                                    </div>
                                    <div class="barcode-info">
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Barcode in Sample Stickers')}">
                                            <p:barcode 
                                                value="#{psc.patientSample.idStr}" 
                                                cache="false"
                                                hrp="none"
                                                type="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Type','code128')}" 
                                                height="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Height in Pixles','80')}"
                                                width="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Width in Pixles','280')}"
                                                orientation="0"></p:barcode>
                                        </h:panelGroup>
                                    </div>
                                    <div class="patient-info">
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Bill No in Sample Stickers', true)}">
                                            <span class="sample-id">
                                                #{psc.patientSample.bill.deptId}&nbsp;&nbsp;
                                            </span>
                                        </h:panelGroup>
                                    </div>
                                </div>
                            </ui:repeat>


                        </ui:repeat>
                    </h:panelGroup>
                </h:panelGroup>

                <h:panelGroup id="individualBarcode" rendered="#{laboratoryManagementController.printIndividualBarcodes eq true}">

                    <ui:repeat value="#{laboratoryManagementController.selectedBillBarcodes}" var="smpIx">

                        <ui:repeat value="#{smpIx.patientSampleWrappers}" var="psc">
                            <p:panelGrid columns="6">
                                <h:panelGroup id="tt" >
                                    <div class="sticker">
                                        <div class="patient-info">
                                            <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Sample ID PHN in Sample Stickers', true)}">
                                                <span class="sample-id">
                                                    #{psc.patientSample.idStr}&nbsp;&nbsp;
                                                </span>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient Age in Sample Stickers')}">
                                                <span class="patient-age">
                                                    #{psc.patientSample.patient.person.ageAsShortString}&nbsp;&nbsp;
                                                </span>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient Sex in Sample Stickers')}">
                                                <span class="patient-sex">
                                                    #{psc.patientSample.patient.person.sex.shortLabel}&nbsp;&nbsp;
                                                </span>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient ID in Sample Stickers')}">
                                                <span class="patient-id">
                                                    #{psc.patientSample.patient.person.id}&nbsp;&nbsp;
                                                </span>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Bill Type (IP/OP/CC) in Sample Stickers')}">
                                                <span class="patient-id">
                                                    #{psc.patientSample.bill.ipOpOrCc}&nbsp;&nbsp;
                                                </span>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Barcode Generated Time in Sample Stickers')}">
                                                <span class="patient-id">
                                                    <h:outputLabel value="#{psc.patientSample.barcodeGeneratedAt}">
                                                        <f:convertDateTime pattern="#{configOptionApplicationController.getShortTextValueByKey('Date Time Format for Barcode Generated Time in Sample Stickers','d/M/yy-hh:mm')}"></f:convertDateTime>
                                                    </h:outputLabel>
                                                    &nbsp;&nbsp;
                                                </span>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient PHN in Sample Stickers')}">
                                                <span class="patient-phn">
                                                    #{psc.patientSample.patient.phn}
                                                </span>
                                            </h:panelGroup>
                                            <span class="patient-name">
                                                #{psc.patientSample.patient.person.name}&nbsp;&nbsp;
                                            </span>
                                        </div>
                                        <div class="patient-sample-info">
                                            <ui:repeat value="#{patientInvestigationController.getPatientSampleComponentsByPatientSample(psc.patientSample)}" var="psw">
                                                <span class="sample-component" style="font-weight: 800">
                                                    #{psw.nameTranscient}&nbsp;&nbsp;
                                                </span>
                                            </ui:repeat>
                                        </div>
                                        <div class="barcode-info">
                                            <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Barcode in Sample Stickers')}">
                                                <p:barcode 
                                                    value="#{psc.patientSample.idStr}" 
                                                    cache="false"
                                                    hrp="none"
                                                    type="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Type','code128')}" 
                                                    height="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Height in Pixles','80')}"
                                                    width="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Width in Pixles','280')}"
                                                    orientation="0"></p:barcode>
                                            </h:panelGroup>
                                        </div> 
                                    </div>
                                    <div class="patient-info">
                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Bill No in Sample Stickers', true)}">
                                            <span class="sample-id">
                                                #{psc.patientSample.bill.deptId}&nbsp;&nbsp;
                                            </span>
                                        </h:panelGroup>
                                    </div>
                                </h:panelGroup>

                                <p:badge 
                                    class="mt-4 ui-badge-warning"
                                    size="large"
                                    value="#{patientInvestigationController.sampleComponentNames(psc.patientSample)}" >
                                </p:badge>

                                <p:commandButton
                                    ajax="false" 
                                    class="mt-4 ui-button-info"
                                    icon="fa fa-print"
                                    value="Print '#{patientInvestigationController.sampleComponentNames(psc.patientSample)}' Barcode">
                                    <p:printer target="tt"></p:printer>
                                </p:commandButton>

                            </p:panelGrid>

                        </ui:repeat>
                    </ui:repeat>

                </h:panelGroup>
            </h:panelGroup>
        </p:panel>
    </cc:implementation>
</html>
