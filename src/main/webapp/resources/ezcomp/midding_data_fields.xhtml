<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">

    <!-- INTERFACE -->
    <cc:interface>
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>
        <h:form >

            <p:accordionPanel 
                activeIndex="#{dataAdministrationController.tabIndexMissingFields}">
                <p:ajax process="@this" ></p:ajax>

                <p:tab 
                    title="Add All Tables using create ddl file contents"  >


                    <p:panelGrid columns="2" class="mt-1 w-100" style="border: 10px green;">
                        <f:facet name="header">
                            <i class="fa fa-search"/>
                            <h:outputLabel value="Update Database by DDL File" class="mx-2"/>
                        </f:facet>

                        <p:outputLabel value="Instructions" />
                        <p>To generate the DDL file, replace the contents of your persistence.xml with the configuration from persistence_for_database_generation_script.xml. Adjust the output file path accordingly. Run the application to generate the DDL file. Then copy its contents and paste into the field below. Click 'Update Database' to apply all missing tables and fields. The latest version of the DDL file is available at <a href="https://github.com/hmislk/hmis/wiki/Database-Schema-DDL-Generation-Guide" target="_blank">Database Schema DDL Generation Guide</a>. </p>

                        <p:outputLabel value="DDL Content" />
                        <p:inputTextarea
                            rows="6"
                            autoResize="false"
                            value="#{dataAdministrationController.allCreateStetements}" 
                            class="w-100" />

                        <p:spacer />

                        <p:commandButton 
                            value="Update Database" 
                            ajax="false" 
                            action="#{dataAdministrationController.createTablesAndFieldsForAllCreateStatements}" />

                        <p:outputLabel value="Execution Feedback" />
                        <h:outputText escape="false">
                            <textarea readonly="readonly" rows="6" class="form-control w-100" style="resize: none;">#{dataAdministrationController.executionFeedback}</textarea>
                        </h:outputText>
                    </p:panelGrid>

                </p:tab>
                <p:tab title="Check Missing Fields and Add Fields" >
                    <p:panelGrid columns="2" class="mt-1 w-100" style="border: 10px green;">
                        <f:facet name="header">
                            <i class="fa fa-search"/>
                            <h:outputLabel value="Missing Data Fields" class="mx-2"/>
                            <p:spacer height="2" width="20" ></p:spacer>
                            <p:commandButton
                                ajax="false" 
                                action="#{dataAdministrationController.checkMissingFields()}" 
                                value="Check Missing Fields"  
                                class="w-25"
                                />
                        </f:facet>
                        <p:outputLabel value="Errors" ></p:outputLabel>
                        <p:inputTextarea 
                            rows="2"
                            value="#{dataAdministrationController.errors}" 
                            class="w-100"/>


                        <p:outputLabel value="Data table Create SQL statement" ></p:outputLabel>
                        <p:inputTextarea 
                            rows="6"
                            autoResize="false"
                            value="#{dataAdministrationController.createdSql}" 
                            class="w-100"/>

                        <p:spacer ></p:spacer>
                        <p:commandButton 
                            value="Generate Alter Statements" 
                            ajax="false" 
                            action="#{dataAdministrationController.generateAlterStatementFromCreateTableStatement}" ></p:commandButton>

                        <p:outputLabel value="SQL to Run" ></p:outputLabel>
                        <p:inputTextarea
                            rows="6"
                            autoResize="false"
                            value="#{dataAdministrationController.suggestedSql}" 
                            class="w-100"/>

                        <p:spacer ></p:spacer>
                        <p:commandButton 
                            value="RUN SQL" 
                            ajax="false" 
                            action="#{dataAdministrationController.runSqlToCreateFields}" ></p:commandButton>

                        <p:outputLabel value="Execution Feedback" ></p:outputLabel>
                        <p:inputTextarea
                            rows="6"
                            autoResize="false"
                            value="#{dataAdministrationController.executionFeedback}" 
                            readonly="true"
                            class="w-100"/>
                    </p:panelGrid>

                </p:tab>

                <p:tab title="Run Custom SQL Commands" >



                    <p:panelGrid columns="2" class="mt-1 w-100" style="border: 10px green;">
                        <f:facet name="header">
                            <i class="fa fa-search"/>
                            <h:outputLabel value="Run SQL Commands" class="mx-2"/>
                        </f:facet>
                        <p:outputLabel value="SQL to Run" ></p:outputLabel>
                        <p:inputTextarea
                            rows="6"
                            autoResize="false"
                            value="#{dataAdministrationController.suggestedSql}" 
                            class="w-100"/>

                        <p:spacer ></p:spacer>
                        <p:commandButton 
                            value="RUN SQL" 
                            ajax="false" 
                            action="#{dataAdministrationController.runSqlToCreateFields}" ></p:commandButton>

                        <p:outputLabel value="Execution Feedback" ></p:outputLabel>
                        <p:inputTextarea
                            rows="6"
                            autoResize="false"
                            value="#{dataAdministrationController.executionFeedback}" 
                            readonly="true"
                            class="w-100"/>
                    </p:panelGrid>

                </p:tab>

            </p:accordionPanel>
        </h:form>

    </cc:implementation>
</html>