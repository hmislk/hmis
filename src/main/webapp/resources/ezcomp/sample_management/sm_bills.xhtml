<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">

    <!-- INTERFACE -->
    <cc:interface>
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>
        <h:panelGroup rendered="#{patientInvestigationController.listingEntity eq 'BILLS'}" >

            <p:dataTable  
                class="w-100"
                value="#{patientInvestigationController.bills}" 
                var="b" 
                paginator="true"
                rowKey="#{b.id}"
                paginatorPosition="bottom"
                rows="10"
                paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                rowsPerPageTemplate="10,25,50"
                style="table-layout: fixed; width: 100%;">

                <!-- Bill Number and Date Column -->
                <p:column headerText="Bill No." width="10em" style="width: 8em; vertical-align: top;">
                    <p:commandLink 
                        ajax="false" 
                        class="text-primary"
                        action="#{billSearch.navigateToViewOpdBill()}">
                        <f:setPropertyActionListener value="#{b}" target="#{billSearch.bill}"/>
                        <i class="fas fa-receipt"></i> <!-- Bill Icon -->
                        <h:outputLabel value="#{b.deptId}" class="mx-2"/>
                    </p:commandLink>
                    <br/>
                    <i class="fas fa-calendar-alt text-secondary"></i> <!-- Date Icon -->
                    <h:outputLabel value="#{b.createdAt}" class="mx-2" >
                        <f:convertDateTime pattern="#{sessionController.applicationPreference.longDateTimeFormat}"></f:convertDateTime>
                    </h:outputLabel>
                    <br/>
                    <i class="fa-solid fa-file-invoice-dollar text-secondary"></i> <!-- Bill ID Icon -->
                    <h:outputLabel value="#{b.id}" class="mx-2" >
                    </h:outputLabel>
                    <br/>
                    <!-- CC, IP, and OP Icons with Colours -->
                    <h:panelGroup rendered="#{b.ipOpOrCc == 'CC'}">
                        <i class="fas fa-box text-warning"></i> <!-- Collecting Centre Icon -->
                        <h:outputLabel value="Collecting Centre (CC)" class="text-warning mx-2"/>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{b.ipOpOrCc == 'IP'}">
                        <i class="fas fa-procedures text-info"></i> <!-- Inpatient Icon -->
                        <h:outputLabel value="Inpatient (IP)" class="text-info mx-2"/>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{b.ipOpOrCc == 'OP'}">
                        <i class="fas fa-user-outlet text-primary"></i> <!-- Outpatient Icon -->
                        <h:outputLabel value="Outpatient (OP)" class="text-primary mx-2"/>
                    </h:panelGroup>
                </p:column>

                <!-- Patient Details Column with Icons -->
                <p:column headerText="Patient"  style="width: 10em; vertical-align: top;">
                    <i class="fas fa-user text-primary"></i> <!-- Name Icon -->
                    <h:outputLabel value="#{b.patient.person.nameWithTitle}" class="mx-2" />
                    <br/>
                    <i class="fas fa-birthday-cake text-info"></i> <!-- Age Icon -->
                    <h:outputLabel value="#{b.patient.person.ageAsString}" class="mx-2"/>
                    <br/>
                    <i class="fas fa-venus-mars text-danger"></i> <!-- Sex Icon -->
                    <h:outputLabel value="#{b.patient.person.sex.label}" class="mx-2" />
                    <br/>
                    <i class="fas fa-phone-alt text-success"></i> <!-- Phone Icon -->
                    <h:outputLabel value="#{b.patient.person.phone}" class="mx-2" />
                    <br/>
                    <i class="fas fa-mobile-alt text-warning"></i> <!-- Mobile Icon -->
                    <h:outputLabel value="#{b.patient.person.mobile}" class="mx-2" />
                </p:column>

                <!-- Ordered Institution and Department Column -->
                <p:column headerText="Ordered Institute"  style="width: 5em; vertical-align: top;">
                    <h:panelGroup rendered="#{b.collectingCentre == null}">
                        <i class="fas fa-hospital text-info"></i> <!-- Institution Icon -->
                        <h:outputLabel value="#{b.institution.name}" />
                        <br/>
                        <i class="fas fa-building text-primary"></i> <!-- Department Icon -->
                        <h:outputLabel value="#{b.department.name}" />
                    </h:panelGroup>
                    <h:panelGroup rendered="#{b.collectingCentre != null}">
                        <i class="fas fa-box text-secondary"></i> <!-- Collecting Centre Icon -->
                        <h:outputLabel value="#{b.collectingCentre.name}" />
                    </h:panelGroup>
                </p:column>

                <!-- Lab Institution and Department Column -->
                <p:column headerText="Lab" style="width: 5em; vertical-align: top;">
                    <i class="fas fa-flask text-danger"></i> <!-- Lab Institution Icon -->
                    <h:outputLabel value="#{b.toInstitution.name}" />
                    <br/>
                    <i class="fas fa-vials text-success"></i> <!-- Lab Department Icon -->
                    <h:outputLabel value="#{b.toDepartment.name}" />
                </p:column>

                <p:column headerText="Status"  style="width: 5em; vertical-align: top;">
                    <h:panelGroup rendered="#{b.cancelled}">
                        <div class="d-flex justify-content-center mt-4">
                            <p:badge 
                                value="Bill Cancel" 
                                severity="info"
                                size="large"
                                style="width: 200px;"
                                styleClass="ui-badge-danger" 
                                rendered="#{b.cancelled}" >
                            </p:badge>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{!b.cancelled}">
                        <h:outputLabel value="#{b.status.label}" />
                    </h:panelGroup>

                </p:column>

                <p:column headerText="Actions" width="8em">
                    <div>
                        <div class="row">
                            <p:commandButton 
                                icon="fa-solid fa-barcode"
                                value="Generate Barcodes" 
                                disabled="#{b.cancelled}"
                                ajax="false" 
                                action="#{patientInvestigationController.generateBarcodesForSelectedBill(b)}" >
                            </p:commandButton>
                        </div>
                        <div class="row mt-2">

                            <p:commandButton 
                                icon="fa-regular fa-rectangle-list"
                                value="To Investigations" 
                                class="ui-button-warning"
                                ajax="false" 
                                action="#{patientInvestigationController.navigateToInvestigationsFromSelectedBill(b)}" >
                            </p:commandButton>
                        </div>
                        <div class="row mt-2">
                            <p:commandButton 
                                icon="fa-solid fa-flask-vial"
                                value="To Samples" 
                                class="ui-button-raised"
                                ajax="false" 
                                disabled="#{b.status.label eq 'Ordered'}"
                                action="#{patientInvestigationController.navigateToSamplesFromSelectedBill(b)}" >
                            </p:commandButton>
                        </div>

                        <div class="row mt-2">
                            <p:commandButton 
                                icon="fa fa-file-text"
                                value="To Reports" 
                                class="ui-button-danger"
                                ajax="false" 
                                disabled="#{b.status eq 'ORDERED' or b.status eq 'SAMPLE_GENERATED' or b.status eq 'SAMPLE_COLLECTED'or b.status eq 'SAMPLE_SENT'}"
                                action="#{patientInvestigationController.navigateToPatientReportsFromSelectedBill(b)}" >
                            </p:commandButton>
                        </div>
                    </div>


                </p:column>

            </p:dataTable>



        </h:panelGroup>
    </cc:implementation>
</html>
