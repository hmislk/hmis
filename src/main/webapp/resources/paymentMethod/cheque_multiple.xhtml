<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="paymentMethodData" type="com.divudi.core.data.dataStructure.PaymentMethodData" />
        <cc:attribute name="valueRequired" type="boolean" default="true"/>
        <cc:attribute name="controller" type="com.divudi.bean.common.ControllerWithMultiplePayments" required="true"/>
        <cc:attribute name="componentDetail" type="com.divudi.core.data.dataStructure.ComponentDetail" />
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>
        <style>
            .bank-select-menu .ui-selectonemenu-label {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                padding-right: 2.5rem;
            }

            .cheque-input {
                width: auto;
                max-width: 200px;
            }

            .comment-input {
                flex: 1 1 auto; 
                max-width: 543px;
            }

            @media (max-width: 880px) {
                .cheque-field-parent {
                    flex-direction: column;
                    align-items: stretch !important;
                }
                
                .col-auto {
                    width: 100% !important;
                    flex: none !important;
                    max-width: 100% !important;
                }
                
                .cheque-field {
                    flex-direction: column !important;
                    align-items: flex-start !important;
                    width: 100%;
                }
                
                .cheque-field p\:outputLabel {
                    width: 100% !important;
                    margin-bottom: 0.25rem;
                }

                .cheque-input, 
                .cheque-cal input,
                .comment-input,
                .bank-select-menu {
                    width: 100% !important;
                    max-width: none !important;
                }
                
                .bank-select-menu {
                    width: 100% !important;
                }
                
                .cheque-cal {
                    width: 100% !important;
                }
                
                .cheque-cal input {
                    width: 100% !important;
                }
                
                .comment-input {
                    max-width: none !important;
                    width: 100% !important;
                }
            }
        </style>

        <div class="d-flex flex-wrap align-items-center gap-3 cheque-field-parent">
            <div class="col-auto d-flex align-items-center gap-2 cheque-field">
                <p:outputLabel for="txtVal" value="Amount:" style="width: 120px;"/>
                <p:inputText
                    id="txtVal"
                    value="#{cc.attrs.paymentMethodData.cheque.totalValue}"
                    styleClass="form-control cheque-input"
                    autocomplete="off"
                    disabled="#{cc.attrs.componentDetail != null and not cc.attrs.controller.isLastPaymentEntry(cc.attrs.componentDetail)}"
                    required="true"
                    requiredMessage="Amount is required">
                    <p:ajax event="keyup" process="@this" update=":#{p:resolveFirstComponentWithId('balanceDisplay',view).clientId}" listener="#{cc.attrs.controller.calculatRemainForMultiplePaymentTotal()}" />
                    <f:convertNumber pattern="#,##0.00" />
                </p:inputText>
            </div>

            <div class="col-auto d-flex align-items-center gap-2 cheque-field">
                <p:outputLabel for="chequeNo" value="Cheque No:" style="width: 120px;"/>
                <p:inputText
                    id="chequeNo"
                    placeholder="Cheque Number"
                    value="#{cc.attrs.paymentMethodData.cheque.no}"
                    styleClass="form-control cheque-input"
                    autocomplete="off"
                    disabled="#{cc.attrs.componentDetail != null and not cc.attrs.controller.isLastPaymentEntry(cc.attrs.componentDetail)}"
                    required="#{cc.attrs.componentDetail == null or cc.attrs.controller.isLastPaymentEntry(cc.attrs.componentDetail)}"
                    requiredMessage="Cheque No is required">
                    <p:ajax
                        event="blur"
                        process="@this"/>
                </p:inputText>
            </div>

            <div class="col-auto d-flex align-items-center gap-2 cheque-field">
                <p:outputLabel for="bankSelect" value="Bank:" style="width: 120px;"/>
                <p:selectOneMenu
                    id="bankSelect"
                    value="#{cc.attrs.paymentMethodData.cheque.institution}"
                    styleClass="form-control bank-select-menu"
                    required="true"
                    style="width: 200px;"
                    requiredMessage="Bank is required">
                    <f:selectItem itemLabel="Select Bank" noSelectionOption="true"/>
                    <f:selectItems value="#{institutionController.banks}" var="inst" itemLabel="#{inst.name}" itemValue="#{inst}"/>
                    <p:ajax
                        event="change"
                        process="@this"/>
                </p:selectOneMenu>
            </div>

            <div class="col-auto d-flex align-items-center gap-2 cheque-field">
                <p:outputLabel for="ChequeDate" value="Date:" style="width: 120px;"/>
                <p:calendar
                    id="ChequeDate"
                    placeholder="Cheque Date"
                    value="#{cc.attrs.paymentMethodData.cheque.date}"
                    pattern="#{sessionController.applicationPreference.longDateFormat}"
                    styleClass="cheque-cal"
                    inputStyleClass="form-control"
                    required="true"
                    requiredMessage="Date is required">
                    <p:ajax
                        event="dateSelect"
                        process="@this"/>
                </p:calendar>
            </div>

            <div class="col-auto d-flex align-items-center gap-2 flex-grow-1 cheque-field">
                <p:outputLabel for="chequeComment" value="Comment:" style="min-width: 120px;"/>
                <p:inputText
                    id="chequeComment"
                    value="#{cc.attrs.paymentMethodData.cheque.comment}"
                    placeholder="Enter comments"
                    styleClass="form-control comment-input"
                    required="true"
                    requiredMessage="Comment is required">
                    <p:ajax
                        event="blur"
                        process="@this"
                        listener="#{cc.attrs.controller.calculatRemainForMultiplePaymentTotal()}" />
                </p:inputText>
            </div>
        </div>
    </cc:implementation>
</html>
