<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:pharmacy="http://xmlns.jcp.org/jsf/composite/pharmacy">

    <h:body>
        <ui:composition template="/resources/template/template.xhtml">
            <ui:define name="content">
                <h:form>
                    <h:panelGroup rendered="#{!pharmacyBillSearch.printPreview}" styleClass="alignTop">

                        <!-- Top Action Toolbar -->
                        <p:toolbar style="margin-bottom: 10px;">
                            <p:toolbarGroup align="left">
                                <h:outputText value="Direct Purchase Cancellation" style="font-weight: bold; font-size: 1.1em;"/>
                            </p:toolbarGroup>
                            <p:toolbarGroup align="right">
                                <p:outputLabel value="Payment Method:" for="cmbPs" style="margin-right: 6px; font-weight: bold;"/>
                                <!--Business Logic - THe very same payment method used for purchase must be used for cancellation.-->
                                <p:selectOneMenu
                                    disabled="true"
                                    id="cmbPs" value="#{pharmacyBillSearch.bill.paymentMethod}" required="true" style="margin-right: 10px;">
                                    <f:selectItems value="#{enumController.allPaymentMethods}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Cancellation Reason:" for="txtComments" style="margin-right: 6px; font-weight: bold;"/>
                                <p:inputText id="txtComments"
                                             value="#{pharmacyBillSearch.bill.comments}"
                                             style="margin-right: 10px;"
                                             placeholder="Enter Reason"/>
                                <p:commandButton value="Cancel Purchase"
                                                action="#{pharmacyBillSearch.pharmacyPurchaseCancel()}"
                                                icon="fa fa-ban"
                                                styleClass="ui-button-danger"
                                                ajax="false"
                                                title="Cancel direct purchase"/>
                            </p:toolbarGroup>
                        </p:toolbar>

                        <!-- Supplier and Bill Details -->
                        <p:panelGrid columns="2" style="width: 100%; margin-bottom: 10px;">
                            <p:panel header="Supplier Detail">
                                <p:panelGrid columns="2">
                                    <h:outputLabel value="Supplier Name:"/>
                                    <h:outputLabel value="#{pharmacyBillSearch.bill.fromInstitution.name}"/>
                                </p:panelGrid>
                            </p:panel>
                            <p:panel header="Bill Detail">
                                <p:panelGrid columns="2">
                                    <h:outputLabel value="Bill No:"/>
                                    <h:outputLabel value="#{pharmacyBillSearch.bill.deptId}"/>
                                    <h:outputLabel value="Total:"/>
                                    <h:outputLabel value="#{pharmacyBillSearch.bill.total}"/>
                                    <h:outputLabel value="Discount:"/>
                                    <h:outputLabel value="#{pharmacyBillSearch.bill.discount}"/>
                                    <h:outputLabel value="Net Total:"/>
                                    <h:outputLabel value="#{pharmacyBillSearch.bill.netTotal}"/>
                                </p:panelGrid>
                            </p:panel>
                        </p:panelGrid>

                        <!-- Bill Items -->
                        <p:panel header="Bill Item Detail">
                            <p:dataTable rowIndexVar="rowIndex" value="#{pharmacyBillSearch.bill.billItems}" var="bip">
                                <p:column>
                                    <f:facet name="header">No</f:facet>
                                    #{rowIndex+1}
                                </p:column>
                                <p:column>
                                    <f:facet name="header">Item</f:facet>
                                    #{bip.item.name}
                                </p:column>
                                <p:column>
                                    <f:facet name="header">Quantity in Units</f:facet>
                                    #{bip.pharmaceuticalBillItem.qty}
                                </p:column>
                                <p:column>
                                    <f:facet name="header">Free Quantity in Units</f:facet>
                                    #{bip.pharmaceuticalBillItem.freeQty}
                                </p:column>
                                <p:column>
                                    <f:facet name="header">Value</f:facet>
                                    #{bip.netValue}
                                </p:column>
                            </p:dataTable>
                        </p:panel>

                    </h:panelGroup>

                    <h:panelGroup rendered="#{pharmacyBillSearch.printPreview}">
                        <pharmacy:purhcase bill="#{pharmacyBillSearch.bill.cancelledBill}"/>
                    </h:panelGroup>

                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
