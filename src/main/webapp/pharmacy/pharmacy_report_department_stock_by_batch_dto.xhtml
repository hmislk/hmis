<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:common="http://xmlns.jcp.org/jsf/composite/ezcomp/common">

    <h:body>

        <ui:composition template="/pharmacy/pharmacy_analytics.xhtml">

            <ui:define name="subcontent">
                <h:form id="frm">

                    <p:panel header="Current Stock by Batch">

                        <common:institution_site_department_filter controller="#{reportsStock}"/>

                        <h:panelGrid columns="4" styleClass="w-100 form-grid my-2" columnClasses="label-icon-column, input-column">
                            <h:panelGroup layout="block" styleClass="form-group">
                                <h:outputText value="&#xf0e8;" styleClass="fa mr-2" />
                                <h:outputLabel value="Department Type" for="cmbDeptType" class="mx-3"/>
                            </h:panelGroup>
                            <p:selectOneMenu id="cmbDeptType" value="#{reportsStock.departmentType}" filter="true" filterMatchMode="contains" styleClass="w-100 form-control">
                                <f:selectItem itemLabel="All Department Types" itemValue="#{null}" />
                                <f:selectItems value="#{departmentTypeController.departmentTypes}" var="dt" itemLabel="#{dt.label}" itemValue="#{dt}" />
                            </p:selectOneMenu>
                            <p:spacer width="10" />
                            <p:spacer width="10" />
                        </h:panelGrid>

                        <h:panelGrid columns="6" class="my-2">
                            <p:commandButton ajax="false" value="Process" icon="fas fa-cogs" class="ui-button-warning"
                                             actionListener="#{reportsStock.fillDepartmentStockDtos()}" />
                            <p:commandButton class="mx-2 ui-button-danger" icon="fas fa-file-pdf" value="PDF" ajax="false">
                                <p:dataExporter type="pdf" target="tbl" fileName="stock_by_batch" />
                            </p:commandButton>
                            <p:commandButton icon="fas fa-file-excel" class="ui-button-success" value="Excel" ajax="false">
                                <p:dataExporter type="xlsx" target="tbl" fileName="stock_by_batch" />
                            </p:commandButton>
                            <p:commandButton value="Print" icon="fas fa-print" class="mx-2 ui-button-info"
                                             actionListener="#{reportsStock.prepareForPrint()}"
                                             oncomplete="$('#frm\\:print').click()" update=":frm:tbl" />
                            <p:commandButton id="print" value="Actual print" style="display: none">
                                <p:ajax event="click" listener="#{reportsStock.prepareForView()}" update=":frm:tbl" />
                                <p:printer target=":frm:tbl" />
                            </p:commandButton>
                        </h:panelGrid>

                        <h:panelGroup id="gpBillPreview" styleClass="noBorder summeryBorder" style="min-width: 100%!important;">

                            <p:dataTable id="tbl" rowIndexVar="ii"
                                         value="#{reportsStock.stockDtos}" var="i"
                                         rows="#{reportsStock.rows}"
                                         paginator="#{reportsStock.paginator}"
                                         paginatorPosition="bottom"
                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks}{NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="20, 50, 100">

                                <f:facet name="header">
                                    <h:outputLabel value="Batch Stock Report - #{reportsStock.department.name}" />
                                </f:facet>

                                <p:column headerText="Category" style="text-align: left;"
                                          sortBy="#{i.categoryName}"
                                          filterBy="#{i.categoryName}"
                                          filterMatchMode="contains">
                                    <f:facet name="header">
                                        <h:outputLabel value="Category" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.categoryName}" />
                                </p:column>

                                <p:column headerText="Item"
                                          sortBy="#{i.itemName}"
                                          filterBy="#{i.itemName}"
                                          filterMatchMode="contains">
                                    <f:facet name="header">
                                        <h:outputLabel value="Item" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.itemName}" style="width: 100px!important;" />
                                </p:column>

                                <p:column headerText="Type"
                                          sortBy="#{i.departmentType}"
                                          filterBy="#{i.departmentType}"
                                          filterMatchMode="contains">
                                    <f:facet name="header">
                                        <h:outputLabel value="Type" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.departmentType}" style="width: 100px!important;" />
                                </p:column>

                                <p:column headerText="Code" styleClass="averageNumericColumn"
                                          sortBy="#{i.code}"
                                          filterBy="#{i.code}"
                                          filterMatchMode="contains">
                                    <f:facet name="header">
                                        <h:outputLabel value="Code" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.code}" />
                                </p:column>

                                <p:column headerText="Generic Name"
                                          sortBy="#{i.genericName}"
                                          filterBy="#{i.genericName}"
                                          filterMatchMode="contains">
                                    <f:facet name="header">
                                        <h:outputLabel value="Generic Name" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.genericName}" />
                                </p:column>

                                <p:column headerText="Expiry" sortBy="#{i.dateOfExpire}">
                                    <f:facet name="header">
                                        <h:outputLabel value="Expiry" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.dateOfExpire}">
                                        <f:convertDateTime pattern="dd MMMM yyyy" />
                                    </h:outputLabel>
                                </p:column>

                                <p:column headerText="Batch No"
                                          sortBy="#{i.batchNo}"
                                          filterBy="#{i.batchNo}"
                                          filterMatchMode="contains">
                                    <f:facet name="header">
                                        <h:outputLabel value="Batch No" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.batchNo}" />
                                </p:column>

                                <p:column headerText="Stock" style="text-align: right;" styleClass="averageNumericColumn"
                                          sortBy="#{i.stockQty}">
                                    <f:facet name="header">
                                        <h:outputLabel value="Stock" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.stockQty}">
                                        <f:convertNumber pattern="#,##0.00" />
                                    </h:outputLabel>
                                </p:column>

                                <p:column headerText="Purchase Rate" style="text-align: right;" styleClass="averageNumericColumn"
                                          sortBy="#{i.purchaseRate}">
                                    <f:facet name="header">
                                        <h:outputLabel value="Purchase Rate" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.purchaseRate}">
                                        <f:convertNumber pattern="#,##0.00" />
                                    </h:outputLabel>
                                </p:column>

                                <p:column headerText="Purchase Value" style="text-align: right;" styleClass="averageNumericColumn"
                                          sortBy="#{i.purchaseRate * i.stockQty}">
                                    <f:facet name="header">
                                        <h:outputLabel value="Purchase Value" />
                                    </f:facet>
                                    <h:outputLabel value="#{i.purchaseRate * i.stockQty}">
                                        <f:convertNumber pattern="#,##0.00" />
                                    </h:outputLabel>
                                </p:column>

                <p:column headerText="Cost Rate" style="text-align: right;" styleClass="averageNumericColumn"
                          sortBy="#{i.costRate}">
                    <f:facet name="header">
                        <h:outputLabel value="Cost Rate" />
                    </f:facet>
                    <h:outputLabel value="#{i.costRate}">
                        <f:convertNumber pattern="#,##0.00" />
                    </h:outputLabel>
                </p:column>

                <p:column headerText="Cost Value" style="text-align: right;" styleClass="averageNumericColumn"
                          sortBy="#{i.costRate * i.stockQty}">
                    <f:facet name="header">
                        <h:outputLabel value="Cost Value" />
                    </f:facet>
                    <h:outputLabel value="#{i.costRate * i.stockQty}">
                        <f:convertNumber pattern="#,##0.00" />
                    </h:outputLabel>
                </p:column>

                <p:column headerText="Retail Rate" style="text-align: right;" styleClass="averageNumericColumn"
                          sortBy="#{i.retailRate}">
                    <f:facet name="header">
                        <h:outputLabel value="Retail Rate" />
                    </f:facet>
                    <h:outputLabel value="#{i.retailRate}">
                        <f:convertNumber pattern="#,##0.00" />
                    </h:outputLabel>
                </p:column>

                <p:column headerText="Retail Value" style="text-align: right;" styleClass="averageNumericColumn"
                          sortBy="#{i.retailRate * i.stockQty}">
                    <f:facet name="header">
                        <h:outputLabel value="Retail Value" />
                    </f:facet>
                    <h:outputLabel value="#{i.retailRate * i.stockQty}">
                        <f:convertNumber pattern="#,##0.00" />
                    </h:outputLabel>
                </p:column>

                <p:columnGroup type="footer">
                    <p:row>
                        <p:column colspan="9">
                            <f:facet name="footer">
                                <h:outputLabel value="Total" />
                            </f:facet>
                        </p:column>
                        <p:column style="text-align: right;">
                            <f:facet name="footer">
                                <h:outputLabel value="#{reportsStock.stockPurchaseValue}">
                                    <f:convertNumber pattern="#,##0.00" />
                                </h:outputLabel>
                            </f:facet>
                        </p:column>
        <!-- Blank column for Cost Rate -->
                        <p:column />
                        <p:column style="text-align: right;">
                            <f:facet name="footer">
                                <h:outputLabel value="#{reportsStock.stockCostValue}">
                                    <f:convertNumber pattern="#,##0.00" />
                                </h:outputLabel>
                            </f:facet>
                        </p:column>
        <!-- Blank column for Retail Rate -->
                        <p:column />
                        <p:column style="text-align: right;">
                            <f:facet name="footer">
                                <h:outputLabel value="#{reportsStock.stockSaleValue}">
                                    <f:convertNumber pattern="#,##0.00" />
                                </h:outputLabel>
                            </f:facet>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="14">
                            <f:facet name="footer">
                                <h:outputLabel value="Printed At " />
                                <h:outputLabel value="#{sessionController.currentDate}">
                                    <f:convertDateTime pattern="dd MMMM yyyy - hh:mm a" />
                                </h:outputLabel>
                            </f:facet>
                        </p:column>
                    </p:row>
                </p:columnGroup>

            </p:dataTable>
        </h:panelGroup>
    </p:panel>
    </h:form>

            </ui:define>

        </ui:composition>

    </h:body>
</html>

