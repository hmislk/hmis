<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"

       xmlns:h="http://xmlns.jcp.org/jsf/html"
       xmlns:f="http://xmlns.jcp.org/jsf/core"
       xmlns="http://www.w3.org/1999/xhtml"
       xmlns:in="http://xmlns.jcp.org/jsf/composite/inward"
       xmlns:p="http://primefaces.org/ui"
       xmlns:bi="http://xmlns.jcp.org/jsf/composite/inward/bill"
       xmlns:credit="http://xmlns.jcp.org/jsf/composite/inward/creditCompany"
       >

    <h:head>
        <title >Interim Bill</title>
    </h:head>


    <h:body>

        <ui:composition template="/resources/template/template.xhtml">
            <ui:define name="content">
                <h:form  >

                    <p:panel rendered="#{bhtSummeryController.patientEncounter eq null}">
                        <f:facet name="header">
                            <p:outputLabel value="Interim Bill" />

                        </f:facet>

                        <h:panelGrid columns="10">

                            <p:outputLabel value="Type Patient Name or BHT : " ></p:outputLabel>
                            <p:autoComplete  widgetVar="aPt" id="acPt" forceSelection="true" 
                                             required="true" requiredMessage="Please select a patient"
                                             value="#{bhtSummeryController.patientEncounter}"
                                             completeMethod="#{admissionController.completePatientDishcargedNotFinalized}" 
                                             var="myItem" itemValue="#{myItem}" 
                                             itemLabel="#{myItem.bhtNo}" 
                                             size="30"  
                                             class="m-2">
                                <p:column>
                                    #{myItem.bhtNo}
                                </p:column>
                                <p:column>
                                    #{myItem.patient.person.name}
                                </p:column>
                                <p:column>
                                    #{myItem.currentPatientRoom.roomFacilityCharge.name}
                                </p:column>


                            </p:autoComplete>   

                            <p:commandButton ajax="false"  
                                             value="Select" 
                                             class="ml-2"
                                             action="#{bhtSummeryController.createTables()}" >
                            </p:commandButton>

                        </h:panelGrid>
                    </p:panel>


                    <p:panel rendered="#{bhtSummeryController.patientEncounter ne null}">
                        <f:facet name="header">
                            <h:outputText styleClass="fas fa-file-invoice-dollar" />
                            <p:outputLabel value="Inward Payment Bill" class="mx-2"/>
                            <div columns="12" class="m-0 d-flex justify-content-end align-items-center" style="float:right;">
                                <p:commandButton 
                                    ajax="false" 
                                    value="Clear" 
                                    icon="fa-solid fa-eraser"
                                    class="ui-button-warning"
                                    action="#{bhtSummeryController.clear}"  />

                                <p:commandButton 
                                    ajax="false" 
                                    value="Settle Bill"
                                    icon="fa fa-check"
                                    class="ui-button-success mx-1"
                                    action="#{bhtSummeryController.toSettle()}"  />

                                <p:commandButton 
                                    ajax="false"   
                                    value="Print Bill" 
                                    icon="fas fa-print"
                                    class="ui-button-info"
                                    action="#{bhtSummeryController.toPrintItrim()}"  />


                                <p:commandButton 
                                    ajax="false"
                                    icon="fa fa-search"
                                    class="ui-button-warning  mx-1" 
                                    action="#{patientController.navigateToSearchPatients()}" 
                                    />

                                <p:commandButton 
                                    ajax="false"
                                    icon="fa fa-user"
                                    class="ui-button-warning  mx-1" 
                                    action="#{patientController.navigateToOpdPatientProfile()}" >

                                    <f:setPropertyActionListener 
                                        value="#{bhtSummeryController.patientEncounter.patient}" 
                                        target="#{patientController.current}" ></f:setPropertyActionListener>
                                </p:commandButton>
                                <p:commandButton 
                                    ajax="false"
                                    icon="fas fa-id-card"
                                    class="ui-button-secondary  mx-1" 
                                    action="#{bhtSummeryController.navigateToInpatientProfile()}" 
                                    >
                                    <f:setPropertyActionListener 
                                        value="#{bhtSummeryController.patientEncounter}" 
                                        target="#{admissionController.current}" ></f:setPropertyActionListener>
                                </p:commandButton>


                            </div>

                        </f:facet>



                        <h:panelGrid columns="1" rendered="#{bhtSummeryController.patientEncounter eq null}">
                            Please select a BHT and Click Display Details
                        </h:panelGrid>

                        <div class="row">
                            <div class="col-md-4">
                                <p:panel id="panSearch2" class="w-100">
                                    <f:facet name="header">
                                        <h:outputText styleClass="fa fa-user-circle"/>
                                        <p:outputLabel class="mx-2" value="Patient Details"/>
                                    </f:facet>

                                    <in:bhtDetail admission="#{bhtSummeryController.patientEncounter}" class="w-100"/>
                                </p:panel>
                            </div>
                            <div class="col-md-4" >
                                <h:panelGrid class="w-100" columns="1">
                                    <p:panel header="" id="tot" class="w-100">
                                        <f:facet name="header">
                                            <h:outputText styleClass="fas fa-chart-bar" />
                                            <p:outputLabel value="Summary" class="mx-2"/>
                                        </f:facet>

                                        <h:panelGroup id="crd" class="w-100" style="display: #{bhtSummeryController.patientEncounter.paymentMethod eq 'Credit' ? 'block' : 'none'} ; ">
                                            <credit:outputCredit  class="w-100" patientEncounter="#{bhtSummeryController.patientEncounter}"/>
                                        </h:panelGroup>


                                        <h:panelGrid columns="3" >
                                            <h:outputLabel  value="Total Charges"/>
                                            <h:outputLabel value=":" class="mx-2"/>
                                            <h:outputLabel value="#{bhtSummeryController.grantTotal}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>                               
                                            <h:outputLabel value="Paid By Patient   " />
                                            <h:outputLabel value=":" class="mx-2"/>
                                            <h:outputLabel value="#{bhtSummeryController.paid}" >
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>

                                            <h:outputLabel value="Due  " 
                                                           rendered="#{bhtSummeryController.patientEncounter.paymentMethod ne 'Credit' 
                                                                       and bhtSummeryController.due > 0 }" />
                                            <h:outputLabel value=":" class="mx-2"/>
                                            <h:outputLabel  value="#{bhtSummeryController.due}"
                                                            rendered="#{bhtSummeryController.patientEncounter.paymentMethod ne 'Credit' 
                                                                        and bhtSummeryController.due > 0 }" >
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </h:panelGrid>
                                    </p:panel>
                                    <p:panel id="dis" class="mt-2 ">
                                        <f:facet name="header">
                                            <h:outputText styleClass="fas fa-sign-out-alt" />
                                            <p:outputLabel value="Discharge" class="mx-2"/>
                                        </f:facet>
                                        <h:panelGrid columns="2">
                                            <p:outputLabel value="Discharge Time"/>

                                            <p:datePicker 
                                                value="#{bhtSummeryController.date}"
                                                id="dischargeTimeStamp"
                                                pattern="#{sessionController.applicationPreference.longDateTimeFormat}" 
                                                class="mx-2"
                                                showTime="true"
                                                showButtonBar="true"
                                                timeInput="true">                               
                                                <!--                                                <f:ajax execute="@this" 
                                                                                                        render="sum tvPt tot"
                                                                                                        event="dateSelect" 
                                                                                                        listener="#{bhtSummeryController.checkDate}" />-->
                                            </p:datePicker>
                                        </h:panelGrid>
                                        <div class="d-flex justify-content-end my-2">
                                            <p:commandButton 
                                                ajax="false" 
                                                style="float: right;"
                                                value="Recalculate" 
                                                action="#{bhtSummeryController.createTables()}"  />
                                            <p:commandButton 
                                                ajax="false" 
                                                rendered="false" 
                                                value="Add Vat" 
                                                class="mx-1"
                                                action="#{bhtSummeryController.addVat}"  />

                                            <p:commandButton 
                                                ajax="false" 
                                                value="Discharge" 
                                                class="mx-1 ui-button-success"
                                                action="#{bhtSummeryController.discharge}"  />

                                            <p:commandButton 
                                                ajax="false" 
                                                value="Discharge Cancel" 
                                                class=" ui-button-warning"
                                                action="#{bhtSummeryController.dischargeCancel}"  />
                                        </div>
                                    </p:panel>
                                </h:panelGrid>
                            </div>
                            <div class="col-md-4">
                                <p:dataTable id="sum" 
                                             value="#{bhtSummeryController.chargeItemTotals}" 
                                             var="c" 
                                             scrollHeight="350"
                                             scrollable="true"
                                             scrollRows="10"
                                             >
                                    <f:facet name="header">
                                        <h:outputText styleClass="fas fa-money-bill" />
                                        <p:outputLabel value="Charges" class="mx-2"/>
                                    </f:facet>
                                    <p:column headerText="Charge Type" >
                                        <h:outputLabel value="#{c.inwardChargeType.label}"/>
                                    </p:column>
                                    <p:column  sortBy="#{c.total}"  headerText="Total">
                                        <h:outputLabel value="#{c.total}">
                                            <f:convertNumber pattern="#,##0.00"/>
                                        </h:outputLabel>
                                    </p:column>
                                </p:dataTable>

                            </div>
                        </div>

                        <p:panel class="mt-2" >
                            <f:facet name="header">
                                <h:outputText styleClass="fas fa-info-circle" />
                                <p:outputLabel value="Fees and Details" class="mx-2"/>
                            </f:facet>
                            <p:tabView  id="tvPt"  rendered="#{bhtSummeryController.patientEncounter ne null}" >                     
                                <p:tab id="tabNewPt" title="Room Details" >

                                    <p:dataTable  value="#{bhtSummeryController.patientRooms}" var="rm" style="min-width:10em;">
                                        <p:column headerText="Room">
                                            <h:outputLabel value="#{rm.roomFacilityCharge.name}" style="display: inline;"/>

                                            <h:outputText value="&#xf058;" escape="false" 
                                                          styleClass="fa" 
                                                          rendered="#{rm.discharged}" 
                                                          title="Discharged" style="color: green; margin-left: 5px; display: inline;"/>

                                            <h:outputText value="&#xf057;" escape="false" 
                                                          styleClass="fa" 
                                                          rendered="#{not rm.discharged}" 
                                                          title="Not Discharged" style="color: red; margin-left: 5px; display: inline;"/>

                                            <h:outputLabel value="&nbsp;-&nbsp;GAURDIAN ROOM" style="color: #008000; display: inline;"
                                                           rendered="#{rm.patientRoomClass eq 'class com.divudi.entity.inward.GuardianRoom'}"/>
                                        </p:column>
                                        <p:column headerText="Admission" style="min-width:10em;">
                                            <p:datePicker   
                                                id="roomAdmittedTimeStamp"
                                                value="#{rm.admittedAt}" 
                                                showTime="true"
                                                showButtonBar="true"
                                                timeInput="true"
                                                pattern="#{sessionController.applicationPreference.shortDateTimeFormat}"
                                                size="11"/>     
                                        </p:column>
                                        <p:column headerText="Discharge" style="min-width:10em;" >                                      
                                            <p:datePicker   
                                                showTime="true"
                                                showButtonBar="true"
                                                timeInput="true"
                                                id="roomDischargeTimeStamp"
                                                value="#{rm.dischargedAt}" 
                                                pattern="#{sessionController.applicationPreference.shortDateTimeFormat}"
                                                size="11"/> 
                                        </p:column>
                                        <p:column headerText="Room"   style="width: 5em; text-align: right;" >
                                            <h:outputLabel value="#{rm.calculatedRoomCharge}" style="text-align: center" >
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>                                        
                                        </p:column>
                                        <p:column headerText="Maintain"  style="width: 5em; text-align: right;" >
                                            <h:outputLabel value="#{rm.calculatedMaintainCharge}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>    
                                        <p:column headerText="MO"   style="width: 5em; text-align: right;">
                                            <h:outputLabel  value="#{rm.calculatedMoCharge}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>                                        
                                        <p:column headerText="Nursing"   style="width: 5em; text-align: right;">
                                            <h:outputLabel value="#{rm.calculatedNursingCharge}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column> 
                                        <p:column headerText="Linen"  style="width: 5em; text-align: right;">
                                            <h:outputLabel value="#{rm.calculatedLinenCharge}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column> 
                                        <p:column headerText="Admin"  style="width: 5em; text-align: right;">
                                            <h:outputLabel value="#{rm.calculatedAdministrationCharge}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column> 
                                        <p:column headerText="Madical" style="width: 5em; text-align: right;">
                                            <h:outputLabel value="#{rm.calculatedMedicalCareCharge}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>                                
                                        <p:column headerText="Actions"  style="width: 10em;">
                                            <div class="d-inline-flex"> <!-- Bootstrap class for inline flex container -->
                                                <!-- Discharge Button -->
                                                <p:commandButton ajax="false" 
                                                                 icon="fa fa-check-square" 
                                                                 title="Discharge"
                                                                 class="ui-button-warning" 
                                                                 action="#{roomChangeController.dischargeWithCurrentTime(rm)}" />

                                                <!-- Cancel Discharge Button -->
                                                <p:commandButton ajax="false" 
                                                                 icon="fa fa-times-circle" 
                                                                 title="Cancel Discharge"
                                                                 class="ui-button-warning mx-2"
                                                                 action="#{roomChangeController.dischargeCancel(rm)}" />
                                                <!-- Update Charges Button -->
                                                <p:commandButton ajax="false" 
                                                                 icon="fa fa-pencil-square" 
                                                                 title="Update Charges"
                                                                 action="#{bhtSummeryController.updatePatientRoom(rm)}" 
                                                                 class="ui-button-info" /> <!-- me-1 for margin-right -->


                                            </div>
                                        </p:column>




                                    </p:dataTable>
                                </p:tab>


                                <p:tab id="tabTimed" title="Timed Service Details"  >  
                                    <p:dataTable  value="#{bhtSummeryController.patientItems}" var="pt">
                                        <p:column headerText="Service Name">
                                            <h:outputLabel value="#{pt.item.name}"/>
                                        </p:column>
                                        <p:column headerText="Start Time">
                                            <p:calendar navigator="true"  
                                                        id="serviceStartTimeStamp"
                                                        value="#{pt.fromTime}" 
                                                        pattern="dd/MM/yyyy  hh:mm:ss a" />           
                                        </p:column>
                                        <p:column headerText="Stopped Time">
                                            <p:calendar navigator="true"  
                                                        id="serviceStoppedTimeStamp"
                                                        value="#{pt.toTime}" 
                                                        pattern="dd/MM/yyyy  hh:mm:ss a" />                                    
                                        </p:column>
                                        <p:column headerText="Total" >
                                            <h:outputLabel value="#{pt.serviceValue}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>   
                                        <p:column headerText="Creator" >
                                            <h:outputLabel value="#{pt.creater.webUserPerson.name}"/>     
                                            <br/>
                                            <h:panelGroup rendered="#{ti.retired}" >
                                                <h:outputLabel style="color: red;" value="Deleted By " />
                                                <h:outputLabel style="color: red;"  value="#{pt.retirer.webUserPerson.name}" >                                       
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>     
                                        <p:column headerText="Inward Charge Type">
                                            <h:outputLabel value="#{pt.item.inwardChargeType}"/>                                        
                                        </p:column>   
                                        <p:column >
                                            <p:commandButton ajax="false" value="Update" 
                                                             action="#{bhtSummeryController.updatePatientItem(pt)}" />
                                        </p:column>
                                        <p:column>
                                            <p:commandButton ajax="false" value="Remove "  
                                                             action="#{surgeryBillController.removeTimeService(pt)}" />
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>

                                <p:tab id="tabSer" title="Service Details"  >                            
                                    <p:dataTable id="service" scrollable="true" scrollHeight="300" 
                                                 value="#{bhtSummeryController.departmentBillItems}" var="dep">
                                        <p:columnGroup type="header">
                                            <p:row>
                                                <p:column >
                                                    <f:facet name="header">
                                                        <h:outputLabel value="Item Name"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column >
                                                    <f:facet name="header">
                                                        <h:outputLabel value="Count"/>

                                                    </f:facet>
                                                </p:column>     
                                                <p:column >
                                                    <f:facet name="header">
                                                        <h:outputLabel value="Checked Count"/>
                                                    </f:facet>
                                                </p:column>  
                                                <p:column >
                                                    <f:facet name="header">
                                                        <h:outputLabel value="Inward Charge Type"/>

                                                    </f:facet>
                                                </p:column>     
                                                <p:column >
                                                    <f:facet name="header">
                                                        <h:outputLabel value="View Bill"/>

                                                    </f:facet>
                                                </p:column>

                                            </p:row>
                                        </p:columnGroup>

                                        <p:subTable value="#{dep.items}" var="ser">
                                            <f:facet name="header">
                                                <h:outputLabel value="#{dep.department.name}"/>
                                            </f:facet>
                                            <p:column>
                                                <h:outputLabel value="#{ser.name}" rendered="#{ser.transBillItemCount ne 0}"/>                                        
                                            </p:column>
                                            <p:column>
                                                <h:outputLabel value="#{ser.transBillItemCount}" rendered="#{ser.transBillItemCount ne 0}"/>
                                            </p:column>    
                                            <p:column>
                                                <h:outputLabel value="#{ser.transCheckedCount}" rendered="#{ser.transBillItemCount ne 0}"/>
                                            </p:column>    
                                            <p:column>
                                                <h:outputLabel value="#{ser.inwardChargeType}" rendered="#{ser.transBillItemCount ne 0}"/>                                        
                                            </p:column>
                                            <p:column>
                                                <p:commandButton ajax="false" rendered="#{ser.transBillItemCount ne 0}"
                                                                 action="inward_edit_bill_item_view"   
                                                                 value="View Bill Items"  > 
                                                    <f:setPropertyActionListener value="#{ser}" target="#{bhtSummeryController.item}"/>
                                                </p:commandButton>
                                            </p:column>
                                        </p:subTable>
                                    </p:dataTable>
                                </p:tab>

                                <p:tab title="Medicine Issue">                          
                                    <p:dataTable value="#{bhtSummeryController.pharmacyIssues}" var="iss" scrollable="true"
                                                 scrollHeight="300"
                                                 rowStyleClass="#{((iss.billClass eq 'class com.divudi.entity.PreBill')
                                                                  or 
                                                                  (iss.billedBill ne null 
                                                                  and iss.billClass eq 'class com.divudi.entity.RefundBill'))? '':'noDisplayRow'}">
                                        <p:column headerText="Bill No">

                                            #{iss.deptId}
                                        </p:column>                               
                                        <p:column headerText="Bill Total" >
                                            <h:outputLabel  value="#{iss.netTotal}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column headerText="Billed Date">
                                            <h:outputLabel value="#{iss.createdAt}">
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.shortDateFormat}" />
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{iss.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{iss.cancelled}" 
                                                               value="#{iss.cancelledBill.createdAt}" >
                                                    <f:convertDateTime pattern="#{sessionController.applicationPreference.longDateFormat}"/>
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Billed Time" >
                                            <h:outputLabel value="#{iss.createdAt}">
                                                <f:convertDateTime pattern="#{sessionController.applicationPreference.longTimeFormat}"/>
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{iss.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{iss.cancelled}" 
                                                               value="#{iss.cancelledBill.createdAt}" >
                                                    <f:convertDateTime pattern="#{sessionController.applicationPreference.longTimeFormat}"/>
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Billed By">
                                            <h:outputLabel value="#{iss.creater.webUserPerson.name}"/>     
                                            <br/>
                                            <h:panelGroup rendered="#{iss.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled By " />
                                                <h:outputLabel style="color: red;" rendered="#{iss.cancelled}" 
                                                               value="#{iss.cancelledBill.creater.webUserPerson.name}" >                                       
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>  
                                        <p:column headerText="Checked By">
                                            <h:outputLabel value="#{iss.checkedBy.webUserPerson.name}"/>     
                                        </p:column>  
                                        <p:column headerText="Checked At">
                                            <h:outputLabel value="#{iss.checkeAt}">
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>      
                                        </p:column>  
                                        <p:column>
                                            <p:commandButton ajax="false" action="pharmacy_reprint_bill_sale_bht" 
                                                             rendered="#{iss.billClass eq 'class com.divudi.entity.PreBill'}" value="View Issue"  >                                              
                                                <f:setPropertyActionListener value="#{iss}" target="#{pharmacyBillSearch.bill}"/>
                                            </p:commandButton>
                                            <p:commandButton ajax="false" action="pharmacy_reprint_bill_return_bht" 
                                                             rendered="#{iss.billClass eq 'class com.divudi.entity.RefundBill'}"
                                                             value="View Return"  >                                              
                                                <f:setPropertyActionListener value="#{iss}" target="#{pharmacyBillSearch.bill}"/>
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>

                                <p:tab title="Store Issue">                          
                                    <p:dataTable value="#{bhtSummeryController.storeIssues}" var="iss" scrollable="true"
                                                 scrollHeight="300"
                                                 rowStyleClass="#{((iss.billClass eq 'class com.divudi.entity.PreBill')
                                                                  or 
                                                                  (iss.billedBill ne null 
                                                                  and iss.billClass eq 'class com.divudi.entity.RefundBill'))? '':'noDisplayRow'}">
                                        <p:column headerText="Bill No">

                                            #{iss.deptId}
                                        </p:column>                               
                                        <p:column headerText="Bill Total" >
                                            <h:outputLabel  value="#{iss.netTotal}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column headerText="Billed Date">
                                            <h:outputLabel value="#{iss.createdAt}">
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.shortDateFormat}" />
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{iss.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{iss.cancelled}" 
                                                               value="#{iss.cancelledBill.createdAt}" >
                                                    <f:convertDateTime pattern="#{sessionController.applicationPreference.longDateFormat}"/>
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Billed Time" >
                                            <h:outputLabel value="#{iss.createdAt}">
                                                <f:convertDateTime pattern="#{sessionController.applicationPreference.longTimeFormat}"/>
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{iss.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{iss.cancelled}" 
                                                               value="#{iss.cancelledBill.createdAt}" >
                                                    <f:convertDateTime pattern="#{sessionController.applicationPreference.longTimeFormat}"/>
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Billed By">
                                            <h:outputLabel value="#{iss.creater.webUserPerson.name}"/>     
                                            <br/>
                                            <h:panelGroup rendered="#{iss.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled By " />
                                                <h:outputLabel style="color: red;" rendered="#{iss.cancelled}" 
                                                               value="#{iss.cancelledBill.creater.webUserPerson.name}" >                                       
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>  
                                        <p:column headerText="Checked By">
                                            <h:outputLabel value="#{iss.checkedBy.webUserPerson.name}"/>     
                                        </p:column>  
                                        <p:column headerText="Checked At">
                                            <h:outputLabel value="#{iss.checkeAt}">
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>      
                                        </p:column>  
                                        <p:column>
                                            <p:commandButton ajax="false" action="store_reprint_bill_sale_bht" 
                                                             rendered="#{iss.billClass eq 'class com.divudi.entity.PreBill'}" value="View Issue"  >                                              
                                                <f:setPropertyActionListener value="#{iss}" target="#{storeBillSearch.bill}"/>
                                            </p:commandButton>
                                            <p:commandButton ajax="false" action="store_reprint_bill_return_bht" 
                                                             rendered="#{iss.billClass eq 'class com.divudi.entity.RefundBill'}"
                                                             value="View Return"  >                                              
                                                <f:setPropertyActionListener value="#{iss}" target="#{storeBillSearch.bill}"/>
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>

                                <p:tab id="tabAdd" title="Out Side Charge Details"  >
                                    <p:dataTable    scrollable="true" scrollHeight="300" 
                                                    value="#{bhtSummeryController.additionalChargeBill}" var="bil"
                                                    rowStyleClass="#{((bil.billClass eq 'class com.divudi.entity.BilledBill')
                                                                     or 
                                                                     (bil.billedBill eq null 
                                                                     and bil.billClass eq 'class com.divudi.entity.RefundBill'))? '':'noDisplayRow'}">
                                        <p:column headerText="Name">
                                            #{bil.comments}
                                        </p:column>
                                        <p:column headerText="Cost" >
                                            <h:outputLabel  value="#{bil.total}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>

                                        <p:column headerText="Added Date">
                                            <h:outputLabel value="#{bil.createdAt}">
                                                <f:convertDateTime  
                                                    timeZone="Asia/Colombo" 
                                                    pattern="#{sessionController.applicationPreference.shortDateFormat}" />
                                            </h:outputLabel>                                                  
                                            <br/>
                                            <h:panelGroup rendered="#{bil.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{bil.cancelled}" 
                                                               value="#{bil.cancelledBill.createdAt}" >
                                                    <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.shortDateFormat}" />
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Added Time">
                                            <h:outputLabel value="#{bil.createdAt}">
                                                <f:convertDateTime pattern="#{sessionController.applicationPreference.longTimeFormat}"/>
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{bil.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{bil.cancelled}" 
                                                               value="#{bil.cancelledBill.createdAt}" >
                                                    <f:convertDateTime pattern="#{sessionController.applicationPreference.longTimeFormat}"/>
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Added User">
                                            <h:outputLabel value="#{bil.creater.webUserPerson.name}"/>     
                                            <br/>
                                            <h:panelGroup rendered="#{bil.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled By " />
                                                <h:outputLabel style="color: red;" rendered="#{bil.cancelled}" 
                                                               value="#{bil.cancelledBill.creater.webUserPerson.name}" >                                       
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Checked User">
                                            <h:outputLabel value="#{bil.checkedBy.webUserPerson.name}"/>                                        
                                        </p:column>
                                        <p:column headerText="Checked Time">
                                            <h:outputLabel value="#{bil.checkeAt}">
                                                <f:convertDateTime pattern="yy mm dd hh mm ss a"/>
                                            </h:outputLabel>                                                                                      
                                        </p:column>
                                        <p:column headerText="Inward Charge Type">
                                            <h:outputLabel  value="#{bil.singleBillItem.inwardChargeType}">                                     
                                            </h:outputLabel>
                                        </p:column>

                                        <p:column>
                                            <p:commandButton ajax="false" action="inward_reprint_bill" value="View Bill" >                                        
                                                <f:setPropertyActionListener value="#{bil}" target="#{inwardSearch.bill}"/>
                                            </p:commandButton>

                                        </p:column>

                                    </p:dataTable>
                                </p:tab>



                                <p:tab id="tabPro" title="Professional Fees"  >
                                    <p:dataTable  scrollable="true" scrollHeight="300"  
                                                  value="#{bhtSummeryController.profesionallFee}" var="pf"
                                                  rowStyleClass="#{pf.bill.billClass eq 'class com.divudi.entity.BilledBill' ? '':'noDisplayRow'}">
                                        <p:column headerText="Name">
                                            #{pf.staff.person.nameWithTitle}
                                        </p:column>
                                        <p:column headerText="Fee Value" >
                                            <h:outputLabel value="#{pf.feeValue}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column headerText="Fee At">
                                            <h:outputLabel value="#{pf.feeAt}">
                                                <f:convertDateTime pattern="dd MMMM yyyy hh mm ss a"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column headerText="Added Time">                                      
                                            <h:outputLabel value="#{pf.createdAt}">
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{pf.bill.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{pf.bill.cancelled}" 
                                                               value="#{pf.bill.cancelledBill.createdAt}" >
                                                    <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Added User">
                                            <h:outputLabel value="#{pf.bill.creater.webUserPerson.name}"/>     
                                            <br/>
                                            <h:panelGroup rendered="#{pf.bill.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled By " />
                                                <h:outputLabel style="color: red;" rendered="#{pf.bill.cancelled}" 
                                                               value="#{pf.bill.cancelledBill.creater.webUserPerson.name}" >                                       
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Checked User">
                                            <h:outputLabel value="#{pf.bill.checkedBy.creater.webUserPerson.name}"/>                                         
                                        </p:column>
                                        <p:column headerText="Checked At">
                                            <h:outputLabel value="#{pf.bill.checkeAt}">                                         
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column>
                                            <p:commandButton ajax="false" action="inward_reprint_bill_professional" value="View " >                                        
                                                <f:setPropertyActionListener value="#{pf.bill}" target="#{inwardSearch.bill}"/>
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>


                                <p:tab id="tabDoc" title="Assisting Fees"  >
                                    <p:dataTable  scrollable="true" scrollHeight="300"  value="#{bhtSummeryController.doctorAndNurseFee}" var="pf"
                                                  rowStyleClass="#{pf.bill.billClass eq 'class com.divudi.entity.BilledBill' ? '':'noDisplayRow'}">
                                        <p:column headerText="Name">
                                            #{pf.staff.person.nameWithTitle}
                                        </p:column>
                                        <p:column headerText="Fee Value" >
                                            <h:outputLabel value="#{pf.feeValue}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column headerText="Fee At">
                                            <h:outputLabel value="#{pf.feeAt}">
                                                <f:convertDateTime pattern="dd MMMM yyyy hh mm ss a"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column headerText="Added Time">                                      
                                            <h:outputLabel value="#{pf.createdAt}">
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{pf.bill.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{pf.bill.cancelled}" 
                                                               value="#{pf.bill.cancelledBill.createdAt}" >
                                                    <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Added User">
                                            <h:outputLabel value="#{pf.creater.webUserPerson.name}"/>     
                                            <br/>
                                            <h:panelGroup rendered="#{pf.bill.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled By " />
                                                <h:outputLabel style="color: red;" rendered="#{pf.bill.cancelled}" 
                                                               value="#{pf.bill.cancelledBill.creater.webUserPerson.name}" >                                       
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Checked User">
                                            <h:outputLabel value="#{pf.bill.checkedBy.creater.webUserPerson.name}"/>                                         
                                        </p:column>
                                        <p:column headerText="Checked At">
                                            <h:outputLabel value="#{pf.bill.checkeAt}">                                         
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column>
                                            <p:commandButton ajax="false" action="inward_reprint_bill_professional" value="View Bill" >
                                                <f:setPropertyActionListener value="#{pf.bill}" target="#{inwardSearch.bill}"/>
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>

                                <p:tab id="tabP" title="Payments"  >
                                    <p:dataTable  scrollable="true" scrollHeight="300"  
                                                  value="#{bhtSummeryController.paymentBill}" 
                                                  var="p"
                                                  rowStyleClass="#{((p.billClass eq 'class com.divudi.entity.BilledBill')
                                                                   or 
                                                                   (p.refundedBill eq null and p.billClass eq 'class com.divudi.entity.RefundBill'))? '':'noDisplayRow'}" >
                                        <p:column headerText="Bill No">
                                            #{p.insId}
                                        </p:column>

                                        <p:column headerText="Paid At">  
                                            <h:outputLabel value="#{p.createdAt}">
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{p.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{p.cancelled}" 
                                                               value="#{p.cancelledBill.createdAt}" >
                                                    <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Added User">
                                            <h:outputLabel value="#{p.creater.webUserPerson.name}"/>     
                                            <br/>
                                            <h:panelGroup rendered="#{p.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled By " />
                                                <h:outputLabel style="color: red;" rendered="#{p.cancelled}" 
                                                               value="#{p.cancelledBill.creater.webUserPerson.name}" >                                       
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Value" >
                                            <h:outputLabel  value="#{p.netTotal}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column headerText="Checked User">
                                            <h:outputLabel value="#{p.checkedBy.creater.webUserPerson.name}"/>                                         
                                        </p:column>
                                        <p:column headerText="Checked At">
                                            <h:outputLabel value="#{p.checkeAt}">                                         
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column>
                                            <p:commandButton ajax="false" action="inward_reprint_bill_payment" value="View Bill" >
                                                <f:setPropertyActionListener value="#{p}" target="#{inwardSearch.bill}"/>
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>

                            </p:tabView>
                        </p:panel>


                    </p:panel>














                </h:form>





            </ui:define>

        </ui:composition>

    </h:body>

</html>

