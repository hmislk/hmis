<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>
        <ui:composition template="/resources/template/template.xhtml">
            <ui:define name="content">
                <h:form >
                    <style>
                        /* ================= SCREEN VIEW ================= */
                        @media screen {

                            .paper {
                                width: 95%;
                                margin: auto;
                            }

                            .header {
                                text-align: center;
                                margin-bottom: 15px;
                            }

                            table {
                                width: 100%;
                                font-size: 13px;
                                border-collapse: collapse;

                            }

                            th, td {

                                padding: 4px;
                                text-align: center;
                            }

                            .grand-total-row td {
                                background-color: #ebebef;
                                font-weight: bold !important;
                            }

                            .total-column {
                                background-color: #a0a0a0 !important;
                                font-weight: bold !important;
                            }
                        }


                        /* ================= PRINT VIEW ================= */
                        @media print {

                            @page {
                                size: A4 landscape;
                                margin: 10mm;
                            }

                            body {
                                margin: 0;
                                padding: 0;
                                -webkit-print-color-adjust: exact;
                                print-color-adjust: exact;
                            }

                            .paper {
                                width: 100%;
                            }

                            .header {
                                text-align: center;
                                margin-bottom: 5mm;

                            }

                            table {
                                width: 100%;
                                font-size: 9px;
                                border-collapse: collapse;
                                border: none !important;
                            }

                            th, td {

                                padding: 3px;
                                text-align: center;
                                border: none !important;
                            }


                            thead {
                                display: table-header-group;
                            }

                            tr {
                                page-break-inside: avoid;
                            }

                            .grand-total-row td {
                                background-color: #ebebef;
                                font-weight: bold !important;
                            }

                            .total-column {
                                background-color: #a0a0a0 !important;
                                font-weight: bold !important;
                            }

                        }
                    </style>

                    <h:panelGroup rendered="#{inwardReportController.reportType eq 'SUMMARY'}">
                        <p:panel header="Surgery Survey Summary Report Print" styleClass="my-2" >
                            <f:facet name="header">
                                <div class="d-flex justify-content-between">
                                    <h:outputText value="Surgery Survey Summary Report Print" class="mt-2"/>
                                    <div class="d-flex gap-2">
                                        <p:commandButton 
                                            icon="fa-solid fa-print"
                                            class="ui-button-info"
                                            style="width: 150px"
                                            ajax="false" 
                                            value="Print">
                                            <p:printer target="summaryRp" />
                                        </p:commandButton>
                                        <p:commandButton 
                                            ajax="false" 
                                            value="Back to Report" 
                                            style="width: 200px"
                                            icon="fa fa-arrow-left"
                                            class="ui-button-warning"
                                            action="/reports/managementReports/surgery_survey?faces-redirect=true">
                                        </p:commandButton>
                                    </div>
                                </div>
                            </f:facet>
                        </p:panel>

                        <h:panelGroup id="summaryRp" layout="block" styleClass="paper">

                            <div class="header">

                                <div style="font-weight:700; font-size:22px;">
                                    <h:outputText value="#{inwardReportController.institution.name}" />
                                </div>

                                <div style="font-weight:700; font-size:18px;">
                                    <h:outputText value="Surgery Survey Summary Report" />
                                    <h:panelGroup rendered="#{inwardReportController.department ne null}">
                                        -
                                        <h:outputText value="#{inwardReportController.department.name}" />
                                    </h:panelGroup>
                                </div>

                                <div style="font-size:12px; margin-top:5px;">
                                    <strong>From Date : </strong>
                                    <h:outputText value="#{inwardReportController.fromDate}">
                                        <f:convertDateTime pattern="#{sessionController.applicationPreference.longDateFormat}" />
                                    </h:outputText>

                                    &nbsp;&nbsp;&nbsp;

                                    <strong>To Date : </strong>
                                    <h:outputText value="#{inwardReportController.toDate}">
                                        <f:convertDateTime pattern="#{sessionController.applicationPreference.longDateFormat}" />
                                    </h:outputText>
                                </div>

                            </div>

                            <p:dataTable
                                id="summaryTable"
                                value="#{inwardReportController.monthlySurgeryCountList}"
                                var="row"
                                rowStyleClass="#{row.grandTotal ? 'grand-total-row' : ''}"
                                styleClass="table-sm text-center"
                                >


                                <p:column headerText="Month" styleClass="text-start" >
                                    <h:outputText 
                                        value="#{row.grandTotal ? 'Grand Total' : row.monthName}" />
                                </p:column>


                                <p:columns
                                    value="#{inwardReportController.surgeryHeaders}"
                                    var="surgeryType"
                                    headerText="#{surgeryType}"
                                    styleClass="text-center"
                                    >

                                    <h:outputText
                                        value="#{row.serviceCountMap[surgeryType]}" />
                                </p:columns>

                                <p:column
                                    headerText="Total"
                                    styleClass="text-center total-column"
                                    >

                                    <h:outputText value="#{row.total}" />
                                </p:column>

                            </p:dataTable>

                        </h:panelGroup>

                    </h:panelGroup> 

                    <h:panelGroup rendered="#{inwardReportController.reportType eq 'DETAIL'}">
                        <p:panel header="Surgery Survey Detail Report Print" styleClass="my-2" >
                            <f:facet name="header">
                                <div class="d-flex justify-content-between">
                                    <h:outputText value="Surgery Survey Detail Report Print" class="mt-2"/>
                                    <div class="d-flex gap-2">
                                        <p:commandButton 
                                            icon="fa-solid fa-print"
                                            class="ui-button-info"
                                            style="width: 150px"
                                            ajax="false" 
                                            value="Print">
                                            <p:printer target="detailRp" />
                                        </p:commandButton>
                                        <p:commandButton 
                                            ajax="false" 
                                            value="Back to Report" 
                                            style="width: 200px"
                                            icon="fa fa-arrow-left"
                                            class="ui-button-warning"
                                            action="/reports/managementReports/surgery_survey?faces-redirect=true">
                                        </p:commandButton>
                                    </div>
                                </div>
                            </f:facet>
                        </p:panel>

                        <h:panelGroup id="detailRp" layout="block" styleClass="paper">

                            <div class="header">

                                <div style="font-weight:700; font-size:22px;">
                                    <h:outputText value="#{inwardReportController.institution.name}" />
                                </div>

                                <div style="font-weight:700; font-size:18px;">
                                    <h:outputText value="Surgery Survey Detail Report" />
                                    <h:panelGroup rendered="#{inwardReportController.department ne null}">
                                        -
                                        <h:outputText value="#{inwardReportController.department.name}" />
                                    </h:panelGroup>
                                </div>

                                <div style="font-size:12px; margin-top:5px;">
                                    <strong>From Date : </strong>
                                    <h:outputText value="#{inwardReportController.fromDate}">
                                        <f:convertDateTime pattern="#{sessionController.applicationPreference.longDateFormat}" />
                                    </h:outputText>

                                    &nbsp;&nbsp;&nbsp;

                                    <strong>To Date : </strong>
                                    <h:outputText value="#{inwardReportController.toDate}">
                                        <f:convertDateTime pattern="#{sessionController.applicationPreference.longDateFormat}" />
                                    </h:outputText>
                                </div>

                            </div>

                            <p:dataTable
                                id="detailWise"
                                value="#{inwardReportController.monthlySurgeryCountList}"
                                var="row"
                                rowStyleClass="#{row.grandTotal ? 'grand-total-row' : ''}"
                                styleClass="text-center">

                                <!-- Month Column -->
                                <p:column headerText="Month" styleClass="text-start">
                                    <h:outputText 
                                        value="#{row.grandTotal ? 'Grand Total' : row.monthName}" 
                                        />
                                </p:column>

                                <!-- Dynamic Surgery Columns -->
                                <p:columns
                                    value="#{inwardReportController.surgeryHeaders}"
                                    var="surgery"
                                    headerText="#{surgery}"
                                    styleClass="text-center">

                                    <h:outputText
                                        value="#{row.serviceCountMap[surgery]}"
                                        />
                                </p:columns>

                                <!-- Total Column -->
                                <p:column headerText="Total"
                                          styleClass="text-center total-column"
                                          >
                                    <h:outputText value="#{row.total}" />
                                </p:column>

                            </p:dataTable>

                        </h:panelGroup>

                    </h:panelGroup>   
                </h:form>

            </ui:define>
        </ui:composition>

    </h:body>
</html>
