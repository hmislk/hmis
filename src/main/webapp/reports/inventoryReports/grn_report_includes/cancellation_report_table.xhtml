<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:body>
        <ui:composition>


            <h:panelGroup class="m-4" rendered="#{pharmacyController.reportType eq 'cancellationReport'}">
                <h5>GRN Cancellation</h5>
                <p:dataTable id="tbl4" value="#{pharmacyController.bills}"
                             var="cb"
                             rowIndexVar="n"
                             paginator="true"
                             rows="10"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="Showing {startRecord} to {endRecord} of {totalRecords}"
                             rowsPerPageTemplate="5,10,15,25,50,100,500,1000">
                    <p:column headerText="GRN Canceled No" width="6em">
                        <p:commandLink
                            style="border-bottom: #003c36;"
                            ajax="false"
                            value="#{cb.deptId}"
                            action="/pharmacy/pharmacy_reprint_grn_return">
                            <f:setPropertyActionListener target="#{pharmacyBillSearch.bill}" value="#{cb}"/>
                        </p:commandLink>
                        <f:facet name="footer">
                            <h:outputText value="Total"/>
                        </f:facet>
                    </p:column>
                    <p:column headerText="GRN No" width="6em">
                        <p:commandLink
                            ajax="false"
                            value="#{cb.referenceBill.deptId}"
                            action="/pharmacy/pharmacy_grn">
                            <f:setPropertyActionListener value="#{cb.referenceBill}"
                                                         target="#{grnController.grnBill}"/>
                            <f:setPropertyActionListener value="true" target="#{grnController.printPreview}"/>
                        </p:commandLink>
                    </p:column>
                    <p:column headerText="GRN Invoice No" width="6em"
                              style="text-align: right; padding-right: 20px;">
                        <h:outputText value="#{cb.invoiceNumber}"/>
                    </p:column>
                    <p:column headerText="GRN Date" width="6em">
                        <h:outputText value="#{cb.referenceBill.createdAt}">
                            <f:convertDateTime
                                pattern="#{sessionController.applicationPreference.longDateTimeFormat}"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Reference Institution" width="6em">
                        <h:outputText value="#{cb.referenceInstitution.name}"/>
                    </p:column>
                    <p:column headerText="Created At" width="6em">
                        <h:outputText value="#{cb.createdAt}">
                            <f:convertDateTime
                                pattern="#{sessionController.applicationPreference.longDateTimeFormat}"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Approved At" width="6em">
                        <h:outputText value="#{cb.referenceBill.createdAt}">
                            <f:convertDateTime
                                pattern="#{sessionController.applicationPreference.longDateTimeFormat}"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Supplier" width="6em">
                        <h:outputLabel value="#{cb.fromInstitution.name}"/>
                    </p:column>
                    <p:column headerText="Purchase Value" width="6em" style="text-align: right;">
                        <h:outputText
                            value="#{(cb.billFinanceDetails.lineNetTotal gt 0 ? -1 * cb.billFinanceDetails.lineNetTotal : cb.billFinanceDetails.lineNetTotal)}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>

                        <f:facet name="footer">
                            <h:outputText value="#{pharmacyController.totalPurchase}">
                                <f:convertNumber pattern="#,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Cost Value" width="6em" style="text-align: right;"
                              >
                        <h:outputText
                            value="#{cb.billFinanceDetails.totalCostValue gt 0 ? -1 * cb.billFinanceDetails.totalCostValue : cb.billFinanceDetails.totalCostValue}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>

                        <f:facet name="footer">
                            <h:outputText value="#{pharmacyController.totalCostValue}">
                                <f:convertNumber pattern="#,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Sale Value" width="6em" style="text-align: right;">
                        <h:outputText
                            value="#{cb.billFinanceDetails.totalRetailSaleValue gt 0 ? -1 * cb.billFinanceDetails.totalRetailSaleValue : cb.billFinanceDetails.totalRetailSaleValue}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{pharmacyController.totalSaleValue}">
                                <f:convertNumber pattern="#,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>

                    <p:column headerText="Purchase Details" width="50em" style="text-align: center;">
                        <p:dataTable id="cBillItemsTable" value="#{cb.billItems}" var="cbi" rowKey="#{cbi.id}"
                                     style="margin:0">
                            <p:column headerText="Item Name" style="text-align: left;">
                                <h:outputText value="#{cbi.item.name}"/>
                            </p:column>
                            <p:column headerText="Qty" style="text-align: left;">
                                <h:outputText value="#{cbi.pharmaceuticalBillItem.qty}"/>
                            </p:column>
                            <p:column headerText="Free Qty" style="text-align: left;">
                                <h:outputText value="#{cbi.pharmaceuticalBillItem.freeQty}"/>
                            </p:column>
                            <p:column headerText="Purchase Rate" style="text-align: left;">
                                <h:outputText value="#{cbi.pharmaceuticalBillItem.purchaseRate}">
                                    <f:convertNumber pattern="#,##0.00"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Cost Rate" style="text-align: left;"
                                      >
                                <h:outputLabel value="#{cbi.billItemFinanceDetails.lineCostRate}">
                                    <f:convertNumber pattern="#,##0.00"/>
                                </h:outputLabel>
                            </p:column>
                            <p:column headerText="Discount Rate" style="text-align: left;">
                                <h:outputLabel value="#{cbi.billItemFinanceDetails.lineDiscountRate ne null ?
                                                        cbi.billItemFinanceDetails.lineDiscountRate : cbi.referanceBillItem.billItemFinanceDetails.lineDiscountRate}">
                                    <f:convertNumber pattern="#,##0.00"/>
                                </h:outputLabel>
                            </p:column>
                            <p:column headerText="Item MRP" style="text-align: left;">
                                <h:outputText value="#{cbi.pharmaceuticalBillItem.retailRate}"/>
                            </p:column>
                            <p:column headerText="Batch Code" style="text-align: left;">
                                <h:outputText value="#{cbi.pharmaceuticalBillItem.itemBatch.batchNo}"/>
                            </p:column>
                            <p:column headerText="UOM" style="text-align: left;">
                                <h:outputText value="#{cbi.item.measurementUnit.name}"/>
                            </p:column>
                        </p:dataTable>
                    </p:column>
                </p:dataTable>
            </h:panelGroup>
        </ui:composition>
    </h:body>
</html>
