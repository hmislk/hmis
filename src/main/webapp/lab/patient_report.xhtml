<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:ez="http://java.sun.com/jsf/composite/ezcomp">


    <head>
    </head>

    <body>
        <ui:composition template="/resources/template/template.xhtml">
            <ui:define name="content">

                <div class="nonPrintBlock">
                    <h:form id="form">

                        <h:panelGroup rendered="#{webUserController.hasPrivilege('LabAutherizing') eq true or webUserController.hasPrivilege('LabDataentry') eq true or webUserController.hasPrivilege('LabPrinting') eq true   }" styleClass="nonPrintBlock">
                            <p:growl id="messages" showDetail="true"/> 
                            <p:panel  >
                                <f:facet  name="header" >
                                    <h:panelGroup id="facetPanelIx" >
                                        <b><h:outputLabel value="#{patientReportController.currentPatientReport.item.reportedAs.name}" ></h:outputLabel></b>
                                        <h:outputLabel value=" - " ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.nameWithTitle}" ></h:outputLabel>
                                        <h:outputLabel value=", " ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.age}" ></h:outputLabel>
                                        <h:outputLabel value=", " ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.sex}" ></h:outputLabel>

                                    </h:panelGroup>
                                </f:facet>

                                <p:tooltip for="facetPanelIx" >
                                    <p:panel header="Patient Details" styleClass="alignTop" >
                                        <p:panelGrid columns="2" >
                                            <h:outputLabel value="Name" ></h:outputLabel>
                                            <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.nameWithTitle}" ></h:outputLabel>
                                            <h:outputLabel value="Age" ></h:outputLabel>
                                            <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.age}" ></h:outputLabel>
                                            <h:outputLabel value="Sex" ></h:outputLabel>
                                            <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.sex}" ></h:outputLabel>
                                            <h:outputLabel value="Investigation" ></h:outputLabel>
                                            <h:outputLabel value="#{patientReportController.currentPatientReport.item.reportedAs.name}" ></h:outputLabel>
                                        </p:panelGrid>
                                    </p:panel>

                                </p:tooltip>

                                <h:panelGrid columns="9" >
                                    <p:commandButton rendered="#{webUserController.hasPrivilege('LabDataentry') eq true and patientReportController.currentPatientReport.approved ne true}"  
                                                     value="Save" 
                                                     action="#{patientReportController.savePatientReport()}" ajax="false" onclick="onSubmitButton();"  >
                                    </p:commandButton>
                                    <p:commandButton ajax="false" process="tblVals" update=":#{p:component('tblCals')} :#{p:component('tblFlags')} :#{p:component('divPrint')}"  styleClass="nonPrintBlock"  value="Calculate" 
                                                     action="#{patientReportController.calculate}" onclick="onSubmitButton();"   >
                                    </p:commandButton>

                                    <p:commandButton styleClass="nonPrintBlock"  id="btnApprove"  disabled ="#{!(webUserController.hasPrivilege('LabAutherizing') eq true and patientReportController.currentPatientReport.dataEntered eq true)}"   value="Approve" action="#{patientReportController.approvePatientReport()}" ajax="false" onclick="onSubmitButton();"  >
                                    </p:commandButton>

                                    <p:commandButton styleClass="nonPrintBlock"  
                                                     ajax="false" 
                                                     value="Print" 
                                                     rendered="#{patientReportController.currentPatientReport.approved or userPreferenceController.userPreference.canPrintWithoutPermission }"
                                                     onclick="window.print();" 
                                                     actionListener="#{patientReportController.printPatientReport()}"/>

                                    <p:spacer width="30" ></p:spacer>
                                    <p:commandButton  styleClass="nonPrintBlock"  value="Patient Report Search" action="#{patientReportController.patientReportSearch}" ajax="false" >
                                    </p:commandButton>
                                    <p:commandButton  styleClass="nonPrintBlock"  value="Report Search" action="/lab/search_for_reporting_ondemand" ajax="false" onclick="onSubmitButton();"  >
                                    </p:commandButton>
                                    <p:commandButton  styleClass="nonPrintBlock"  value="To Approve List" action="#{searchController.listReportsAwaitingApproval()}" ajax="false" onclick="onSubmitButton();"  >
                                    </p:commandButton>

                                    <p:commandButton styleClass="nonPrintBlock" ajax="false" value="Back to Visit" action="/clinical/clinical_new_opd_visit.xhtml" style="float: right;" onclick="onSubmitButton();" ></p:commandButton>

                                </h:panelGrid>


                                <h:panelGrid columns="3" styleClass="alignTop" >
                                    <p:panel header="Enter Values"  
                                             rendered="#{patientReportController.currentPatientReport.transInvestigation.reportType ne 'Microbiology' and patientReportController.currentPatientReport.containValues eq true}" >
                                        <table >
                                            <ui:repeat id="tblVals" value="#{patientReportController.currentPatientReport.patientReportItemValues}"  
                                                       var="pvv"  
                                                       >
                                                <h:panelGroup rendered="#{pvv.investigationItem.ixItemType eq 'Value'}"  >
                                                    <tr>
                                                        <td style="min-width: 200px!important;">
                                                            <h:outputLabel value="#{pvv.investigationItem.name}"></h:outputLabel>
                                                        </td>
                                                        <td >
                                                            <p:inputText autocomplete="off" value="#{pvv.strValue}" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}"
                                                                         rendered="#{pvv.investigationItem.ixItemValueType eq 'Varchar' and empty pvv.investigationItem.investigationItemValues}" >
                                                                <p:ajax process="@this" event="blur" listener="#{patientReportController.savePatientReportItemValues()}"></p:ajax>
                                                            </p:inputText>
                                                            <p:selectOneMenu value="#{pvv.strValue}" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}"
                                                                             rendered="#{pvv.investigationItem.ixItemValueType eq 'Varchar' and !empty pvv.investigationItem.investigationItemValues}" 
                                                                             editable="true"  style="min-width: 300px!important;" >
                                                                <f:selectItems value="#{pvv.investigationItem.investigationItemValues}" var="iiv" itemLabel="#{iiv.name}" itemValue="#{iiv.name}" ></f:selectItems>
                                                                <p:ajax process="@this" event="change" listener="#{patientReportController.savePatientReportItemValues()}"></p:ajax>
                                                            </p:selectOneMenu>
                                                            <p:inputText id="txtValDbl" autocomplete="off" value="#{pvv.doubleValue}" validatorMessage="Entered value not valid. Please recheck." converterMessage="Entered value not valid. Please recheck."
                                                                         rendered="#{pvv.investigationItem.ixItemValueType eq 'Double'}" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}">
                                                                <p:ajax process="@this" event="blur" listener="#{patientReportController.savePatientReportItemValues()}"></p:ajax>
                                                            </p:inputText>
                                                            <p:inputTextarea  value="#{pvv.lobValue}" queryDelay="0" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}"
                                                                              rendered="#{pvv.investigationItem.ixItemValueType eq 'Memo'}" >
                                                                <p:ajax process="@this" event="blur" listener="#{patientReportController.savePatientReportItemValues()}"></p:ajax>
                                                            </p:inputTextarea>
                                                        </td>
                                                    </tr>
                                                </h:panelGroup>
                                            </ui:repeat>
                                        </table>
                                    </p:panel>
                                    <h:panelGroup  
                                        rendered="#{patientReportController.currentPatientReport.transInvestigation.reportType ne 'Microbiology'  and patientReportController.currentPatientReport.containCalculations eq true }"   >
                                        <p:panel header="Calculations " id="tblCals">
                                            <table >               
                                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" 
                                                            var="pvcal"  

                                                            >

                                                    <h:panelGroup   rendered="#{pvcal.investigationItem.ixItemType eq 'Calculation'}"   >
                                                        <tr>
                                                            <td>
                                                                <h:outputLabel value="#{pvcal.investigationItem.name}" ></h:outputLabel>
                                                            </td>
                                                            <td >
                                                                <h:inputText autocomplete="off" value="#{pvcal.strValue}" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}"
                                                                             rendered="#{pvcal.investigationItem.ixItemValueType eq 'Varchar'}" >
                                                                    <f:ajax execute="@this" event="blur" listener="#{patientReportController.savePatientReportItemValues()}"></f:ajax>
                                                                </h:inputText>
                                                                <p:inputText autocomplete="off" value="#{pvcal.doubleValue}" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}"
                                                                             rendered="#{pvcal.investigationItem.ixItemValueType eq 'Double'}" >
                                                                    <f:convertNumber pattern="0.0" ></f:convertNumber>
                                                                    <f:ajax execute="@this" event="blur" listener="#{patientReportController.savePatientReportItemValues()}"></f:ajax>
                                                                </p:inputText>
                                                            </td>
                                                        </tr>
                                                    </h:panelGroup>
                                                </ui:repeat>
                                            </table>
                                        </p:panel>
                                        <p:panel header="Flags" id="tblFlags">
                                            <table >
                                                <ui:repeat  
                                                    value="#{patientReportController.currentPatientReport.patientReportItemValues}" 
                                                    var="pvf" 
                                                    >
                                                    <h:panelGroup rendered="#{pvf.investigationItem.ixItemType eq 'Flag'}" >
                                                        <tr>
                                                            <td >
                                                                <h:outputLabel value="#{pvf.investigationItem.name}" ></h:outputLabel>
                                                            </td>
                                                            <td>
                                                                <p:selectOneMenu id="cmbStrFlag" value="#{pvf.strValue}" editable="true" style="min-width: 200px;" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}">
                                                                    <f:selectItems value="#{testFlagController.getIxItemFlags(pvf.investigationItem)}" var="iivfh" itemLabel="#{iivfh.highMessage}" itemValue="#{iivfh}" ></f:selectItems>
                                                                    <f:selectItems value="#{testFlagController.getIxItemFlags(pvf.investigationItem)}" var="iivfl" itemLabel="#{iivfl.lowMessage}" itemValue="#{iivfl}" ></f:selectItems>
                                                                    <f:selectItems value="#{testFlagController.getIxItemFlags(pvf.investigationItem)}" var="iivf" itemLabel="#{iivf.normalMessage}" itemValue="#{iivf}" ></f:selectItems>
                                                                    <p:ajax process="@this" event="change" listener="#{patientReportController.savePatientReportItemValues()}"></p:ajax>
                                                                </p:selectOneMenu>
                                                            </td>
                                                        </tr>
                                                    </h:panelGroup>
                                                </ui:repeat>
                                            </table>
                                        </p:panel>
                                    </h:panelGroup>
                                    <p:panel header="Dynamic Labels" rendered="#{patientReportController.currentPatientReport.containDynamicLabels eq true }"  >
                                        <table >
                                            <ui:repeat id="tblDls" 
                                                       value="#{patientReportController.currentPatientReport.patientReportItemValues}"  
                                                       var="pvd"  >
                                                <h:panelGroup rendered="#{pvd.investigationItem.ixItemType eq 'DynamicLabel'}" >
                                                    <tr>
                                                        <td >
                                                            <h:outputLabel value="#{pvd.investigationItem.name}" ></h:outputLabel>
                                                        </td>
                                                        <td>
                                                            <p:selectOneMenu  id="cmbStrDl" value="#{pvd.strValue}" editable="true" style="min-width: 200px;" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}">
                                                                <f:selectItems value="#{investigationItemDynamicLabelController.getDynamicLabelsByIxItId(pvd.investigationItem) }" var="iivd" itemLabel="#{iivd.flagMessage}" itemValue="#{iivd}" ></f:selectItems>
                                                                <p:ajax process="@this" event="change" listener="#{patientReportController.savePatientReportItemValues()}"></p:ajax>
                                                            </p:selectOneMenu>
                                                        </td>
                                                    </tr>
                                                </h:panelGroup>
                                            </ui:repeat>
                                        </table>
                                    </p:panel>
                                    <p:panel header="Microbiology"    rendered="#{patientReportController.currentPatientReport.transInvestigation.reportType eq 'Microbiology'}" >
                                        <f:view contentType="text/html">
                                            <table >
                                                <ui:repeat id="tblMicVals" 
                                                           value="#{patientReportController.currentPatientReport.patientReportItemValues }"  
                                                           var="pvm"   
                                                           >
                                                    <h:panelGroup rendered="#{pvm.investigationItem.ixItemType eq 'Value'}" >
                                                        <tr>
                                                            <td >
                                                                <h:outputLabel value="#{pvm.investigationItem.name}" ></h:outputLabel>
                                                            </td>
                                                            <td >

                                                                <h:panelGroup rendered="#{pvm.investigationItem.ixItemValueType eq 'Memo'}" >
                                                                    <p:inputTextarea id="txtMicMemoVal" queryDelay="0"   minQueryLength="1"  style="min-width: 200px; "  
                                                                                     completeMethod="#{investigationItemValueController.completeValues}" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}"
                                                                                     value="#{pvm.lobValue}" >
                                                                        <p:ajax process="@this" event="blur" listener="#{patientReportController.savePatientReportItemValues()}"></p:ajax>
                                                                    </p:inputTextarea>
                                                                </h:panelGroup>
                                                                <h:panelGroup rendered="#{pvm.investigationItem.ixItemValueType eq 'Varchar'}">
                                                                    <p:selectOneMenu id="cmbMicStrVal" value="#{pvm.strValue}" editable="true"  style="min-width: 300px!important;" disabled="#{patientReportController.currentPatientReport.approved eq true and !webUserController.hasPrivilege('LabReportEdit')}">
                                                                        <f:selectItem itemLabel="SENSITIVE" itemValue="SENSITIVE" ></f:selectItem>
                                                                        <f:selectItem itemLabel="Resistant" itemValue="Resistant" ></f:selectItem>
                                                                        <f:selectItem itemLabel="Intermediate" itemValue="Intermediate" ></f:selectItem>
                                                                        <f:ajax event="change"  execute="@this" 
                                                                                listener="#{patientReportController.savePatientReportItemValues()}" ></f:ajax>
                                                                    </p:selectOneMenu>
                                                                </h:panelGroup>

                                                            </td>
                                                        </tr>
                                                    </h:panelGroup>
                                                </ui:repeat>
                                            </table>
                                        </f:view>

                                    </p:panel>
                                    <p:panel header="Report"    
                                             rendered="#{patientReportController.currentPatientReport.transInvestigation.reportType eq 'PathologyOrHaematology'}" >


                                        <h:panelGrid columns="4" >
                                            <p:outputLabel value="Search a Template" ></p:outputLabel>
                                            <p:autoComplete id="acTemplate" 
                                                            value="#{patientReportController.investigationItem}" 
                                                            completeMethod="#{investigationItemController.completeTemplate}"
                                                            var="ii" itemLabel="#{ii.name}" itemValue="#{ii}" >
                                                <p:ajax event="itemSelect" process="@this" ></p:ajax>
                                            </p:autoComplete>
                                            <p:commandButton id="btnAddPathReport"
                                                             oncomplete="PF('dlgPath').show();" 
                                                             process="acTemplate btnAddPathReport" update="dlgPath" 
                                                             value="Add Template" actionListener="#{patientReportController.toAddNewTemplate()}" ></p:commandButton>
                                            <p:commandButton value="Edit Template" ajax="false" action="#{patientReportController.toEditTemplate()}" >
                                            </p:commandButton>
                                            <p:dialog id="dlgPath" header="Pathology Report" widgetVar="dlgPath" modal="true">


                                                <p:commandButton id="btnAddTemplateToReport"
                                                             oncomplete="PF('dlgPath').hide();" 
                                                             process="@this dlgPath" update="reportEditor" 
                                                             value="Add To Report" 
                                                             actionListener="#{patientReportController.addTemplateToReport()}" ></p:commandButton>

                                            
                                                
                                                <table >
                                                    <tr>
                                                        <th>
                                                            <p:outputLabel value="Variable" ></p:outputLabel>
                                                        </th>
                                                        <th>
                                                            <p:outputLabel value="Value" ></p:outputLabel>
                                                        </th>
                                                    </tr>

                                                    <ui:repeat value="#{patientReportController.selectables}" var="sel" >
                                                        <tr>
                                                            <td>
                                                                <p:outputLabel value="#{sel.name}" ></p:outputLabel>
                                                            </td>
                                                            <td>
                                                                <h:panelGroup >
                                                                    <p:inputText value="#{sel.selectedValue}" rendered="#{sel.inputText}" ></p:inputText>
                                                                    <p:selectOneMenu  value="#{sel.selectedValue}" rendered="#{sel.selectOneMenu}" >
                                                                        <f:selectItems value="#{sel.options}" ></f:selectItems>
                                                                    </p:selectOneMenu>
                                                                </h:panelGroup>
                                                            </td>
                                                        </tr>
                                                    </ui:repeat>
                                                </table>



                                            </p:dialog>

                                        </h:panelGrid>
                                        <p:editor id="reportEditor" value="#{patientReportController.currentPatientReport.templateItem.lobValue}" widgetVar="editor" height="650" >

                                        </p:editor>


                                    </p:panel>

                                </h:panelGrid>


                            </p:panel>



                        </h:panelGroup>



                    </h:form>



                </div>

                <div >
                    <h:form >

                        <div class="nonPrintBlock" >
                            <p:commandButton styleClass="nonPrintBlock"  ajax="false" value="Print" onclick="window.print();" actionListener="#{patientReportController.printPatientReport()}" 
                                             rendered="#{patientReportController.currentPatientReport.approved or userPreferenceController.userPreference.canPrintWithoutPermission }" />

                            <p:commandButton styleClass="nonPrintBlock"  ajax="false" value="PDF" actionListener="#{patientReportController.pdfPatientReport()}" 
                                             rendered="#{patientReportController.currentPatientReport.approved or userPreferenceController.userPreference.canPrintWithoutPermission }" />
                        </div>


                        <h:panelGroup  id="divPrint" >

                            <div class="labBillPrintPanel" style="color: black; width: 21cm;height: 28cm;margin: auto; margin-top: 1cm;margin-bottom: 1cm;" >

                                <h:panelGroup rendered="#{patientReportController.currentPatientReport.item.reportType ne 'Microbiology'}"  >
                                    <div id="divReport"  style="width:21cm;height: 28cm; position: relative;">



                                        <ez:common_report commonReportFormat="#{patientReportController.currentPatientReport.transInvestigation.reportFormat}"
                                                          patientReport="#{patientReportController.currentPatientReport}"/>

                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                            <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                                <h:outputLabel value="#{prv.lobValue}" rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Memo' and prv.investigationItem.retired eq false}"  escape="false" />
                                            </div>
                                        </ui:repeat>

                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                            <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                                <h:outputLabel value="#{prv.lobValue}" rendered="#{prv.investigationItem.ixItemType eq 'Template' and prv.investigationItem.retired eq false}"  escape="false" />
                                            </div>
                                        </ui:repeat>
                                        
                                        
                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                            <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                                <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Varchar'}" escape="false" />
                                            </div>
                                        </ui:repeat>

                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                            <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                                <h:outputLabel value="#{prv.doubleValue}"  rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Double' and prv.investigationItem.retired eq false}"   escape="false" />
                                            </div>
                                        </ui:repeat>


                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                            <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                                <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'DynamicLabel'}" escape="false" />
                                            </div>
                                        </ui:repeat>

                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                            <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                                <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'Flag'}" escape="false" />
                                            </div>
                                        </ui:repeat>

                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                            <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                                <h:outputLabel value="#{prv.doubleValue}" rendered="#{prv.investigationItem.ixItemType eq 'Calculation' }" escape="false" >
                                                    <f:convertNumber pattern="0.0" />
                                                </h:outputLabel>
                                            </div>
                                        </ui:repeat>

                                        <ui:repeat value="#{patientReportController.currentPatientReport.item.reportItems}" var="myIi" >
                                            <div style="#{myIi.cssStyle}; position:absolute;">
                                                <h:outputText rendered="#{myIi.retired ne true and myIi.ixItemType eq 'Label' }" value="#{myIi.htmltext}" style="color: #{myIi.cssColor}" escape="false" ></h:outputText>
                                            </div>
                                        </ui:repeat>


                                    </div>
                                </h:panelGroup>


                                <h:panelGroup rendered="#{patientReportController.currentPatientReport.item.reportType eq 'Microbiology'}"  >

                                    <div id="divReportM"  style="min-width:800px;min-height: 1100px; position: relative; ">


                                        <ez:common_report commonReportFormat="#{patientReportController.currentPatientReport.transInvestigation.reportFormat}"
                                                          patientReport="#{patientReportController.currentPatientReport}"/>





                                        <table id="micro" style="position: absolute; top: 35%; left:10%; font-size: 14px!important;" >

                                            <tr>
                                                <td>
                                                    <h:outputLabel value="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                   #{patientReportController.currentPatientReport.patientInvestigation.investigation.printName}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" 
                                                                   style="font-weight: bold;font-size: 20px!important; margin: 5px;padding: 5px; border: solid black 1px;"/>
                                                </td>
                                            </tr>
                                            <tr><td>
                                                    <p:spacer height="50px" ></p:spacer>
                                                </td></tr>
                                            <tr><td><h:outputLabel/></td></tr>
                                            <tr><td><h:outputLabel/></td></tr>
                                            <tr><td><h:outputLabel/></td></tr>
                                            <tr>

                                                <td id="micromemos">
                                                    <table>
                                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                                            <h:panelGroup rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Memo' and prv.investigationItem.retired eq false and prv.lobValue ne '' and prv.lobValue ne null and prv.investigationItem.riTop lt 50 }" >
                                                                <tr style="vertical-align: top;">
                                                                    <td style="min-width: 250px;padding-left: 1px; padding-right: 1px;">
                                                                        <h:outputLabel value="#{prv.investigationItem.name}"   escape="false"  />
                                                                    </td>
                                                                    <td style="min-width: 1150px;padding-left: 1px; padding-right: 1px;">
                                                                        <h:outputLabel value="#{fn:replace(prv.lobValue,'\\n','&lt;br/&gt;')}"    escape="false"   />
                                                                    </td>
                                                                </tr>
                                                            </h:panelGroup>
                                                        </ui:repeat>
                                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                                            <h:panelGroup rendered="#{prv.investigationItem.ixItemType eq 'DynamicLabel' and prv.investigationItem.retired eq false and prv.investigationItem.riTop  lt 50 }" >
                                                                <tr >
                                                                    <td >
                                                                        <h:outputLabel value="#{prv.investigationItem.name}"  escape="false"  />
                                                                    </td>
                                                                    <td>

                                                                    </td>
                                                                </tr>
                                                            </h:panelGroup>
                                                        </ui:repeat>
                                                    </table>
                                                </td>
                                            </tr>
                                            <br/><br/>
                                            <tr>
                                                <td id="micLabelsBeforeAbst">

                                                    <ui:repeat value="#{patientReportController.currentPatientReport.item.reportItems}" var="myMicIi" >
                                                        <div style="#{myMicIi.cssStyle}; left: #{prvl.cssLeft};">
                                                            <h:outputText rendered="#{myMicIi.retired ne true and myMicIi.ixItemType eq 'List' }" 
                                                                          value="#{myMicIi.name}" style="color: #{myMicIi.cssColor}" escape="false" ></h:outputText>
                                                        </div>
                                                    </ui:repeat>


                                                </td>
                                            </tr>

                                            <tr>
                                                <td id="ablist">
                                                    <table>
                                                        <tr>
                                                            <td colspan="2"  >
                                                                <h:outputLabel value="Antibiotic Sensitivity Test" 
                                                                               rendered="#{patientReportController.currentPatientReport.transHasAbst}"
                                                                               style="font-size: 120%; font-weight: bold; padding-left: 20px;"></h:outputLabel>
                                                            </td>
                                                        </tr>
                                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" 
                                                                    var="prv" >
                                                            <h:panelGroup 
                                                                rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Varchar' and prv.investigationItem.retired eq false and prv.strValue ne '' and prv.strValue ne null  }" >
                                                                <tr>
                                                                    <td style="min-width: 250px;">
                                                                        <h:outputLabel value="#{prv.investigationItem.name}"  escape="false" />
                                                                    </td>
                                                                    <td  style="min-width: 850px;">

                                                                        <h:outputLabel value="#{prv.strValue}" escape="false"  />
                                                                    </td>
                                                                </tr>
                                                            </h:panelGroup>
                                                        </ui:repeat>
                                                    </table>

                                                </td>
                                            </tr>
                                            <br/><br/>
                                            <tr>
                                                <td id="miccomments">
                                                    <table>
                                                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                                            <h:panelGroup rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Memo' and prv.investigationItem.retired eq false and prv.lobValue ne '' and prv.lobValue ne null and prv.investigationItem.riTop gt 50 }" >
                                                                <tr>
                                                                    <td style="min-width: 250px;padding-left: 1px; padding-right: 1px; vertical-align: top;">
                                                                        <h:outputLabel value="#{prv.investigationItem.name}"  escape="false" />
                                                                    </td>
                                                                    <td>
                                                                        <h:outputLabel value="#{fn:replace(prv.lobValue,'\\n','&lt;br/&gt;')}"    escape="false" />
                                                                    </td>
                                                                </tr>
                                                            </h:panelGroup>
                                                        </ui:repeat>
                                                    </table>
                                                </td>
                                            </tr>

                                        </table>


                                    </div>
                                </h:panelGroup>


                            </div>

                        </h:panelGroup>


                    </h:form>
                </div>

                <h:panelGroup rendered="false" >
                    <table>
                        <tr>
                            <th>
                                ixItemType
                            </th>
                            <th>
                                ixItemValueType
                            </th>
                            <td>
                                <h:outputLabel value="name" escape="false" />
                            </td>
                            <td>
                                <h:outputLabel value="cssTop" escape="false" />
                            </td>
                            <td>
                                <h:outputLabel value="riTop" escape="false" />
                            </td>
                            <td>
                                <h:outputLabel value="cssLeft" escape="false" />
                            </td>
                            <td>
                                <h:outputLabel value="riLeft" escape="false" />
                            </td>
                        </tr>

                        <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                            <tr>
                                <td>
                                    <h:outputLabel value="#{prv.investigationItem.ixItemType}" escape="false" />
                                </td>
                                <td>
                                    <h:outputLabel value="#{prv.investigationItem.ixItemValueType}" escape="false" />
                                </td>
                                <td>
                                    <h:outputLabel value="#{prv.investigationItem.name}" escape="false" />
                                </td>
                                <td>
                                    <h:outputLabel value="#{prv.investigationItem.cssTop}" escape="false" />
                                </td>
                                <td>
                                    <h:outputLabel value="#{prv.investigationItem.riTop}" escape="false" />
                                </td>
                                <td>
                                    <h:outputLabel value="#{prv.investigationItem.cssLeft}" escape="false" />
                                </td>
                                <td>
                                    <h:outputLabel value="#{prv.investigationItem.riLeft}" escape="false" />
                                </td>
                            </tr>
                            <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Varchar'}" escape="false" />
                            </div>
                        </ui:repeat>

                    </table>
                </h:panelGroup>


            </ui:define>



        </ui:composition>

    </body>
</html>