<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:opd="http://xmlns.jcp.org/jsf/composite/ezcomp/opd">
    <ui:composition template="/resources/template/template.xhtml">
        <ui:define name="content">
            <h:head>
                <style>
                    #{configOptionApplicationController.getLongTextValueByKey('CSS for Sample Container Sticker')}
                </style>
            </h:head>

            <h:panelGroup rendered="#{!webUserController.hasPrivilege('LabSampleCollecting')}" >
                You are NOT authorized
            </h:panelGroup>

            <h:panelGroup rendered="#{webUserController.hasPrivilege('LabSampleCollecting')}" >
                <h:form>        

                    <div class="container-fluid" >
                        <div class="row my-2" >
                            <div class="col-9" >
                                <h:panelGrid columns="6" class="w-100" style="font-weight: bolder">
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Date Range for"/>
                                        <p:selectOneMenu filter="true" filterMatchMode="contains" class="w-100" value="#{patientInvestigationController.searchDateType}">
                                            <f:selectItems value="#{enumController.searchDateTypes}" var="st" itemValue="#{st}" itemLabel="#{st.label}"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="From Date"/>
                                        <p:datePicker inputStyleClass="w-100" id="fromDate" showTime="true" value="#{patientInvestigationController.fromDate}" class="w-100" pattern="#{sessionController.applicationPreference.longDateTimeFormat}"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="To Date"/>
                                        <p:datePicker id="toDate" inputStyleClass="w-100" showTime="true" value="#{patientInvestigationController.toDate}" class="w-100" pattern="#{sessionController.applicationPreference.longDateTimeFormat}"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Status"/>
                                        <p:selectOneMenu filter="true" filterMatchMode="contains" class="w-100" style="max-width:100%;" value="#{patientInvestigationController.patientInvestigationStatus}">
                                            <f:selectItem itemLabel="Any" />
                                            <f:selectItems value="#{enumController.patientInvestigationStatuses}" var="pis" itemValue="#{pis}" itemLabel="#{pis.label}"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Referring Doctor"/>
                                        <p:autoComplete inputStyleClass="w-100" inputStyle="max-width:100%;" class="w-100" id="acReferringDoctor" value="#{patientInvestigationController.referringDoctor}" completeMethod="#{doctorController.completeDoctor}" var="rd" itemLabel="#{rd.name}" itemValue="#{rd}"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="External Doctor"/>
                                        <p:inputText class="w-100" value="#{patientInvestigationController.externalDoctor}"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Equipment"/>
                                        <p:selectOneMenu filter="true" filterMatchMode="contains" class="w-100" value="#{patientInvestigationController.equipment}">
                                            <f:selectItem itemLabel="Any" />
                                            <f:selectItems value="#{machineController.items}" var="e" itemLabel="#{e.name}" itemValue="#{e}"/>
                                        </p:selectOneMenu>

                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Investigation"/>
                                        <p:autoComplete widgetVar="aPt" id="acPt" forceSelection="true" converter="ixcon" value="#{patientInvestigationController.investigation}" completeMethod="#{investigationController.completeInvest}" var="apt" itemLabel="#{apt.name}" inputStyleClass="w-100" itemValue="#{apt}" class="w-100" size="10" style="max-width: 100%;">
                                            <p:column>
                                                #{apt.name}
                                            </p:column>
                                            <p:column>
                                                #{apt.code}
                                            </p:column>
                                            <p:column>
                                                #{apt.fullName}
                                            </p:column>
                                            <p:column>
                                                #{apt.department.name}
                                            </p:column>
                                            <f:ajax listener="#{investigationValidatorComponentController.listItemValidator()}" render="invalcom" event="itemSelect" execute="acPt"></f:ajax>
                                        </p:autoComplete> 
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Type"/>
                                        <p:selectOneMenu class="w-100" value="#{patientInvestigationController.type}">
                                            <f:selectItem itemLabel="Any"/>
                                            <f:selectItem itemValue="OP" itemLabel="Out Patients (OP)"/>
                                            <f:selectItem itemValue="IP" itemLabel="In Patients (IP)"/>
                                            <f:selectItem itemValue="CC" itemLabel="Collecting Centre (CC)"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Sample Id"/>
                                        <p:inputText class="w-100" value="#{patientInvestigationController.sampleId}"/>

                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Patient Name"/>
                                        <p:inputText class="w-100" value="#{patientInvestigationController.patientName}"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Specimen"/>
                                        <p:selectOneMenu class="w-100" value="#{patientInvestigationController.specimen}">
                                            <f:selectItem itemLabel="Any" />
                                            <f:selectItems value="#{sampleController.items}" var="s" itemLabel="#{s.name}" itemValue="#{s}"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Priority"/>
                                        <p:selectOneMenu class="w-100" value="#{patientInvestigationController.priority}">
                                            <f:selectItem itemLabel="Any" />
                                            <f:selectItems value="#{enumController.priorities}" var="p" itemLabel="#{p.label}" itemValue="#{p}"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">

                                        <h:outputLabel class="w-100" value="By Route"/>
                                        <p:selectOneMenu filter="true" filterMatchMode="contains" class="w-100" value="#{patientInvestigationController.route}">
                                            <f:selectItem itemLabel="Any" />
                                            <f:selectItems value="#{routeController.items}" var="r" itemLabel="#{r.name}" itemValue="#{r}"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="By Collection Center"/>
                                        <p:autoComplete class="w-100" id="acCollectionCenter" value="#{patientInvestigationController.collectionCenter}" completeMethod="#{collectingCentreController.completeCollecting}" var="cc" itemLabel="#{cc.name}" itemValue="#{cc}"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Ordered Institution"/>
                                        <p:autoComplete class="w-100" id="acOins" value="#{patientInvestigationController.orderedInstitution}" inputStyleClass="w-100"
                                                        completeMethod="#{institutionController.completeIns}" var="oi" itemLabel="#{oi.name}" itemValue="#{oi}">
                                            <p:ajax process="acOins" update="gpOdept" ></p:ajax>
                                        </p:autoComplete>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Ordered Department"/>
                                        <h:panelGroup id="gpOdept">
                                            <p:selectOneMenu value="#{patientInvestigationController.orderedDepartment}" class="w-100" style="max-width: 100%">
                                                <f:selectItem itemLabel="Any"></f:selectItem>
                                                <f:selectItems value="#{departmentController.getInstitutionDepartments(patientInvestigationController.orderedInstitution)}" var="odpt" itemLabel="#{odpt.name}" itemValue="#{odpt}"></f:selectItems>
                                            </p:selectOneMenu>
                                        </h:panelGroup>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Performing Institution"/>
                                        <p:autoComplete class="w-100" id="acPIns" value="#{patientInvestigationController.performingInstitution}" inputStyleClass="w-100"
                                                        completeMethod="#{institutionController.completeIns}" var="pi" itemLabel="#{pi.name}" itemValue="#{pi}">
                                            <p:ajax process="acPIns" update="gpPDept"></p:ajax>
                                        </p:autoComplete>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" class="w-100">
                                        <h:outputLabel class="w-100" value="Performing Department"/>
                                        <h:panelGroup id="gpPDept">
                                            <p:selectOneMenu value="#{patientInvestigationController.performingDepartment}" class="w-100" style="max-width: 100%">
                                                <f:selectItem itemLabel="Any"></f:selectItem>
                                                <f:selectItems value="#{departmentController.getInstitutionDepartments(patientInvestigationController.performingInstitution)}" var="pdpt" itemLabel="#{pdpt.name}" itemValue="#{pdpt}"></f:selectItems>
                                            </p:selectOneMenu>
                                        </h:panelGroup>
                                    </h:panelGrid>

                                </h:panelGrid>
                            </div>
                            <div class="col-3 ">
                                <h:panelGrid columns="2">
                                    <h:panelGrid columns="1">
                                        <p:commandButton ajax="false" action="#{patientInvestigationController.searchPatientInvestigations}" value="Search Investigation" icon="fas fa-search" styleClass="m-1 ui-button-info w-100"/>
                                        <p:commandButton ajax="false" action="#{patientInvestigationController.searchPatientSamples()}" value="Search Sample" icon="fas fa-search" styleClass="m-1 ui-button-info w-100"/>
                                        <p:commandButton ajax="false" action="#{patientInvestigationController.searchBills}" value="Search Bills" icon="fas fa-search" styleClass="m-1 ui-button-info w-100"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1">
                                        <p:commandButton rendered="#{patientInvestigationController.listingEntity eq 'PATIENT_INVESTIGATIONS'}"
                                                         id="btnGeneraBarcodes"
                                                         value="Generate Barcodes"
                                                         ajax="false" action="#{patientInvestigationController.generateBarcodesForSelectedPatientInvestigations()}"
                                                         title="Generate Barcodes" icon="fas fa-barcode" styleClass="m-1 ui-button-success w-100"/>

                                        <p:commandButton rendered="#{patientInvestigationController.listingEntity eq 'BILLS'}"
                                                         id="btnGeneraBarcodesBills"
                                                         value="Generate Barcodes by Bills"
                                                         ajax="false" action="#{patientInvestigationController.generateBarcodesForSelectedBills()}"
                                                         title="Generate Barcodes" icon="fas fa-barcode" styleClass="m-1 ui-button-success w-100"/>

                                        <p:commandButton disabled="#{patientInvestigationController.listingEntity ne 'PATIENT_SAMPLES'}"
                                                         id="btnCollectSamples"
                                                         value="Collect Samples"
                                                         ajax="false" action="#{patientInvestigationController.collectSamples()}"
                                                         title="Collect Samples" icon="fas fa-hand-holding-medical" styleClass="m-1 ui-button-primary w-100"/>

                                        <p:commandButton disabled="#{patientInvestigationController.listingEntity ne 'PATIENT_SAMPLES'}"
                                                         id="btnSentToLab"
                                                         value="Sent to Lab"
                                                         ajax="false" action="#{patientInvestigationController.sampleSendToLab()}"
                                                         title="Sent to Lab" icon="fas fa-vials" styleClass="m-1 ui-button-warning w-100"/>

                                        <p:commandButton disabled="#{patientInvestigationController.listingEntity ne 'PATIENT_SAMPLES'}"
                                                         id="btnReceivToLab"
                                                         value="Received Samples"
                                                         ajax="false" action="#{patientInvestigationController.receivedSamples()}"
                                                         title="Sent to Lab" icon="fas fa-vials" styleClass="m-1 ui-button-warning w-100"/>
                                    </h:panelGrid>
                                </h:panelGrid>
                            </div>
                        </div>



                        <div class="row" >
                            <div class="col-12" >

                                <h:panelGroup rendered="#{patientInvestigationController.listingEntity eq 'PATIENT_INVESTIGATIONS'}" >

                                    <p:dataTable  
                                        class="w-100"
                                        value="#{patientInvestigationController.items}" 
                                        var="ptIx" 
                                        paginator="true"
                                        rowKey="#{ptIx.id}"
                                        paginatorPosition="bottom"
                                        selectionMode="multiple"
                                        selection="#{patientInvestigationController.selectedItems}"
                                        rows="10"
                                        paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                        rowsPerPageTemplate="10,25,50"
                                        >



                                        <p:column selectionBox="true" width="2em">
                                        </p:column>

                                        <p:column headerText="Bill Number" width="6em">
                                            <p:commandLink 
                                                ajax="false" 
                                                class="m-2"
                                                value="#{ptIx.billItem.bill.deptId}" 
                                                action="#{billSearch.navigateToViewOpdBill()}">
                                                <f:setPropertyActionListener value="#{ptIx.billItem.bill}" target="#{billSearch.bill}"/>
                                            </p:commandLink>
                                        </p:column>

                                        <p:column headerText="Patient" width="10em">
                                            <h:outputLabel value="#{ptIx.billItem.bill.patient.person.nameWithTitle}" />
                                            <p:spacer width="10" ></p:spacer>
                                            <h:outputLabel value="(#{ptIx.billItem.bill.ipOpOrCc})" class="ml-5"/>
                                        </p:column>

                                        <p:column headerText="Investigations" width="10em">
                                            <h:outputLabel value="#{ptIx.investigation.name}"/>
                                        </p:column>

                                        <p:column headerText="Status" width="5em">
                                            <h:outputLabel value="#{ptIx.status}"/>
                                        </p:column>

                                        <p:column  headerText="Actions" style="width: 11em;">
                                            <p:commandLink 
                                                disabled="#{ptIx.collected or ptIx.billItem.bill.cancelled}"   
                                                id="btnSample" ajax="false"
                                                action="#{patientInvestigationController.markAsSampled}" >
                                                <f:setPropertyActionListener value="#{ptIx}" target="#{patientInvestigationController.current}"></f:setPropertyActionListener>
                                                <p:graphicImage library="image" styleClass="standedicon" name="bleed.png" rendered="#{ptIx.collected ne true}"></p:graphicImage>
                                                <p:graphicImage library="image" styleClass="standedicon" name="bleedok.jpg" rendered="#{ptIx.collected eq true}"></p:graphicImage>
                                            </p:commandLink>
                                            <p:commandButton value="collect" action="#{patientInvestigationController.markAsSampled}" ajax="false" >
                                                <f:setPropertyActionListener value="#{ptIx}" target="#{patientInvestigationController.current}"></f:setPropertyActionListener>
                                            </p:commandButton>
                                            <h:panelGroup rendered="#{webUserController.hasPrivilege('LabSampleReceiving')}">
                                                <p:commandLink  disabled="#{ptIx.collected ne true}"   id="btnReceive"  action="#{patientInvestigationController.markAsReceived()}" >
                                                    <f:setPropertyActionListener value="#{ptIx}" target="#{patientInvestigationController.current}"></f:setPropertyActionListener>
                                                    <p:graphicImage library="image" styleClass="standedicon" name="receive.jpeg" rendered="#{ptIx.received ne true }" ></p:graphicImage>
                                                    <p:graphicImage library="image" styleClass="standedicon" name="receiveok.jpg" rendered="#{ptIx.received eq true}"></p:graphicImage>
                                                </p:commandLink>
                                            </h:panelGroup>

                                            <h:panelGroup rendered="#{ptIx.billItem.bill.cancelled ne true}">
                                                <p:commandLink ajax="false" id="btnPrintWorksheets" disabled="#{ptIx.received ne true}" action="/lab/single_worksheet?faces-redirect=true" >
                                                    <f:setPropertyActionListener value="#{ptIx}" target="#{patientInvestigationController.current}" ></f:setPropertyActionListener>
                                                    <p:graphicImage library="image" styleClass="standedicon" name="worksheet.gif" ></p:graphicImage>
                                                </p:commandLink>
                                            </h:panelGroup>

                                            <p:commandLink id="btnNewReport" ajax="false" 
                                                           disabled="#{!ptIx.received}" 
                                                           action="/lab/patient_report?faces-redirect=true"  
                                                           actionListener="#{patientReportController.createNewReport(ptIx)}" >
                                                <f:setPropertyActionListener value="#{ptIx}" target="#{patientReportController.currentPtIx}"></f:setPropertyActionListener>
                                                <p:graphicImage library="image" styleClass="standedicon" name="data_entry.png" ></p:graphicImage>
                                            </p:commandLink>
                                            <h:panelGroup >
                                                <p:commandLink 
                                                    id="btnSms" 
                                                    rendered="#{!ptIx.billItem.bill.smsed}"
                                                    disabled="#{ptIx.billItem.bill.cancelled or ptIx.billItem.transRefund or ptIx.patientReports.size() eq 0}"
                                                    action="#{patientInvestigationController.sendSms()}" >
                                                    <f:setPropertyActionListener value="#{ptIx}" target="#{patientInvestigationController.current}"></f:setPropertyActionListener>
                                                    <p:graphicImage library="image" styleClass="standedicon" name="sms.jpg" ></p:graphicImage>
                                                </p:commandLink>
                                                <p:commandLink 
                                                    id="btnSmsSent"
                                                    rendered="#{ptIx.billItem.bill.smsed}"
                                                    disabled="#{ptIx.billItem.bill.cancelled or ptIx.billItem.transRefund or ptIx.patientReports.size() eq 0}"
                                                    action="#{patientInvestigationController.sendSms()}" >
                                                    <f:setPropertyActionListener value="#{ptIx}" target="#{patientInvestigationController.current}"></f:setPropertyActionListener>
                                                    <p:graphicImage library="image" styleClass="standedicon" name="smssent.png" ></p:graphicImage>
                                                </p:commandLink>

                                            </h:panelGroup>

                                            <p:tooltip for="btnReceive"  >
                                                <h:outputLabel value="Receive Sample" rendered="#{!ptIx.received}" ></h:outputLabel>
                                                <h:outputLabel value="Sample received at " rendered="#{ptIx.received}" ></h:outputLabel>
                                                <h:outputLabel value="#{ptIx.receivedAt}" rendered="#{ptIx.received}" >
                                                    <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a"/>
                                                </h:outputLabel>
                                            </p:tooltip>

                                            <p:tooltip for="btnSample" value="Collect Sample" >
                                                <h:outputLabel value="Collect Sample" rendered="#{!ptIx.collected }" ></h:outputLabel>
                                                <h:outputLabel value="Sampled at " rendered="#{ptIx.collected}" ></h:outputLabel>
                                                <h:outputLabel value="#{ptIx.sampledAt}" rendered="#{ptIx.collected}" >
                                                    <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a"/>
                                                </h:outputLabel>
                                            </p:tooltip>

                                            <p:tooltip for="btnNewReport" value="New Report" ></p:tooltip>

                                            <p:tooltip for="btnPrintWorksheets" value="Print worksheet" ></p:tooltip>


                                            <table >
                                                <ui:repeat value="#{itemForItemController.getItemsForParentItem(pi.investigation)}" var="ifi"  >
                                                    <tr>
                                                        <td>
                                                            <p:commandLink disabled="#{!pi.received}" value="New #{ifi.name}" actionListener="#{patientReportController.enterNewReportFormat(pi, ifi)}" action="/lab/patient_report?faces-redirect=true" 
                                                                           ajax="false">
                                                            </p:commandLink>
                                                        </td>
                                                    </tr>
                                                </ui:repeat>
                                            </table>


                                        </p:column>

                                        <p:column headerText="Details">
                                            <h:panelGrid columns="1">
                                                <h:outputLabel value="Sample Collected" rendered="#{ptIx.sampleCollected}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleCollected}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleCollectedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleCollectedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Sent" rendered="#{ptIx.sampleSent}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleSent}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleSentAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleSentBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Received" rendered="#{ptIx.received}"/>
                                                <p:panelGrid rendered="#{ptIx.received}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.receivedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.receiveInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.receivedCollecter.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Approved" rendered="#{ptIx.sampleApproved}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleApproved}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleApprovedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleApprovedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Generated" rendered="#{ptIx.sampleGenerated}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleGenerated}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleGeneratedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleGeneratedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Interfaced" rendered="#{ptIx.sampleInterfaced}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleInterfaced}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInterfacedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInterfacedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Recollected" rendered="#{ptIx.sampleRecollected}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleRecollected}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleRecollectedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleRecollectedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Rejected" rendered="#{ptIx.sampleRejected}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleRejected}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleRejectedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleRejectedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Repeated" rendered="#{ptIx.sampleRepeated}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleRepeated}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleRepeatedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleRepeatedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Resent" rendered="#{ptIx.sampleResent}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleResent}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleResentAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleResentBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Sample Reverted" rendered="#{ptIx.sampleReverted}"/>
                                                <p:panelGrid rendered="#{ptIx.sampleReverted}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleRevertedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.sampleRevertedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Report Printed" rendered="#{ptIx.reportPrinted}"/>
                                                <p:panelGrid rendered="#{ptIx.reportPrinted}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.reportPrintedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.printingInstitution.name}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.reportPrintedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Report Handed Over" rendered="#{ptIx.reportHandedOver}"/>
                                                <p:panelGrid rendered="#{ptIx.reportHandedOver}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.reportHandedOverAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>Institution:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.reportHandedOverBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Report Reached Collecting Centre" rendered="#{ptIx.reportReachedCollectingCentre}"/>
                                                <p:panelGrid rendered="#{ptIx.reportReachedCollectingCentre}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.reportReachedCollectingCentreAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.reportReachedCollectingCentreBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <h:outputLabel value="Report Distributed" rendered="#{ptIx.reportDistributed}"/>
                                                <p:panelGrid rendered="#{ptIx.reportDistributed}" columns="2" styleClass="ui-widget-content ui-corner-all" style="display:none">
                                                    <p:row>
                                                        <p:column>Time:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.reportDistributedAt}" /></p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column>User:</p:column>
                                                        <p:column><h:outputText value="#{ptIx.reportDistributedBy.name}" /></p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                            </h:panelGrid>
                                        </p:column>




                                    </p:dataTable>

                                </h:panelGroup>

                                <h:panelGroup rendered="#{patientInvestigationController.listingEntity eq 'BILLS'}" >

                                    <p:dataTable  
                                        class="w-100"
                                        value="#{patientInvestigationController.bills}" 
                                        var="b" 
                                        paginator="true"
                                        rowKey="#{b.id}"
                                        paginatorPosition="bottom"
                                        selectionMode="multiple"
                                        selection="#{patientInvestigationController.selectedBills}"
                                        rows="10"
                                        paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                        rowsPerPageTemplate="10,25,50"
                                        >

                                        <p:column selectionBox="true" width="2em">
                                        </p:column>

                                        <p:column headerText="Bill Number" width="6em">
                                            <p:commandLink 
                                                ajax="false" 
                                                class="m-2"
                                                value="#{b.deptId}" 
                                                action="#{billSearch.navigateToViewOpdBill()}">
                                                <f:setPropertyActionListener value="#{b}" target="#{billSearch.bill}"/>
                                            </p:commandLink>
                                        </p:column>

                                        <p:column headerText="Patient" width="10em">
                                            <h:outputLabel value="#{b.patient.person.nameWithTitle}" />
                                            <p:spacer width="10" ></p:spacer>
                                            <h:outputLabel value="(#{b.ipOpOrCc})" class="ml-5"/>
                                        </p:column>


                                        <p:column headerText="Ordered Institute" width="10em">
                                            <h:outputLabel value="#{b.institution.name}"/>
                                        </p:column>

                                        <p:column headerText="Ordered Department" width="10em">
                                            <h:outputLabel value="#{b.department.name}"/>
                                        </p:column>


                                        <p:column headerText="Service Institute" width="10em">
                                            <h:outputLabel value="#{b.toInstitution.name}"/>
                                        </p:column>

                                        <p:column headerText="Service Department" width="10em">
                                            <h:outputLabel value="#{b.toDepartment.name}"/>
                                        </p:column>

                                        <p:column headerText="Colelcting Centre" width="10em">
                                            <h:outputLabel value="#{b.fromInstitution.name}"/>
                                            <h:outputLabel value="#{b.collectingCentre.name}"/>
                                        </p:column>

                                    </p:dataTable>

                                </h:panelGroup>

                                <h:panelGroup rendered="#{patientInvestigationController.listingEntity eq 'BILL_BARCODES'}">
                                    <p:commandButton ajax="false" value="Print">
                                        <p:printer target="batchBarcode"></p:printer>
                                    </p:commandButton>
                                    <h:panelGroup id="batchBarcode">
                                        <ui:repeat value="#{patientInvestigationController.selectedBillBarcodes}" var="smpIx">
                                            <ui:repeat value="#{smpIx.patientSampleWrappers}" var="psc">
                                                <div class="sticker">
                                                    <div class="patient-info">
                                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Sample ID PHN in Sample Stickers', true)}">
                                                            <span class="sample-id">
                                                                #{psc.patientSample.idStr}&nbsp;&nbsp;
                                                            </span>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient Age in Sample Stickers')}">
                                                            <span class="patient-age">
                                                                #{psc.patientSample.patient.person.ageAsShortString}&nbsp;&nbsp;
                                                            </span>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient Sex in Sample Stickers')}">
                                                            <span class="patient-sex">
                                                                #{psc.patientSample.patient.person.sex.shortLabel}&nbsp;&nbsp;
                                                            </span>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient ID in Sample Stickers')}">
                                                            <span class="patient-id">
                                                                #{psc.patientSample.patient.person.id}&nbsp;&nbsp;
                                                            </span>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Bill Type (IP/OP/CC) in Sample Stickers')}">
                                                            <span class="patient-id">
                                                                #{psc.patientSample.bill.ipOpOrCc}&nbsp;&nbsp;
                                                            </span>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Barcode Generated Time in Sample Stickers')}">
                                                            <span class="patient-id">
                                                                <h:outputLabel value="#{psc.patientSample.barcodeGeneratedAt}">
                                                                    <f:convertDateTime pattern="#{configOptionApplicationController.getShortTextValueByKey('Date Time Format for Barcode Generated Time in Sample Stickers','d/M/yy-hh:mm')}"></f:convertDateTime>
                                                                </h:outputLabel>
                                                                &nbsp;&nbsp;
                                                            </span>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Patient PHN in Sample Stickers')}">
                                                            <span class="patient-phn">
                                                                #{psc.patientSample.patient.phn}
                                                            </span>
                                                        </h:panelGroup>
                                                        <span class="patient-name">
                                                            #{psc.patientSample.patient.person.name}&nbsp;&nbsp;
                                                        </span>
                                                    </div>
                                                    <div class="patient-sample-info">
                                                        <ui:repeat value="#{patientInvestigationController.getPatientSampleComponentsByPatientSample(psc.patientSample)}" var="psw">
                                                            <span class="sample-component">
                                                                #{psw.investigationComponant.name} &nbsp;&nbsp;
                                                            </span>
                                                        </ui:repeat>
                                                    </div>
                                                    <div class="barcode-info">
                                                        <h:panelGroup rendered="#{configOptionApplicationController.getBooleanValueByKey('Print Barcode in Sample Stickers')}">
                                                            <p:barcode value="#{psc.patientSample.idStr}" 
                                                                       cache="false"
                                                                       hrp="none"
                                                                       type="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Type','code128')}" 
                                                                       height="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Height in Pixles','80')}"
                                                                       width="#{configOptionApplicationController.getShortTextValueByKey('Sample Sticker - Barcode Width in Pixles','300')}"
                                                                       orientation="0"></p:barcode>
                                                        </h:panelGroup>
                                                    </div>
                                                </div>
                                            </ui:repeat>
                                        </ui:repeat>
                                    </h:panelGroup> 
                                </h:panelGroup>


                                <h:panelGroup rendered="#{patientInvestigationController.listingEntity eq 'PATIENT_SAMPLES'}">

                                    <p:dataTable  
                                        class="w-100"
                                        value="#{patientInvestigationController.patientSamples}"
                                        var="ps" 
                                        paginator="true"
                                        rowKey="#{ps.id}"
                                        paginatorPosition="bottom"
                                        selectionMode="multiple"
                                        selection="#{patientInvestigationController.selectedPatientSamples}"
                                        rows="10"
                                        paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                        rowsPerPageTemplate="10,25,50"
                                        >

                                        <p:column selectionBox="true" width="2em">
                                        </p:column>
                                        <p:column headerText="Sample ID">
                                            <p:outputLabel value="#{ps.id}" ></p:outputLabel>
                                        </p:column>
                                        <p:column headerText="Status">
                                            <p:badge value="Collected" rendered="#{ps.sampleCollected}" severity="success" styleClass="mr-2 mx-1"></p:badge>
                                            <p:badge value="Sent To Lab" rendered="#{ps.sampleSent}" severity="warning" styleClass="mr-2"></p:badge>
                                            <p:badge value="Received" rendered="#{ps.sampleReceivedAtLab}" severity="info" styleClass="mr-2 mx-1"></p:badge>
                                        </p:column>
                                        <p:column headerText="Investigation">
                                            <p:outputLabel value="#{ps.patientInvestigation}" ></p:outputLabel>
                                        </p:column>
                                        <p:column headerText="Sample Number">
                                            <p:inputText id="txtSampleId" value="#{ps.sampleId}" class="mx-2" />
                                            <p:commandButton 
                                                id="btnUpdateSampleId"
                                                value="Update" 
                                                action="#{patientSampleController.savePatientSample(ps)}" 
                                                process="btnUpdateSampleId txtSampleId" >
                                            </p:commandButton>
                                        </p:column>
                                        <p:column headerText="Details">
                                            <p:panel header="Details" collapsed="true" toggleable="true" >
                                                <!-- Basic Details PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="basic-details-grid">
                                                    <h:outputText value="ID" />
                                                    <h:outputText value="#{ps.id}" />

                                                    <h:outputText value="Sample ID" />
                                                    <h:outputText value="#{ps.sampleId}" />

                                                    <h:outputText value="Institution" />
                                                    <h:outputText value="#{ps.institution.name}" />

                                                    <h:outputText value="Department" />
                                                    <h:outputText value="#{ps.department.name}" />

                                                    <h:outputText value="Patient" />
                                                    <h:outputText value="#{ps.patient.person.nameWithTitle}" />

                                                    <h:outputText value="Patient Investigation" />
                                                    <h:outputText value="#{ps.patientInvestigation.name}" />

                                                    <h:outputText value="Bill Amount" />
                                                    <h:outputText value="#{ps.bill.insId}" />
                                                </p:panelGrid>

                                                <!-- Barcode Generation PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="barcode-generation-grid" >
                                                    <h:outputText value="Barcode Generation Details" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Barcode Generated" />
                                                    <h:outputText value="#{ps.barcodeGenerated ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Barcode Generated At" />
                                                    <h:outputText value="#{ps.barcodeGeneratedAt}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                                                    </h:outputText>

                                                    <h:outputText value="Barcode Generated By" />
                                                    <h:outputText value="#{ps.barcodeGenerator.webUserPerson.nameWithTitle}" />

                                                    <h:outputText value="Barcode Generated Department" />
                                                    <h:outputText value="#{ps.barcodeGeneratedDepartment.name}" />

                                                    <h:outputText value="Barcode Generated Institution" />
                                                    <h:outputText value="#{ps.barcodeGeneratedInstitution.name}" />
                                                </p:panelGrid>

                                                <!-- Sample Collection Details PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="collection-details-grid" >
                                                    <h:outputText value="Sample Collection Details" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Sample Collected" />
                                                    <h:outputText value="#{ps.sampleCollected ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Collected By" />
                                                    <h:outputText value="#{ps.sampleCollecter.webUserPerson.nameWithTitle}" />

                                                    <h:outputText value="Collected At" />
                                                    <h:outputText value="#{ps.sampleCollectedAt}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                                                    </h:outputText>

                                                    <h:outputText value="Collected Department" />
                                                    <h:outputText value="#{ps.sampleCollectedDepartment.name}" />

                                                    <h:outputText value="Collected Institution" />
                                                    <h:outputText value="#{ps.sampleCollectedInstitution.name}" />

                                                    <h:outputText value="Collected Outside" />
                                                    <h:outputText value="#{ps.sampleCollectedOutside ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Collection Comments" />
                                                    <h:outputText value="#{ps.sampleCollectionComments}" />
                                                </p:panelGrid>

                                                <!-- Sent to Lab Details PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="sent-to-lab-grid" >
                                                    <h:outputText value="Sent to Lab Details" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Sample Sent" />
                                                    <h:outputText value="#{ps.sampleSent ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Sent By" />
                                                    <h:outputText value="#{ps.sampleSentBy.webUserPerson.nameWithTitle}" />

                                                    <h:outputText value="Sent At" />
                                                    <h:outputText value="#{ps.sampleSentAt}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                                                    </h:outputText>
                                                </p:panelGrid>

                                                <!-- Sample Received at Lab PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="sample-received-grid" >
                                                    <h:outputText value="Sample Received at Lab Details" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Sample Received at Lab" />
                                                    <h:outputText value="#{ps.sampleReceivedAtLab ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Received By" />
                                                    <h:outputText value="#{ps.sampleReceiverAtLab.webUserPerson.nameWithTitle}" />

                                                    <h:outputText value="Received At" />
                                                    <h:outputText value="#{ps.sampleReceivedAtLabAt}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                                                    </h:outputText>

                                                    <h:outputText value="Received Department" />
                                                    <h:outputText value="#{ps.sampleReceivedAtLabDepartment.name}" />

                                                    <h:outputText value="Received Institution" />
                                                    <h:outputText value="#{ps.sampleReceivedAtLabInstitution.name}" />

                                                    <h:outputText value="Received Comments" />
                                                    <h:outputText value="#{ps.sampleReceivedAtLabComments}" />
                                                </p:panelGrid>

                                                <!-- Sent to Analyzer Details PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="sent-to-analyzer-grid" >
                                                    <h:outputText value="Sent to Analyzer Details" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Ready to Send to Analyzer" />
                                                    <h:outputText value="#{ps.readyTosentToAnalyzer ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Sent to Analyzer" />
                                                    <h:outputText value="#{ps.sentToAnalyzer ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Sent to Analyzer By" />
                                                    <h:outputText value="#{ps.sentToAnalyzerBy.webUserPerson.nameWithTitle}" />

                                                    <h:outputText value="Sent to Analyzer At" />
                                                    <h:outputText value="#{ps.sentToAnalyzerAt}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                                                    </h:outputText>

                                                    <h:outputText value="Analyzer Department" />
                                                    <h:outputText value="#{ps.sentToAnalyzerDepartment.name}" />

                                                    <h:outputText value="Analyzer Institution" />
                                                    <h:outputText value="#{ps.sentToAnalyzerInstitution.name}" />

                                                    <h:outputText value="Analyzer Comments" />
                                                    <h:outputText value="#{ps.sentToAnalyzerComments}" />
                                                </p:panelGrid>

                                                <!-- Received from Analyzer Details PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="received-from-analyzer-grid" >
                                                    <h:outputText value="Received from Analyzer Details" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Received from Analyzer" />
                                                    <h:outputText value="#{ps.receivedFromAnalyzer ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Received from Analyzer By" />
                                                    <h:outputText value="#{ps.receivedFromAnalyzerBy.webUserPerson.nameWithTitle}" />

                                                    <h:outputText value="Received from Analyzer At" />
                                                    <h:outputText value="#{ps.receivedFromAnalyzerAt}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                                                    </h:outputText>

                                                    <h:outputText value="Received Analyzer Department" />
                                                    <h:outputText value="#{ps.receivedFromAnalyzerDepartment.name}" />

                                                    <h:outputText value="Received Analyzer Institution" />
                                                    <h:outputText value="#{ps.receivedFromAnalyzerInstitution.name}" />

                                                    <h:outputText value="Received Analyzer Comments" />
                                                    <h:outputText value="#{ps.receivedFromAnalyzerComments}" />
                                                </p:panelGrid>

                                                <!-- Final Status PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="final-status-grid" >
                                                    <h:outputText value="Final Status" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Priority" />
                                                    <h:outputText value="#{ps.priority}" />

                                                    <h:outputText value="Investigation Component" />
                                                    <h:outputText value="#{ps.investigationComponant.name}" />

                                                    <h:outputText value="Test" />
                                                    <h:outputText value="#{ps.test.name}" />

                                                    <h:outputText value="Tube" />
                                                    <h:outputText value="#{ps.tube.name}" />

                                                    <h:outputText value="Machine" />
                                                    <h:outputText value="#{ps.machine.name}" />

                                                    <h:outputText value="Status" />
                                                    <h:outputText value="#{ps.status}" />
                                                </p:panelGrid>

                                                <!-- Cancellation Details PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="cancellation-grid" >
                                                    <h:outputText value="Cancellation Details" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Cancelled" />
                                                    <h:outputText value="#{ps.cancelled ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Cancelled By" />
                                                    <h:outputText value="#{ps.cancelledUser.webUserPerson.nameWithTitle}" />

                                                    <h:outputText value="Cancelled At" />
                                                    <h:outputText value="#{ps.cancelledAt}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                                                    </h:outputText>

                                                    <h:outputText value="Cancellation Department" />
                                                    <h:outputText value="#{ps.cancellDepartment.name}" />

                                                    <h:outputText value="Cancellation Institution" />
                                                    <h:outputText value="#{ps.cancellInstitution.name}" />

                                                    <h:outputText value="Cancellation Comments" />
                                                    <h:outputText value="#{ps.cancellComments}" />
                                                </p:panelGrid>

                                                <!-- Retiring Details PanelGrid -->
                                                <p:panelGrid columns="2" styleClass="retiring-grid" >
                                                    <h:outputText value="Retiring Details" />
                                                    <h:outputText value=""/>

                                                    <h:outputText value="Retired" />
                                                    <h:outputText value="#{ps.retired ? 'Yes' : 'No'}" />

                                                    <h:outputText value="Retired By" />
                                                    <h:outputText value="#{ps.retirer.webUserPerson.nameWithTitle}" />

                                                    <h:outputText value="Retired At" />
                                                    <h:outputText value="#{ps.retiredAt}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                                                    </h:outputText>

                                                    <h:outputText value="Retirement Comments" />
                                                    <h:outputText value="#{ps.retireComments}" />
                                                </p:panelGrid>

                                            </p:panel>

                                            <p:outputLabel value="#{ps.sampleId}" ></p:outputLabel>
                                        </p:column>

                                    </p:dataTable>

                                </h:panelGroup>

                            </div>
                        </div>


                    </div>









                </h:form>
            </h:panelGroup>
        </ui:define>
    </ui:composition>
</html>