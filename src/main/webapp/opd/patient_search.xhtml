<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Patient Lookup &amp; Registration</title>
        <h:outputStylesheet library="css" name="styles.css" ></h:outputStylesheet>
    </h:head>
    <h:body>

        <ui:composition template="/resources/template/template.xhtml">

            <ui:define name="content">



                <p:panel header="" style="height: 100vh;" >
                    <div>
                        <f:facet name="header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h:outputText value="Patient Lookup &amp; Registration"/>
                                <div>
                                    <h:form>
                                        <div>
                                            <p:inputText 
                                                id="txtPhoneSearch"
                                                value="#{patientController.searchPatientPhoneNumber}"
                                                placeholder="Phone Number or PHN "
                                                class="mx-2"
                                                />
                                            <p:focus id="focusPhoneSearch" for="txtPhoneSearch" ></p:focus>

                                            <p:commandButton 
                                                id="btnSearchbyPhoneNo"
                                                icon="fa fa-search"
                                                value="Quick Search"
                                                action="#{patientController.searchByPatientPhoneNumberForPatientLookup()}" 
                                                ajax="false" 
                                                class="mt-2 ml-2" 
                                                style="width: auto;"/>

                                            <p:defaultCommand target="btnSearchbyPhoneNo"> </p:defaultCommand>
                                        </div>
                                    </h:form>
                                </div>
                            </div>
                        </f:facet>
                    </div>
                    <h:form>
                        <div class="row">
                            <div class="col-md-2">

                                <div class="mb-3 w-100 d-flex align-items-center justify-content-between">
                                    <!-- First three buttons -->
                                    <div>
                                        <p:commandButton 
                                            value="New"
                                            action="#{patientController.navigateToAddNewPatientForOpd()}" 
                                            ajax="false"
                                            icon="fa-solid fa-plus"
                                            class=" ui-button-success" />

                                        <p:commandButton 
                                            id="btnSearch"
                                            value="Search"
                                            icon="fa-solid fa-search"
                                            action="#{patientController.searchPatientForOpd()}" 
                                            ajax="false" 
                                            class="mx-3 ui-button-warning" />
                                        <p:defaultCommand target="btnSearch"> </p:defaultCommand>

                                        <p:commandButton 
                                            value="Clear" 
                                            action="#{patientController.clearSearchDetails()}"
                                            ajax="false" 
                                            icon="fa-solid fa-eraser" 
                                            class=" ui-button-danger"/>
                                    </div>

                                    <!-- Right-aligned controls -->

                                </div>


                                <div class="mb-3">
                                    <h:outputLabel value="Name" class="form-label" />
                                    <p:inputText class="form-control" value="#{patientController.searchName}">
                                    </p:inputText>
                                </div>

                                <div class="mb-3">
                                    <h:outputLabel value="Phone Number" class="form-label" />
                                    <p:inputText id="txtNewPtPhone" 
                                                 class="form-control"
                                                 autocomplete="off" 
                                                 value="#{patientController.searchPhone}"
                                                 validatorMessage="Please enter a valid phone number (numbers only)"
                                                 >
                                        <!--<f:validateRegex pattern="^[0-9]*$"/>-->
                                    </p:inputText>

                                </div>

                                <div class="mb-3">
                                    <h:outputLabel class="form form-label" value="NIC / Passport" ></h:outputLabel>
                                    <p:inputText  class="form form-control"  autocomplete="off"  value="#{patientController.searchNic}"></p:inputText>
                                </div>

                                <div class="mb-3">
                                    <h:outputLabel class="form form-label" value="PHN" ></h:outputLabel>
                                    <p:inputText  class="form form-control"  autocomplete="off"  value="#{patientController.searchPhn}"></p:inputText>
                                </div>

                                <div class="mb-3">

                                    <h:outputLabel class="form form-label" value="Patient Code" ></h:outputLabel>
                                    <p:inputText  class="form form-control"  autocomplete="off"  value="#{patientController.searchPatientCode}"></p:inputText>
                                </div>

                                <div class="mb-3">
                                    <h:outputLabel class="form form-label" value="Patient ID" ></h:outputLabel>
                                    <p:inputText  class="form form-control"  autocomplete="off"  value="#{patientController.searchPatientId}"></p:inputText>
                                </div>

                                <div class="mb-3">
                                    <h:outputLabel class="form form-label" value="Bill ID" ></h:outputLabel>
                                    <p:inputText  class="form form-control"  autocomplete="off"  value="#{patientController.searchBillId}"></p:inputText>
                                </div>

                                <div class="mb-3">
                                    <h:outputLabel class="form form-label" value="Sample ID" ></h:outputLabel>
                                    <p:inputText  class="form form-control"  autocomplete="off"  value="#{patientController.searchSampleId}"></p:inputText>

                                </div>

                                <div class="mb-3" style="display: #{configOptionApplicationController.getBooleanValueByKey('Enable patient specific status management in the system') ? 'block' : 'none'}">
                                    <h:outputLabel class="form form-label" value="Patient Specific Status" ></h:outputLabel>
                                    <p:selectOneMenu class="w-100" id="specificStatus" value="#{patientController.specificPatientStatus}">
                                        <f:selectItem itemLabel="Select a status" itemValue="#{null}"/>
                                        <f:selectItems value="#{patientController.getAllPatientSpecificLabels()}"/>
                                    </p:selectOneMenu>

                                </div>
                                
                                <div class="mb-3" style="display: #{configOptionApplicationController.getBooleanValueByKey('Enable patient specific status management in the system') ? 'block' : 'none'}">
                                    <h:outputLabel class="form form-label" value="Patient Active Status" ></h:outputLabel><br></br>
                                    <p:selectBooleanButton class="w-100" value="#{patientController.blackListStatus}" onLabel="Blacklist" onIcon="pi pi-times" offLabel="Active" offIcon="pi pi-check"/>

                                </div>
                            </div>
                            <div class="col-md-10">


                                <p:dataTable 
                                    value="#{patientController.searchedPatients}" 
                                    var="p" 
                                    class="w-100 table table-sm table-striped"
                                    paginatorAlwaysVisible="false"
                                    paginator="true"
                                    rows="8"
                                    rowIndexVar="i"
                                    paginatorPosition="bottom"
                                    paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                    rowsPerPageTemplate="5,10,20"
                                    >
                                    <p:column headerText="NO" width="5%">
                                        <p:outputLabel value="#{i+1}"></p:outputLabel> 
                                    </p:column>
                                    <p:column headerText="Patient Name" width="25%" filterMatchMode="contains" filterBy="#{p.person.name}">
                                        <p:outputLabel style="font-weight: bold"  value="#{p.person.nameWithTitle}" ></p:outputLabel>
                                        <p:outputLabel rendered="#{p.person.sex == 'Male'}">
                                            <i class="fas fa-mars mx-2" style="color: blue;  font-size: 24px;"></i>
                                        </p:outputLabel>

                                        <p:outputLabel rendered="#{p.person.sex == 'Female'}">
                                            <i class="fas fa-venus mx-2" style="color: pink; font-size: 24px;"></i>
                                        </p:outputLabel>
                                        <br/>

                                        <p:outputLabel value="#{p.person.ageAsString == 'Not Recorded' ? 'N/A' : p.person.ageAsString}"></p:outputLabel>
                                        <br/>
                                        <p:outputLabel value="#{p.person.phone}">
                                        </p:outputLabel>
                                        <p:outputLabel rendered="#{not empty p.person.phone and p.person.phone ne ''}" value=",&nbsp; "></p:outputLabel>
                                        <br/>
                                        <p:outputLabel value="#{p.phn}"></p:outputLabel>
                                        <p:outputLabel value="#{p.person.address}"></p:outputLabel>
                                    </p:column>

                                    <p:column style="text-align: center" headerText="Patient Status" width="10%" rendered="#{configOptionApplicationController.getBooleanValueByKey('Enable patient specific status management in the system')}">
                                        <p:outputLabel value="X Blaclisted" class="px-3" rendered="#{p.blacklisted}" style="color: #FF401F; font-weight: bold; padding: 5px; border-radius: 15px;"></p:outputLabel>
                                        <p:outputLabel value="Active" class="px-3" rendered="#{!p.blacklisted}" style="color: green; font-weight: bold; padding: 5px; border-radius: 15px;"></p:outputLabel>
                                        <p:outputLabel value="#{p.specificStatus}" class="px-3" rendered="#{not empty p.specificStatus}" style="color: EB7633; font-weight: bold; padding: 5px; border-radius: 15px;"></p:outputLabel>
                                        <p:outputLabel value="NORMAL" class="px-3" rendered="#{empty p.specificStatus}" style="color: EB7633; font-weight: bold; padding: 5px; border-radius: 15px;"></p:outputLabel>
                                    </p:column>

                                    <p:column headerText="Actions" width="65%">
                                        <div class="row g-2">
                                            <!-- Your p:commandButton elements here wrapped in col divs -->
                                            <div class="col-auto gap-2">

                                                <p:commandButton 
                                                    value="Profile" 
                                                    action="#{patientController.navigateToOpdPatientProfile()}" 
                                                    ajax="false" 
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Edit" 
                                                    action="#{patientController.navigateToOpdPatientEdit()}" 
                                                    ajax="false" 
                                                    disabled="#{! webUserController.hasPrivilege('LabEditPatient')}"
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="OPD Bill" 
                                                    action="#{patientController.navigateToOpdBillFromOpdPatient()}" 
                                                    ajax="false" 
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="OPD Billing for Cashier" 
                                                    action="#{patientController.navigateToBillingForCashierFromPatientProfile()}" 
                                                    ajax="false" 
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Collecting Centre Billing"
                                                    action="#{patientController.navigateToCollectingCenterBillingFromPatientProfile()}"
                                                    ajax="false"
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="OPD Package Bill" 
                                                    action="#{patientController.navigateToOpdPackageBillFromOpdPatient()}" 
                                                    ajax="false" 
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton
                                                    value="Admit" 
                                                    action="#{patientController.navigateToAdmitFromPatientProfile()}" 
                                                    ajax="false" 
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Inward Appointments"
                                                    action="#{patientController.navigateToInwardAppointmentFromPatientProfile()}"
                                                    ajax="false"
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Accept Payments" 
                                                    action="#{patientController.toEmrPatientProfile()}" 
                                                    ajax="false" 
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Refunds" 
                                                    action="#{patientController.toEmrPatientProfile()}" 
                                                    ajax="false" 
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Lab Reports" 
                                                    action="#{searchController.navigateToPatientLabReports}" 
                                                    ajax="false" 
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{searchController.patient}" ></f:setPropertyActionListener>
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Receive Deposits"
                                                    action="#{patientDepositController.navigateToReciveDepositWithPatient(p)}"
                                                    ajax="false"
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Patient Deposit History"
                                                    action="/patient_deposit/patient_deposit_history?faces-redirect=true"
                                                    actionListener="#{patientDepositController.clearDataForPatientDepositHistory()}"
                                                    ajax="false"
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>
                                                <p:commandButton 
                                                    value="Clinical Data"
                                                    action="#{patientController.toEmrPatientProfile}"
                                                    ajax="false"
                                                    styleClass="mx-1 mb-2">
                                                    <f:setPropertyActionListener value="#{p}" target="#{patientController.current}" />
                                                </p:commandButton>

                                            </div>
                                        </div>
                                    </p:column>

                                </p:dataTable>

                            </div>
                        </div>
                    </h:form>
                </p:panel>

                <div class="container">

                </div>

            </ui:define>

        </ui:composition>

    </h:body>
</html>
