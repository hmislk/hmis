<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/resources/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ch="http://java.sun.com/jsf/composite/channel"
                xmlns:pa="http://java.sun.com/jsf/composite/paymentMethod"
                xmlns:au="http://java.sun.com/jsf/composite/autocomplete"
                xmlns:pat="http://java.sun.com/jsf/composite/patient"
                xmlns:ezcommon="http://java.sun.com/jsf/composite/ezcomp/common"
                xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp">

    <ui:define name="content">

        <h:form id="form">

            <p:panel >
                <f:facet name="header">
                    <div class="d-flex justify-content-between">
                        <h:outputText value="Manage Booking" class="mt-2"></h:outputText>
                        <div class="d-flex gap-2">
                            <p:commandButton 
                                ajax="false" 
                                value="Add New Booking" 
                                icon="fas fa-plus"
                                class="ui-button-success"
                                action="#{bookingController.navigateToAddBooking()}"
                                />
                            <p:commandButton 
                                ajax="false" 
                                class="mx-1 ui-button-secondary"
                                value="Back to Bookings" 
                                action="#{bookingController.navigateBackToBookings()}"
                                icon="fa-solid fa-arrow-left" />
                        </div>
                    </div>

                </f:facet>
                <p:tabView id="detail">
                    <p:tab title="Booking" id="booking" class="w-100">
                        <h:panelGroup rendered="#{bookingController.selectedBillSession.markedToCancel}" class="w-100 bg-danger text-white p-2" layout="block">
                            <i class="fas fa-ban text-white m-3"></i>
                            <h:outputText value="Marked to Cancel" />
                        </h:panelGroup>
                        <h:panelGroup rendered="#{bookingController.selectedBillSession.markedToRefund}"  class="w-100 bg-danger text-white p-2" layout="block">
                            <i class="fas fa-undo-alt  text-white m-3" ></i>
                            <h:outputText value="Marked to Refund"  />
                        </h:panelGroup>
                        <!-- More Labels and Output Below -->
                        <h:panelGrid columns="2" >
                            <p:panel header="Booking" rendered="#{bookingController.selectedBillSession.bill.paidBill eq null and bookingController.selectedBillSession.bill.balance ne 0.0}">
                                <div class="ui-message-error ui-widget ui-corner-all">
                                    <span class="ui-message-error-icon"/>
                                    <span class="ui-message-error-detail">
                                        <h:outputText value="NOT PAID YET" ></h:outputText>
                                    </span>
                                </div>



                                <h:panelGrid columns="2">
                                    <p:outputLabel value="Name"/>
                                    <p:commandLink value="#{bookingController.selectedBillSession.bill.patient.person.nameWithTitle}"
                                                   action="#{patientController.toPatientFromSearchPatients()}">
                                        <f:setPropertyActionListener value="#{bookingController.selectedBillSession.bill.patient}"
                                                                     target="#{patientController.current}" ></f:setPropertyActionListener>
                                    </p:commandLink>
                                    <p:outputLabel value="Consultant"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.serviceSession.staff.person.nameWithTitle}"/>
                                    <p:outputLabel value="Serial No"/>
                                    <ui:repeat value="#{bookingController.selectedBillSession.bill.billItems}" var="bis" >
                                        <p:outputLabel value="#{bis.billSession.serialNo}"/>
                                    </ui:repeat>
                                    <p:outputLabel value="Appointment Date">
                                    </p:outputLabel>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.sessionDate}"> 
                                        <f:convertDateTime pattern="dd MMM yyyy" >
                                        </f:convertDateTime>
                                    </p:outputLabel>
                                    <p:outputLabel value="Appointment Time">
                                    </p:outputLabel>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.serviceSession.startingTime}"> 
                                        <f:convertDateTime pattern="hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>
                                    <p:separator ></p:separator>
                                    <p:separator ></p:separator>
                                    <p:outputLabel value="Payment Method"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paymentMethod}"/>
                                    <p:outputLabel value="Agent" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.fromInstitution.name}" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="Agent Ref No" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.billItem.agentRefNo}" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="Staff Name" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Staff'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.toStaff.person.nameWithTitle} - (#{bookingController.selectedBillSession.bill.toStaff.code}) " rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Staff'}"/>
                                    <p:outputLabel value="User"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.creater.webUserPerson.nameWithTitle}"/>
                                    <p:outputLabel value="Booked At"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.createdAt}"> 
                                        <f:convertDateTime pattern="dd MMM yyyy - hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>

                                    <p:outputLabel value="Settled At" rendered="#{bookingController.selectedBillSession.bill.paidBill ne null}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paidBill.createdAt}" rendered="#{bookingController.selectedBillSession.bill.paidBill ne null}"> 
                                        <f:convertDateTime pattern="dd MMM yyyy - hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>
                                    <p:separator rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}" ></p:separator>
                                    <p:separator rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}" ></p:separator>
                                    <p:outputLabel style="color: red" value="Payment" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}" />
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.billedBill.paymentMethod}" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}"/>
                                    <p:outputLabel style="color: red" value="Cancel/Refund User" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.billedBill.creater.webUserPerson.nameWithTitle}" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}"/>
                                    <p:outputLabel style="color: red" value="Cancel/Refund At" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.billedBill.createdAt}" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}">
                                        <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a"  ></f:convertDateTime>
                                    </p:outputLabel> 
                                </h:panelGrid>                            
                            </p:panel>

                            <p:panel header="Booking &amp; Settling" rendered="#{bookingController.selectedBillSession.bill.paidBill eq bookingController.selectedBillSession.bill and bookingController.selectedBillSession.bill.balance eq 0.0}">
                                <h:panelGrid columns="2">
                                    <p:outputLabel value="Name"/>
                                    <p:commandLink value="#{bookingController.selectedBillSession.bill.patient.person.nameWithTitle}"
                                                   action="#{patientController.toPatientFromSearchPatients()}">
                                        <f:setPropertyActionListener value="#{bookingController.selectedBillSession.bill.patient}"
                                                                     target="#{patientController.current}" ></f:setPropertyActionListener>
                                    </p:commandLink>
                                    <p:outputLabel value="Consultant"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.serviceSession.staff.person.nameWithTitle}"/>
                                    <p:outputLabel value="Serial No"/>
                                    <ui:repeat value="#{bookingController.selectedBillSession.bill.billItems}" var="bis" >
                                        <p:outputLabel value="#{bis.billSession.serialNo}"/>
                                    </ui:repeat>
                                    <p:outputLabel value="Appointment Date">
                                    </p:outputLabel>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.sessionDate}"> 
                                        <f:convertDateTime pattern="dd MMM yyyy" >
                                        </f:convertDateTime>
                                    </p:outputLabel>
                                    <p:outputLabel value="Appointment Time">
                                    </p:outputLabel>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.serviceSession.startingTime}"> 
                                        <f:convertDateTime pattern="hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>
                                    <p:separator ></p:separator>
                                    <p:separator ></p:separator>

                                    <p:outputLabel value="Bill No"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.insId}"/>
                                    <p:outputLabel value="Payment"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paymentMethod}"/>
                                    <p:outputLabel value="Agent" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.creditCompany.name}" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="Agent Ref No" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.billItem.agentRefNo}" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="Staff Name" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Staff'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.toStaff.person.nameWithTitle} - (#{bookingController.selectedBillSession.bill.toStaff.code}) " rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Staff'}"/>
                                    <p:outputLabel value="User"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.creater.webUserPerson.nameWithTitle}"/>
                                    <p:outputLabel value="Billed At"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.createdAt}"> 
                                        <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>
                                    <p:separator 
                                        rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}" ></p:separator>
                                    <p:separator rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}" ></p:separator>
                                    <p:outputLabel style="color: red" value="Payment" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}" />
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.billedBill.paymentMethod}" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}"/>
                                    <p:outputLabel style="color: red" value="Cancel/Refund User" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.billedBill.creater.webUserPerson.nameWithTitle}" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}"/>
                                    <p:outputLabel style="color: red" value="Cancel/Refund At" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.billedBill.createdAt}" rendered="#{bookingController.selectedBillSession.bill.cancelled==true or bookingController.selectedBillSession.bill.refunded==true}">
                                        <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a"  ></f:convertDateTime>
                                    </p:outputLabel> 

                                </h:panelGrid>    

                                <h:panelGrid columns="2" rendered="#{bookingController.selectedBillSession.bill.cancelled}">
                                    <p:outputLabel style="color: red" value="Cancelled Payment"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.cancelledBill.paymentMethod}"/>
                                    <p:outputLabel style="color: red" value="Cancel/Refund User" />
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.cancelledBill.creater.webUserPerson.nameWithTitle}" />
                                    <p:outputLabel style="color: red" value="Cancel/Refund At" />
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.cancelledBill.createdAt}" >
                                        <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a"  ></f:convertDateTime>
                                    </p:outputLabel> 
                                </h:panelGrid>

                                <h:panelGrid columns="2" rendered="#{bookingController.selectedBillSession.bill.refunded}">
                                    <p:outputLabel style="color: red" value="Refunded Payment"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.refundedBill.paymentMethod}"/>
                                    <p:outputLabel style="color: red" value="Refunded Value"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.refundedBill.netTotal}">
                                        <f:convertNumber pattern="#,##0.00" ></f:convertNumber>
                                    </p:outputLabel>

                                    <p:outputLabel style="color: red" value="Refund User" />
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.refundedBill.creater.webUserPerson.nameWithTitle}" />
                                    <p:outputLabel style="color: red" value="Refund At" />
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.bill.refundedBill.createdAt}" >
                                        <!--                                        <f:convertNumber pattern="dd/MMM/yyyy - hh:mm a"  ></f:convertNumber>-->
                                    </p:outputLabel> 
                                </h:panelGrid>

                            </p:panel>

                            <p:panel header="Booking" rendered="#{(bookingController.selectedBillSession.bill.paidBill ne bookingController.selectedBillSession.bill) and bookingController.selectedBillSession.bill.balance eq 0.0}">
                                <h:panelGrid columns="2">
                                    <p:outputLabel value="Name"/>


                                    <p:commandLink value="#{bookingController.selectedBillSession.bill.patient.person.nameWithTitle}"
                                                   action="#{patientController.toPatientFromSearchPatients()}">
                                        <f:setPropertyActionListener value="#{bookingController.selectedBillSession.bill.patient}"
                                                                     target="#{patientController.current}" ></f:setPropertyActionListener>
                                    </p:commandLink>

                                    <p:outputLabel value="Consultant"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.serviceSession.staff.person.nameWithTitle}"/>
                                    <p:outputLabel value="Serial No"/>
                                    <ui:repeat value="#{bookingController.selectedBillSession.bill.billItems}" var="bis" >
                                        <p:outputLabel value="#{bis.billSession.serialNo}"/>
                                    </ui:repeat>
                                    <p:outputLabel value="Appointment Date">
                                    </p:outputLabel>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.sessionDate}"> 
                                        <f:convertDateTime pattern="dd MMM yyyy" >
                                        </f:convertDateTime>
                                    </p:outputLabel>
                                    <p:outputLabel value="Appointment Time">
                                    </p:outputLabel>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.serviceSession.startingTime}"> 
                                        <f:convertDateTime pattern="hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>
                                    <p:separator ></p:separator>
                                    <p:separator ></p:separator>
                                    <p:outputLabel value="Payment"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paymentMethod}"/>
                                    <p:outputLabel value="Agent" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.fromInstitution.name}" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="Agent Ref No" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.billItem.agentRefNo}" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="Booking User"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.creater.webUserPerson.nameWithTitle}"/>
                                    <p:outputLabel value="Staff Name" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Staff'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.toStaff.person.nameWithTitle} - (#{bookingController.selectedBillSession.bill.toStaff.code}) " rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Staff'}"/>
                                    <p:outputLabel value="Booked At"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.createdAt}"> 
                                        <f:convertDateTime pattern="dd MMM yyyy - hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>
                                    <p:outputLabel value="Settled At" rendered="#{bookingController.selectedBillSession.bill.paidBill ne null}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paidBill.createdAt}" rendered="#{bookingController.selectedBillSession.bill.paidBill ne null}"> 
                                        <f:convertDateTime pattern="dd MMM yyyy - hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>
                                </h:panelGrid>                            
                            </p:panel>

                            <p:panel header="Settling" class="mx-4" style="margin-bottom: 40%" rendered="#{(bookingController.selectedBillSession.bill.paidBill ne bookingController.selectedBillSession.bill) and bookingController.selectedBillSession.bill.balance eq 0.0}">
                                <h:panelGrid columns="2">
                                    <p:outputLabel value="Bill ID"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paidBill.insId}"/>
                                    <p:outputLabel value="Payment Method"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paidBill.paymentMethod}"/>
                                    <p:outputLabel value="Agent" rendered="#{bookingController.selectedBillSession.bill.paidBill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paidBill.fromInstitution.name}" 
                                                   rendered="#{bookingController.selectedBillSession.bill.paidBill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="Agent Ref No" rendered="#{bookingController.selectedBillSession.bill.paidBill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.billItem.paidBill.agentRefNo}" rendered="#{bookingController.selectedBillSession.bill.paidBill.paymentMethod eq 'Agent'}"/>
                                    <p:outputLabel value="User"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paidBill.creater.webUserPerson.nameWithTitle}"/>
                                    <p:outputLabel value="Settled At"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.bill.paidBill.createdAt}"> 
                                        <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a" ></f:convertDateTime>
                                    </p:outputLabel>
                                </h:panelGrid>                            
                            </p:panel>

                            <p:panel header="Rescheduled From" class="w-100 mx-1" rendered="#{bookingController.selectedBillSession.referenceBillSession ne null}">
                                <h:panelGrid columns="2" styleClass="w-100" columnClasses="label,value">
                                    <p:outputLabel value="Consultant" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.sessionInstance.staff.name}"/>

                                    <p:outputLabel value="Session" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.sessionInstance.originatingSession.name}"/>

                                    <p:outputLabel value="Appointment No" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.serialNo}"/>

                                    <p:outputLabel value="Start At" style="font-weight: bold"/>
                                    <h:outputText value="#{bookingController.selectedBillSession.referenceBillSession.sessionInstance.originatingSession.startingTime}">
                                        <f:convertDateTime pattern="HH:mm a"/>
                                    </h:outputText>

                                    <p:outputLabel value="Booked At" style="font-weight: bold"/>
                                    <h:outputText value="#{bookingController.selectedBillSession.referenceBillSession.bill.createdAt}">
                                        <f:convertDateTime pattern="MM/dd/yyyy HH:mm a"/>
                                    </h:outputText>



                                    <p:outputLabel value="Payment Method" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod}"/>

                                    <p:outputLabel value="Agent" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Agent'}" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.fromInstitution.name}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Agent'}"/>

                                    <p:outputLabel value="Agent Ref No" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.billItem.agentRefNo}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Agent'}"/>

                                    <p:outputLabel value="Staff Name" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Staff'}" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.toStaff.person.nameWithTitle} - (#{bookingController.selectedBillSession.referenceBillSession.referenceBillSession.bill.toStaff.code})" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Staff'}"/>

                                    <p:outputLabel value="User" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.creater.webUserPerson.nameWithTitle}"/>



                                    <p:outputLabel value="Settled At" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paidBill ne null}" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.paidBill.createdAt}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paidBill ne null}">
                                        <f:convertDateTime pattern="dd MMM yyyy - hh:mm a" />
                                    </p:outputLabel>

                                    <p:separator rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>
                                    <p:separator rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>

                                    <p:outputLabel style="color: red" value="Payment" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.referenceBillSession.bill.billedBill.paymentMethod}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>

                                    <p:outputLabel style="color: red" value="Cancel/Refund User" rendered="#{bookingController.selectedBillSession.bill.cancelled == true or bookingController.selectedBillSession.bill.refunded == true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.referenceBillSession.bill.billedBill.creater.webUserPerson.nameWithTitle}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>

                                    <p:outputLabel style="color: red" value="Cancel/Refund At" rendered="#{bookingController.selectedBillSession.referenceBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.referenceBillSession.bill.billedBill.createdAt}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}">
                                        <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a" />
                                    </p:outputLabel>
                                </h:panelGrid>

                            </p:panel>

                            <p:panel header="Rescheduled To" class="w-100 mx-1" rendered="#{bookingController.selectedBillSession.recheduledSession}">
                                <h:panelGrid columns="2" styleClass="w-100" columnClasses="label,value">
                                    <p:outputLabel value="Consultant" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.sessionInstance.staff.name}"/>

                                    <p:outputLabel value="Session" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.sessionInstance.originatingSession.name}"/>

                                    <p:outputLabel value="Appointment No" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.serialNo}"/>

                                    <p:outputLabel value="Start At" style="font-weight: bold"/>
                                    <h:outputText value="#{bookingController.selectedBillSession.referenceBillSession.sessionInstance.originatingSession.startingTime}">
                                        <f:convertDateTime pattern="HH:mm a"/>
                                    </h:outputText>

                                    <p:outputLabel value="Session Date" style="font-weight: bold"/>
                                    <h:outputText value="#{bookingController.selectedBillSession.referenceBillSession.sessionInstance.sessionDate}"  >
                                        <f:convertDateTime pattern="#{sessionController.applicationPreference.shortDateFormat}" />
                                    </h:outputText>

                                    <p:outputLabel value="Booked At" style="font-weight: bold"/>
                                    <h:outputText value="#{bookingController.selectedBillSession.referenceBillSession.bill.createdAt}">
                                        <f:convertDateTime pattern="MM/dd/yyyy HH:mm a"/>
                                    </h:outputText>



                                    <p:outputLabel value="Payment Method" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod}"/>

                                    <p:outputLabel value="Agent" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Agent'}" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.fromInstitution.name}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Agent'}"/>

                                    <p:outputLabel value="Agent Ref No" rendered="#{bookingController.selectedBillSession.bill.paymentMethod eq 'Agent'}" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.billItem.agentRefNo}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Agent'}"/>

                                    <p:outputLabel value="Staff Name" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Staff'}" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.toStaff.person.nameWithTitle} - (#{bookingController.selectedBillSession.referenceBillSession.referenceBillSession.bill.toStaff.code})" rendered="#{bookingControllerViewScope.selectedBillSession.referenceBillSession.bill.paymentMethod eq 'Staff'}"/>

                                    <p:outputLabel value="User" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.creater.webUserPerson.nameWithTitle}"/>



                                    <p:outputLabel value="Settled At" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paidBill ne null}" style="font-weight: bold"/>
                                    <p:outputLabel value="#{bookingController.selectedBillSession.referenceBillSession.bill.paidBill.createdAt}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.paidBill ne null}">
                                        <f:convertDateTime pattern="dd MMM yyyy - hh:mm a" />
                                    </p:outputLabel>

                                    <p:separator rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>
                                    <p:separator rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>

                                    <p:outputLabel style="color: red" value="Payment" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.referenceBillSession.bill.billedBill.paymentMethod}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>

                                    <p:outputLabel style="color: red" value="Cancel/Refund User" rendered="#{bookingController.selectedBillSession.bill.cancelled == true or bookingController.selectedBillSession.bill.refunded == true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.referenceBillSession.bill.billedBill.creater.webUserPerson.nameWithTitle}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>

                                    <p:outputLabel style="color: red" value="Cancel/Refund At" rendered="#{bookingController.selectedBillSession.referenceBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}"/>
                                    <p:outputLabel style="color: red" value="#{bookingController.selectedBillSession.referenceBillSession.bill.billedBill.createdAt}" rendered="#{bookingController.selectedBillSession.referenceBillSession.bill.cancelled == true or bookingController.selectedBillSession.referenceBillSession.bill.refunded == true}">
                                        <f:convertDateTime pattern="dd/MMM/yyyy - hh:mm a" />
                                    </p:outputLabel>
                                </h:panelGrid>

                            </p:panel>
                        </h:panelGrid>

                    </p:tab>

                    <p:tab title="Reprint" id="rePrint" >
                        <div class="row">
                            <h:panelGroup rendered="#{webUserController.hasPrivilege('ChannellingReprintOriginalBill')}">
                                <div class="col-6">
                                    <p:panel>
                                        <div class="row">
                                            <f:facet name="header">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <h:outputLabel value="Reprint" />
                                                    <div>
                                                        <p:outputLabel value="Paper Type" class="m-2"></p:outputLabel>
                                                        <p:selectOneMenu
                                                            value="#{sessionController.departmentPreference.channelBillPaperType}"
                                                            class="m-1"
                                                            style="width: 13em;">
                                                            <f:selectItem itemLabel="Please Select Paper Type" />
                                                            <f:selectItems value="#{enumController.paperTypes}" />
                                                        </p:selectOneMenu>
                                                        <p:commandButton
                                                            ajax="false"
                                                            icon="fa fa-sync-alt"
                                                            class="ui-button-primary m-1"
                                                            title="Redraw Bill">
                                                        </p:commandButton>
                                                        <p:commandButton
                                                            value="Print"
                                                            ajax="false"
                                                            class="ui-button-info  m-1"
                                                            icon="fa fa-print"
                                                            action="#"
                                                            disabled="#{channelBillController.billSession.billItem.bill.balance ne 0.0}">
                                                            <p:printer target="gpBillPreviewad1" ></p:printer>
                                                        </p:commandButton>
                                                    </div>
                                                </div>
                                            </f:facet>

                                            <div class="col-md-12 mt-2">
                                                <div class="d-flex justify-content-center">

                                                    <h:panelGroup id="gpBillPreviewad1">
                                                        <ui:repeat value="#{sessionController.departmentPreference.channellingBillCopiesList}" var="copy">
                                                            <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'PosPaper'}" >
                                                                <ez:bmsChannelBill  bill="#{channelBillController.billSession.billItem.bill}" dup="true"/>
                                                            </h:panelGroup>
                                                            <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'FiveFivePaper'}" >
                                                                <ez:bms5x5ChannelBill bill="#{channelBillController.billSession.billItem.bill}" duplicate="true"/>
                            <!--                                <bg:fiveFiveCCBill_CC bill="#{bookingController.printingBill}"/>  -->
                                                            </h:panelGroup>
                                                        </ui:repeat>
                                                    </h:panelGroup>
                                                </div>
                                            </div>
                                        </div>
                                    </p:panel>
                                </div>
                                <div class="col-6">
                                    <p:panel>
                                        <div class="row">
                                            <f:facet name="header">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <h:outputLabel value="Reprint(Original)" />

                                                    <div>
                                                        <p:outputLabel value="Paper Type" class="m-2"></p:outputLabel>
                                                        <p:selectOneMenu
                                                            value="#{sessionController.departmentPreference.channelBillPaperType}"
                                                            class="m-1"
                                                            style="width: 13em;">
                                                            <f:selectItem itemLabel="Please Select Paper Type" />
                                                            <f:selectItems value="#{enumController.paperTypes}" />
                                                        </p:selectOneMenu>
                                                        <p:commandButton
                                                            ajax="false"
                                                            icon="fa fa-sync-alt"
                                                            class="ui-button-primary m-1"
                                                            title="Redraw Bill">
                                                        </p:commandButton>
                                                        <p:commandButton
                                                            value="Print"
                                                            ajax="false"
                                                            class="ui-button-info  m-1"
                                                            icon="fa fa-print"
                                                            action="#"
                                                            disabled="#{channelBillController.billSession.billItem.bill.balance ne 0.0}">
                                                            <p:printer target="gpBillPreviewad2" ></p:printer>
                                                        </p:commandButton>
                                                    </div>
                                                </div>
                                            </f:facet>
                                            <div class="col-md-12 mt-2">
                                                <div class="d-flex justify-content-center">

                                                    <h:panelGroup id="gpBillPreviewad2">
                                                        <ui:repeat value="#{sessionController.departmentPreference.channellingBillCopiesList}" var="copy">
                                                            <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'PosPaper'}" >
                                                                <ez:bmsChannelBill  bill="#{channelBillController.billSession.billItem.bill}" />
                                                            </h:panelGroup>
                                                            <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'FiveFivePaper'}" >
                                                                <ez:bms5x5ChannelBill bill="#{channelBillController.billSession.billItem.bill}" />
                            <!--                                <bg:fiveFiveCCBill_CC bill="#{bookingController.printingBill}"/>  -->
                                                            </h:panelGroup>
                                                        </ui:repeat>
                                                    </h:panelGroup>
                                                </div>
                                            </div>
                                        </div>
                                    </p:panel>
                                </div>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{!webUserController.hasPrivilege('ChannellingReprintOriginalBill')}">
                                <div class="row">
                                    <div class="d-flex justify-content-between">
                                        <p:commandButton
                                            value="Print"
                                            ajax="false"
                                            class="ui-button-info  m-1"
                                            icon="fa fa-print"
                                            action="#"
                                            disabled="#{channelBillController.billSession.billItem.bill.balance ne 0.0}">
                                            <p:printer target="gpBillPreview" ></p:printer>
                                        </p:commandButton>

                                        <div>
                                            <p:outputLabel value="Paper Type" class="m-2"></p:outputLabel>
                                            <p:selectOneMenu
                                                value="#{sessionController.departmentPreference.channelBillPaperType}"
                                                class="m-1"
                                                style="width: 13em;">
                                                <f:selectItem itemLabel="Please Select Paper Type" />
                                                <f:selectItems value="#{enumController.paperTypes}" />
                                            </p:selectOneMenu>
                                            <p:commandButton
                                                ajax="false"
                                                icon="fa fa-sync-alt"
                                                class="ui-button-primary m-1"
                                                title="Redraw Bill">
                                            </p:commandButton>
                                        </div>
                                    </div>
                                    <div class="col-md-12 mt-2">
                                        <div class="d-flex justify-content-center">

                                            <h:panelGroup id="gpBillPreview">
                                                <ui:repeat value="#{sessionController.departmentPreference.channellingBillCopiesList}" var="copy">
                                                    <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'PosPaper'}" >
                                                        <ez:bmsChannelBill  bill="#{channelBillController.billSession.billItem.bill}" dup="true"/>
                                                    </h:panelGroup>
                                                    <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'FiveFivePaper'}" >
                                                        <ez:bms5x5ChannelBill bill="#{channelBillController.billSession.billItem.bill}" duplicate="true"/>
                    <!--                                <bg:fiveFiveCCBill_CC bill="#{bookingController.printingBill}"/>  -->
                                                    </h:panelGroup>
                                                </ui:repeat>
                                            </h:panelGroup>
                                        </div>
                                    </div>
                                </div>
                            </h:panelGroup>
                        </div>

                    </p:tab>

                    <p:tab title="Cancel" id="cancel"  disabled="#{!webUserController.hasPrivilege('ChannelBookingCancel')}">                                                         
                        <h:panelGroup rendered="#{!channelBillController.printPreviewC}">
                            <h:panelGroup rendered="#{channelBillController.billSession.billItem.bill.paymentMethod eq 'Agent'}" >
                                <p:outputLabel value="Re-payment Method"/>
                                <p:selectOneMenu  id="cmbCancellPs" value="#{channelBillController.cancelPaymentMethod}">
                                    <f:selectItem itemLabel="Select Cancel Payment Method" ></f:selectItem>
                                    <f:selectItems value="#{enumController.paymentMethodsForChannelAgentSettle}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>

                            <h:panelGroup>
                                <ch:bill_fees bill="#{channelBillController.billSession.billItem.bill}" />
                            </h:panelGroup>

                            <p:commandButton value="Cancel Booking"  class="my-2 ui-button-danger" icon="fas fa-cancel"
                                             disabled="#{channelBillController.billSession.bill.refunded==true
                                                         or channelBillController.billSession.bill.cancelled==true}"
                                             onclick="PF('confirmationDialog').show();"/>

                        </h:panelGroup>
                        <h:panelGroup id="cancelPrint" rendered="#{channelBillController.printPreviewC}" >
                            <div class="d-flex justify-content-between">
                                <h:outputLabel value="" />

                                <div class="d-flex  gap-2">
                                    <p:outputLabel value="Paper Type" class="m-2"></p:outputLabel>
                                    <p:selectOneMenu
                                        value="#{sessionController.departmentPreference.channelBillPaperType}"

                                        style="width: 13em;">
                                        <f:selectItem itemLabel="Please Select Paper Type" />
                                        <f:selectItems value="#{enumController.paperTypes}" />
                                        <p:ajax event="itemSelect" process="@this" update="gpCancelBillPreview" />
                                    </p:selectOneMenu>
                                    <p:commandButton
                                        id="btnRefreshC"
                                        process="@this"
                                        update="gpCancelBillPreview"
                                        icon="fa fa-sync-alt"
                                        class="ui-button"
                                        title="Redraw Bill">
                                    </p:commandButton>
                                    <p:commandButton
                                        value="Print"
                                        ajax="false"
                                        action="#"
                                        class="ui-button-info"
                                        icon="fa fa-print"
                                        disabled="#{channelBillController.billSession.billItem.bill.balance ne 0.0}">
                                        <p:printer target="gpCancelBillPreview" ></p:printer>
                                    </p:commandButton>
                                </div>
                            </div>

                            <div class="d-flex justify-content-center mt-4">
                                <h:panelGroup id="gpCancelBillPreview">
                                    <ui:repeat value="#{sessionController.departmentPreference.channellingBillCopiesList}" var="copy">
                                        <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'PosPaper'}" >
                                            <ez:bmsChannelBill  bill="#{channelBillController.billSession.billItem.bill}"/>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'FiveFivePaper'}" >
                                            <ez:bms5x5ChannelBill bill="#{channelBillController.billSession.billItem.bill}"/>
        <!--                                <bg:fiveFiveCCBill_CC bill="#{bookingController.printingBill}"/>  -->
                                        </h:panelGroup>
                                    </ui:repeat>
                                </h:panelGroup>
                            </div>
                        </h:panelGroup>
                        <p:dialog minHeight="100" width="800" header="Confirmation" widgetVar="confirmationDialog" modal="true" resizable="false">
                            <p>Are you sure you want to cancel the channel booking?</p>
                            <p:selectOneMenu
                                id="commentsMenuCancel"
                                value="#{channelBillController.comment}"
                                editable="true"
                                filter="true"
                                placeholder="Select or enter a comment"
                                filterMatchMode="contains"
                                style="float: right; width: 100%"
                                class="p-2">
                                <f:selectItem itemLabel="Select or enter a comment" itemValue="" noSelectionOption="true"/>
                                <f:selectItems
                                    value="#{configOptionApplicationController.getListOfCustomOptions('Channel Bill Canceling Comments')}"
                                    var="option"
                                    itemLabel="#{option}"
                                    itemValue="#{option}"/>
                            </p:selectOneMenu>

                            <f:facet name="footer">
                                <p:commandButton
                                    class="mx-2 ui-button-warning"
                                    ajax="false"
                                    value="Yes"
                                    action="#{channelBillController.channelBookingCancel()}"
                                    onclick="PF('confirmationDialog').hide();" />
                                <p:commandButton
                                    value="No"
                                    onclick="PF('confirmationDialog').hide();" />
                            </f:facet>
                        </p:dialog>

                    </p:tab>


                    <p:tab title="Refund" id="refund"   disabled="#{!webUserController.hasPrivilege('ChannelBookingRefund')}">                          

                        <h:panelGroup rendered="#{!channelBillController.printPreviewR}">
                            <h:panelGroup>
                                <h:panelGrid columns="2" rendered="#{channelBillController.billSession.billItem.bill.paymentMethod eq 'Agent'}" >

                                    <p:outputLabel value="Re-payment Method"/>
                                    <p:selectOneMenu  id="cmbRefundPs" value="#{channelBillController.refundPaymentMethod}" >
                                        <f:selectItem itemLabel="Select Cancel Payment Method" ></f:selectItem>
                                        <f:selectItems value="#{enumController.paymentMethodsForChannelAgentSettle}"/>
                                    </p:selectOneMenu>

                                </h:panelGrid>
                                <h:panelGrid columns="2">
                                    <h:outputLabel value="Refundable Total : "/>
                                    <h:outputLabel id="tot" value="#{channelBillController.refundableTotal}"/>
                                </h:panelGrid>
                                <p:dataTable value="#{channelBillController.billSession.bill.billFees}" var="bi">
                                    <p:column headerText="Fee Name">
                                        <p:outputLabel value="#{bi.fee.name}"/>
                                    </p:column>
                                    <p:column headerText="Fee Type">
                                        <p:outputLabel value="#{bi.fee.feeType}"/>
                                    </p:column>
                                    <p:column headerText="Fee Value">
                                        <p:outputLabel value="#{bi.feeValue}"/>
                                    </p:column>
                                    <p:column headerText="Return Value">
                                        <p:inputText value="#{bi.tmpChangedValue}">
                                            <f:ajax execute="@this" render=":#{p:resolveFirstComponentWithId('tot',view).clientId}" event="blur" listener="#{channelBillController.calRefundTotal()}"/>
                                            <f:ajax execute="@this" render=":#{p:resolveFirstComponentWithId('tot',view).clientId} @this" event="blur" listener="#{channelBillController.checkRefundTotal()}"/>
                                        </p:inputText>

                                    </p:column>
                                </p:dataTable>
                            </h:panelGroup>

                            <p:commandButton value="Refund Booking" class="ui-button-warning my-2" icon="fas fa-reply"
                                             disabled="#{channelBillController.billSession.bill.refunded==true
                                                         or channelBillController.billSession.bill.cancelled==true or channelBillController.disableRefund==true}"
                                             onclick="PF('confirmationRefundDialog').show();"/>
                        </h:panelGroup>
                        <h:panelGroup id="refundPrint" rendered="#{channelBillController.printPreviewR}" >
                            <div class="d-flex justify-content-between">
                                <h:outputLabel value="" />

                                <div class="d-flex  gap-2">
                                    <p:outputLabel value="Paper Type" class="m-2"></p:outputLabel>
                                    <p:selectOneMenu
                                        value="#{sessionController.departmentPreference.channelBillPaperType}"

                                        style="width: 13em;">
                                        <f:selectItem itemLabel="Please Select Paper Type" />
                                        <f:selectItems value="#{enumController.paperTypes}" />
                                        <p:ajax event="itemSelect" process="@this" update="gpRefundBillPreview" />
                                    </p:selectOneMenu>
                                    <p:commandButton
                                        id="btnRefreshR"
                                        process="@this"
                                        update="gpRefundBillPreview"
                                        icon="fa fa-sync-alt"
                                        class="ui-button"
                                        title="Redraw Bill">
                                    </p:commandButton>
                                    <p:commandButton
                                        value="Print"
                                        ajax="false"
                                        action="#"
                                        class="ui-button-info"
                                        icon="fa fa-print"
                                        disabled="#{channelBillController.billSession.billItem.bill.balance ne 0.0}">
                                        <p:printer target="gpRefundBillPreview" ></p:printer>
                                    </p:commandButton>
                                </div>
                            </div>

                            <div class="d-flex justify-content-center mt-4">
                                <h:panelGroup id="gpRefundBillPreview">
                                    <ui:repeat value="#{sessionController.departmentPreference.channellingBillCopiesList}" var="copy">
                                        <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'PosPaper'}" >
                                            <ez:bmsChannelBill  bill="#{channelBillController.billSession.billItem.bill}" ref="true"/>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'FiveFivePaper'}" >
                                            <ez:bms5x5ChannelBill bill="#{channelBillController.billSession.billItem.bill}" ref="true"/>
        <!--                                <bg:fiveFiveCCBill_CC bill="#{bookingController.printingBill}"/>  -->
                                        </h:panelGroup>
                                    </ui:repeat>
                                </h:panelGroup>
                            </div>
                        </h:panelGroup>

                        <p:dialog minHeight="100" width="800" header="Confirmation" widgetVar="confirmationRefundDialog" modal="true" resizable="false">
                            <p>Are you sure you want to refund the channel booking?</p>
                            <p:selectOneMenu
                                id="commentsMenuRefund"
                                value="#{channelBillController.commentR}"
                                editable="true"
                                filter="true"
                                placeholder="Select or enter a comment"
                                filterMatchMode="contains"
                                style="float: right; width: 100%"
                                class="p-2">
                                <f:selectItem itemLabel="Select or enter a comment" itemValue="" noSelectionOption="true"/>
                                <f:selectItems
                                    value="#{configOptionApplicationController.getListOfCustomOptions('Channel Bill Refunding Comments')}"
                                    var="option"
                                    itemLabel="#{option}"
                                    itemValue="#{option}"/>
                            </p:selectOneMenu>

                            <f:facet name="footer">
                                <p:commandButton
                                    class="mx-2 ui-button-warning"
                                    ajax="false"
                                    value="Yes"
                                    action="#{channelBillController.channelBookingRefund()}"
                                    onclick="PF('confirmationRefundDialog').hide();" />
                                <p:commandButton
                                    value="No"
                                    onclick="PF('confirmationRefundDialog').hide();" />
                            </f:facet>
                        </p:dialog>
                    </p:tab>


                    <p:tab title="Settle" id="settle">
                        <p:panel  id="set" rendered="#{!configOptionApplicationController.getBooleanValueByKey('Channel Credit Booking Settle Requires Additional Information')}">
                            <ch:bill_fees bill="#{channelBillController.billSession.billItem.bill}" />

                            <p:outputLabel rendered="false" value="Payment Method"/>
                            <p:selectOneMenu  
                                class="mx-2"
                                rendered="false"
                                style="width: 10em;"
                                id="cmbSettlePs" value="#{channelBillController.settlePaymentMethod}">  
                                <f:selectItems value="#{enumController.paymentMethodsForChannelSettle}"/>                                                               
                                <f:ajax execute="@this" render="settleAgent settleAgent2 settleBallance settleBallance2 settleAgRefLbl settleAgRefTxt" event="change" />
                            </p:selectOneMenu>

                            <h:outputLabel id="settleAgent" value="Agent"  style="display: #{channelBillController.settlePaymentMethod eq 'Agent' ? 'block' : 'none'} ; " />
                            <p:autoComplete id="settleAgent2" forceSelection="true" style="display: #{channelBillController.settlePaymentMethod eq 'Agent'? 'block' : 'none'} ; "
                                            value="#{channelBillController.settleInstitution}"  completeMethod="#{agencyController.completeAgency}" var="ix"
                                            itemLabel="#{ix.name}" itemValue="#{ix}" >
                                <f:ajax  event="itemSelect" execute="@this"  render="settleBallance settleBallance2 settleAgRefLbl settleAgRefTxt"/>
                                <p:column>#{ix.institutionCode}</p:column>
                                <p:column>#{ix.name}</p:column>                                
                            </p:autoComplete> 

                            <h:outputLabel id="settleAgRefLbl" value="Agent Reference No"  style="display: #{channelBillController.settlePaymentMethod eq 'Agent'? 'block' : 'none'} ; "/>
                            <p:inputText autocomplete="off" id="settleAgRefTxt" value="#{channelBillController.settleAgentRefNo}"  style="display: #{channelBillController.settlePaymentMethod eq 'Agent' ? 'block' : 'none'} ; " />

                            <h:outputLabel id="settleBallance" value="Balance"  style="display: #{channelBillController.paymentMethod eq 'Agent' ? 'block' : 'none'} ; " />
                            <h:outputLabel id="settleBallance2" value="#{channelBillController.institution.ballance}"  style="display: #{channelBillController.settlePaymentMethod eq 'Agent' ? 'block' : 'none'} ; " />

                            <p:commandButton 
                                id="setBtn"  
                                class="ui-button-success mt-2"
                                icon="fa-solid fa-check"
                                value="Settle Credit Booking"
                                process="cmbSettlePs settleAgent2 settleAgRefTxt setBtn"
                                update="gpSettlePrint"
                                rendered="#{!configOptionApplicationController.getBooleanValueByKey('Channel Credit Booking Settle Requires Additional Information')}"
                                disabled="#{channelBillController.billSession.bill.billType.parent ne 'ChannelCreditFlow' 
                                            or channelBillController.billSession.bill.cancelled==true
                                            or  channelBillController.billSession.bill.paidAmount ne 0}" 
                                oncomplete="PF('dlgPreSettle').show();"/>
                            <p:commandButton
                                id="setBtna"
                                class="ui-button-success mt-2"
                                icon="fa-solid fa-check"
                                ajax="false"
                                value="Settle Credit Booking"
                                process="cmbSettlePs settleAgent2 settleAgRefTxt setBtn"
                                update="gpSettlePrint"
                                action="#{channelBillController.navigateToSettleBooking}"
                                rendered="#{configOptionApplicationController.getBooleanValueByKey('Channel Credit Booking Settle Requires Additional Information')}"
                                disabled="#{channelBillController.billSession.bill.billType.parent ne 'ChannelCreditFlow'
                                            or channelBillController.billSession.bill.cancelled==true
                                            or  channelBillController.billSession.bill.paidAmount ne 0}"
                                />
                            <p:dialog 
                                id="dialogChannelPreSettle"
                                closable="true"
                                header="Choose Payment Method" 
                                widgetVar="dlgPreSettle" 
                                width="900"
                                height="200"
                                modal="true">
                                <div class="row">
                                    <p:spacer height="40px" />
                                    <div class="col-4">
                                        <p:commandButton 
                                            id="setBtn1"  
                                            class="ui-button-success mt-2 btn-lg" 
                                            icon="fa-solid fa-money-bill"
                                            value="Settle with Cash"
                                            style="height: 90px; width: 250px;"
                                            process="cmbSettlePs settleAgent2 settleAgRefTxt setBtn1"
                                            update="gpSettlePrint"
                                            action="#{channelBillController.settleCreditWithCash}" 
                                            disabled="#{channelBillController.billSession.bill.billType.parent ne 'ChannelCreditFlow' 
                                                        or channelBillController.billSession.bill.cancelled==true
                                                        or  channelBillController.billSession.bill.paidAmount ne 0}" 
                                            oncomplete="PF('dlgSettle').show();">
                                            <style>
                                                .fa-money-bill {
                                                    font-size: 25px !important;
                                                }
                                            </style>
                                        </p:commandButton>
                                    </div>
                                    <div class="col-4">
                                        <p:commandButton 
                                            id="setBtn2"  
                                            class="ui-button-warning mt-2 btn-lg" 
                                            icon="fa-solid fa-credit-card"
                                            value="Settle With Card"
                                            style="height: 90px; width: 250px"
                                            process="cmbSettlePs settleAgent2 settleAgRefTxt setBtn2"
                                            update="gpSettlePrint"
                                            action="#{channelBillController.settleCreditWithCard}" 
                                            disabled="#{channelBillController.billSession.bill.billType.parent ne 'ChannelCreditFlow' 
                                                        or channelBillController.billSession.bill.cancelled==true
                                                        or  channelBillController.billSession.bill.paidAmount ne 0}" 
                                            oncomplete="PF('dlgSettle').show();">
                                            <style>
                                                .fa-credit-card {
                                                    font-size: 25px !important;
                                                }
                                            </style>
                                        </p:commandButton>
                                    </div>
                                    <div class="col-4">
                                        <p:commandButton 
                                            id="setBtn3"  
                                            class="ui-button-danger mt-2 btn-lg"
                                            icon="fa-solid fa-file-invoice-dollar"
                                            value="Settle With Credit"
                                            style="height: 90px; width: 250px"
                                            process="cmbSettlePs settleAgent2 settleAgRefTxt setBtn3"
                                            update="gpSettlePrint"
                                            action="#{channelBillController.settleCreditWithCredit}" 
                                            disabled="#{channelBillController.billSession.bill.billType.parent ne 'ChannelCreditFlow' 
                                                        or channelBillController.billSession.bill.cancelled==true
                                                        or  channelBillController.billSession.bill.paidAmount ne 0}" 
                                            oncomplete="PF('dlgSettle').show();">
                                            <style>
                                                .fa-file-invoice-dollar {
                                                    font-size: 25px !important;
                                                }
                                            </style>
                                        </p:commandButton>
                                    </div>
                                </div>
                            </p:dialog>

                            <h:panelGroup id="gpSettlePrint" >

                                <p:dialog 
                                    id="dialogChannelSettle"
                                    closable="true"
                                    header="Booked" 
                                    widgetVar="dlgSettle" 
                                    width="900"
                                    height="700"
                                    modal="true"
                                    onShow="PF('dlgPreSettle').hide();">

                                    <div class="d-flex justify-content-between">
                                        <p:commandButton
                                            class="ui-button-secondary mx-2"
                                            icon="fa-solid fa-arrow-left"
                                            action="#{bookingController.navigateBackToBookingsLoagingBillSessions()}"
                                            value="Back to Channel Booking"
                                            process="@this"
                                            update="@all">
                                        </p:commandButton>

                                        <div class="d-flex  gap-2">
                                            <p:outputLabel value="Paper Type" class="m-2"></p:outputLabel>
                                            <p:selectOneMenu 
                                                value="#{sessionController.departmentPreference.channelBillPaperType}" 

                                                style="width: 13em;">
                                                <f:selectItem itemLabel="Please Select Paper Type" />
                                                <f:selectItems value="#{enumController.paperTypes}" />
                                                <p:ajax event="itemSelect" process="@this" update="gpSettleBillPreview" />
                                            </p:selectOneMenu>
                                            <p:commandButton 
                                                id="btnRefresh"
                                                process="@this"
                                                update="gpSettleBillPreview"
                                                icon="fa fa-sync-alt" 
                                                class="ui-button" 
                                                title="Redraw Bill">
                                            </p:commandButton>
                                            <p:commandButton 
                                                value="Print" 
                                                ajax="false" 
                                                action="#" 
                                                class="ui-button-info"
                                                icon="fa fa-print"
                                                disabled="#{channelBillController.billSession.billItem.bill.balance ne 0.0}">
                                                <p:printer target="gpSettleBillPreview" ></p:printer>
                                            </p:commandButton>
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-center mt-4">
                                        <h:panelGroup id="gpSettleBillPreview">
                                            <ui:repeat value="#{sessionController.departmentPreference.channellingBillCopiesList}" var="copy">
                                                <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'PosPaper'}" >
                                                    <ez:bmsChannelBill  bill="#{channelBillController.billSession.billItem.bill}"/>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'FiveFivePaper'}" >
                                                    <ez:bms5x5ChannelBill bill="#{channelBillController.billSession.billItem.bill}"/> 
                <!--                                <bg:fiveFiveCCBill_CC bill="#{bookingController.printingBill}"/>  -->
                                                </h:panelGroup>
                                            </ui:repeat>
                                        </h:panelGroup>
                                    </div>
                                </p:dialog>
                            </h:panelGroup>

                        </p:panel>

                        <p:panel rendered="#{configOptionApplicationController.getBooleanValueByKey('Channel Credit Booking Settle Requires Additional Information')}">
                            <h:panelGroup rendered="#{!channelBillController.printPreview}">
                                <div class="row">
                                    <div class="col-6">
                                        <p:panel>
                                            <f:facet name="header">
                                                <h:outputText styleClass="fas fa-user" />
                                                <h:outputLabel class="mx-4" value="Patient Details" />
                                            </f:facet>
                                            <ezcommon:patient patient="#{bookingController.selectedBillSession.bill.patient}" ></ezcommon:patient>
                                        </p:panel>

                                    </div>
                                    <div class="col-6">
                                        <p:panel class="m-1">
                                            <f:facet name="header" >
                                                <h:outputText styleClass="fa fa-money-bill-wave" /> <!-- FontAwesome Icon -->
                                                <h:outputText value="Payment Details" class="mx-4"></h:outputText>
                                            </f:facet>
                                            <div class="row my-1"  >
                                                <div class="col-5" >
                                                    <p:selectOneMenu
                                                        id="pay"
                                                        class="w-100"
                                                        value="#{channelBillController.settlePaymentMethod}"
                                                        >
                                                        <f:selectItems
                                                            value="#{enumController.paymentMethodsForChanneling}"
                                                            var="pm"
                                                            itemLabel="#{pm.label}"
                                                            itemValue="#{pm}"/>
                                                        <p:ajax process="#{p:resolveFirstComponentWithId('cmbPs',view).clientId} @this"
                                                                update="#{p:resolveFirstComponentWithId('pBillDetails',view).clientId} #{p:resolveFirstComponentWithId('tblBillItem',view).clientId} #{p:resolveFirstComponentWithId('paymentDetails',view).clientId}"
                                                                event="change"
                                                                />
                                                    </p:selectOneMenu>
                                                </div>

                                                <div class="col-7 " >
                                                    <h:panelGrid columns="3" class="m-1 w-100">
                                                        <p:commandButton
                                                            value="Settle"
                                                            style="float: right;"
                                                            ajax="false"
                                                            icon="fa fa-check"
                                                            action="#{channelBillController.settleCredit()}"
                                                            disabled="#{channelBillController.billSession.bill.billType.parent ne 'ChannelCreditFlow'
                                                                        or channelBillController.billSession.bill.cancelled==true
                                                                        or  channelBillController.billSession.bill.paidAmount ne 0}"
                                                            oncomplete="PF('dlgSettleAD').show();"
                                                            class="ui-button-success mx-2 w-100"
                                                            >
                                                        </p:commandButton>
                                                    </h:panelGrid>
                                                </div>
                                            </div>

                                            <div  >
                                                <h:panelGroup id="paymentDetails"  >
                                                    <h:panelGroup
                                                        class="row"
                                                        layout="block"
                                                        rendered="#{channelBillController.settlePaymentMethod eq 'Credit'}" >
                                                        <div class="my-1" id="credit">
                                                            <div class="row">
                                                                <div class="col-12 d-flex ">
                                                                    <p:autoComplete
                                                                        id="creditCompany"
                                                                        class="w-100 -mx-2"
                                                                        inputStyleClass="form-control"
                                                                        forceSelection="true"
                                                                        value="#{channelBillController.creditCompany}"
                                                                        completeMethod="#{creditCompanyController.completeCredit}"
                                                                        var="ix"
                                                                        minQueryLength="4"
                                                                        placeholder="Company (Type at least 4 letters to search)"
                                                                        itemLabel="#{ix.name}"
                                                                        itemValue="#{ix}"
                                                                        size="10"  >

                                                                        <f:ajax
                                                                            event="itemSelect"
                                                                            execute="@this"
                                                                            render="#{p:resolveFirstComponentWithId('pBillDetails',view).clientId}  #{p:resolveFirstComponentWithId('tblRequests',view).clientId} #{p:resolveFirstComponentWithId('tblBillItem',view).clientId}" />
                                                                    </p:autoComplete>
                                                                    <p:commandLink
                                                                        id="btnAddNewCreditCom"
                                                                        value="(+)"
                                                                        class="mx-3 mt-1"
                                                                        title="Add New Credit Company"
                                                                        ajax="false"
                                                                        action="#{navigationController.navigateToCreditCompany()}"
                                                                        actionListener="#{creditCompanyController.prepareAdd()}" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                        class="row"
                                                        layout="block"
                                                        rendered="#{channelBillController.settlePaymentMethod eq 'Staff'}" >
                                                        <div class="my-1" id="staffCredit">
                                                            <div class="row mt-1">
                                                                <div class="col-12">
                                                                    <p:autoComplete
                                                                        minQueryLength="4"
                                                                        forceSelection="true"
                                                                        value="#{channelBillController.toStaff}"
                                                                        id="creditStaff"
                                                                        completeMethod="#{staffController.completeStaff}"
                                                                        var="mys"
                                                                        class="w-100"
                                                                        placeholder="Staff (Type at least 4 letters to search)"
                                                                        inputStyleClass="form-control"
                                                                        itemLabel="#{mys.person.name}"
                                                                        itemValue="#{mys}"
                                                                        size="10">
                                                                        <p:column headerText="Name" >
                                                                            <h:outputText value="#{mys.person.nameWithTitle}" ></h:outputText>
                                                                        </p:column>
                                                                        <p:column headerText="EPF" >
                                                                            <h:outputText value="#{mys.epfNo}" ></h:outputText>
                                                                        </p:column>
                                                                        <p:column headerText="Credit Entitlement">
                                                                            <h:outputText value="#{mys.creditLimitQualified}" >
                                                                                <f:convertNumber pattern="#,##0.00" ></f:convertNumber>
                                                                            </h:outputText>
                                                                        </p:column>
                                                                        <p:column  headerText="Credit Utilized">
                                                                            <h:outputText value="#{mys.currentCreditValue}" >
                                                                                <f:convertNumber pattern="#,##0.00" ></f:convertNumber>
                                                                            </h:outputText>
                                                                        </p:column>
                                                                        <p:ajax process="@this"
                                                                                update="#{p:resolveFirstComponentWithId('pBillDetails',view).clientId}  #{p:resolveFirstComponentWithId('tblRequests',view).clientId} #{p:resolveFirstComponentWithId('tblBillItem',view).clientId}"
                                                                                event="itemSelect" />
                                                                    </p:autoComplete>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                        class="row"
                                                        layout="block"
                                                        rendered="#{channelBillController.settlePaymentMethod eq 'Staff_Welfare'}" >
                                                        <div class="my-1" id="credit">
                                                            <div class="row mt-1">
                                                                <div class="col-12">
                                                                    <p:autoComplete
                                                                        minQueryLength="3"
                                                                        forceSelection="true"
                                                                        value="#{channelBillController.toStaff}"
                                                                        id="welfareStaff"
                                                                        completeMethod="#{staffController.completeStaff}"
                                                                        var="mys"
                                                                        class="w-100"
                                                                        placeholder="Staff (Type at least 4 letters to search)"
                                                                        inputStyleClass="form-control"
                                                                        itemLabel="#{mys.person.name}"
                                                                        itemValue="#{mys}"
                                                                        size="10">
                                                                        <p:column headerText="Name" >
                                                                            <h:outputText value="#{mys.person.nameWithTitle}" ></h:outputText>
                                                                        </p:column>
                                                                        <p:column headerText="EPF" >
                                                                            <h:outputText value="#{mys.epfNo}" ></h:outputText>
                                                                        </p:column>
                                                                        <p:column headerText="Welfare Entitlement">
                                                                            <h:outputText value="#{mys.annualWelfareQualified}" >
                                                                                <f:convertNumber pattern="#,##0.00" ></f:convertNumber>
                                                                            </h:outputText>
                                                                        </p:column>
                                                                        <p:column  headerText="Welfare Utilized">
                                                                            <h:outputText value="#{mys.annualWelfareUtilized}" >
                                                                                <f:convertNumber pattern="#,##0.00" ></f:convertNumber>
                                                                            </h:outputText>
                                                                        </p:column>
                                                                        <p:ajax process="@this"
                                                                                update="#{p:resolveFirstComponentWithId('pBillDetails',view).clientId}  #{p:resolveFirstComponentWithId('tblRequests',view).clientId} #{p:resolveFirstComponentWithId('tblBillItem',view).clientId}"
                                                                                event="itemSelect" />
                                                                    </p:autoComplete>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                        class="row my-1"
                                                        layout="block"
                                                        id="creditCard" rendered="#{channelBillController.settlePaymentMethod eq 'Card'}" >
                                                        <pa:creditCard paymentMethodData="#{channelBillController.paymentMethodData}"/>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                        class="row my-1"
                                                        layout="block"
                                                        id="eWallet"  rendered="#{channelBillController.settlePaymentMethod eq 'ewallet'}" >
                                                        <pa:ewallet paymentMethodData="#{channelBillController.paymentMethodData}"/>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                        class="row my-1"
                                                        layout="block"
                                                        id="cheque"  rendered="#{channelBillController.settlePaymentMethod eq 'Cheque'}" >
                                                        <pa:cheque paymentMethodData="#{channelBillController.paymentMethodData}"/>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                        class="row my-1"
                                                        layout="block"
                                                        id="slip"  rendered="#{channelBillController.settlePaymentMethod eq 'Slip'}" >
                                                        <pa:slip paymentMethodData="#{channelBillController.paymentMethodData}"/>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                        class="row my-1"
                                                        layout="block"
                                                        id="patientDeposit"  rendered="#{channelBillController.settlePaymentMethod eq 'PatientDeposit'}" >
                                                        <pa:patient_deposit paymentMethodData="#{channelBillController.paymentMethodData}"/>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                        class="row my-1 w-100"
                                                        layout="block"
                                                        id="multiplePaymentMethods"  rendered="#{channelBillController.settlePaymentMethod eq 'MultiplePaymentMethods'}"
                                                        >
                                                        <pa:multiple_payment_methods controller="#{channelBillController}" class="w-100"/>

                                                    </h:panelGroup>

                                                </h:panelGroup>
                                            </div>
                                        </p:panel>
                                    </div>
                                    <div class="col-md-12 my-2">
                                        <ch:bill_fees bill="#{channelBillController.billSession.billItem.bill}" />
                                    </div>
                                </div>
                            </h:panelGroup>
                            <h:panelGroup id="gpSettlePrintAD" rendered="#{channelBillController.printPreview}" >
                                <div class="d-flex justify-content-between">
                                    <h:outputLabel value="" />

                                    <div class="d-flex  gap-2">
                                        <p:outputLabel value="Paper Type" class="m-2"></p:outputLabel>
                                        <p:selectOneMenu
                                            value="#{sessionController.departmentPreference.channelBillPaperType}"

                                            style="width: 13em;">
                                            <f:selectItem itemLabel="Please Select Paper Type" />
                                            <f:selectItems value="#{enumController.paperTypes}" />
                                            <p:ajax event="itemSelect" process="@this" update="gpADSettleBillPreview" />
                                        </p:selectOneMenu>
                                        <p:commandButton
                                            id="btnRefreshAD"
                                            process="@this"
                                            update="gpADSettleBillPreview"
                                            icon="fa fa-sync-alt"
                                            class="ui-button"
                                            title="Redraw Bill">
                                        </p:commandButton>
                                        <p:commandButton
                                            value="Print"
                                            ajax="false"
                                            action="#"
                                            class="ui-button-info"
                                            icon="fa fa-print"
                                            disabled="#{channelBillController.billSession.billItem.bill.balance ne 0.0}">
                                            <p:printer target="gpADSettleBillPreview" ></p:printer>
                                        </p:commandButton>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-center mt-4">
                                    <h:panelGroup id="gpADSettleBillPreview">
                                        <ui:repeat value="#{sessionController.departmentPreference.channellingBillCopiesList}" var="copy">
                                            <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'PosPaper'}" >
                                                <ez:bmsChannelBill  bill="#{channelBillController.billSession.billItem.bill}"/>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{sessionController.loggedPreference.channelBillPaperType eq 'FiveFivePaper'}" >
                                                <ez:bms5x5ChannelBill bill="#{channelBillController.billSession.billItem.bill}"/>
            <!--                                <bg:fiveFiveCCBill_CC bill="#{bookingController.printingBill}"/>  -->
                                            </h:panelGroup>
                                        </ui:repeat>
                                    </h:panelGroup>
                                </div>
                            </h:panelGroup>
                        </p:panel>

                    </p:tab>


                    <p:tab 
                        title="Change Patient"
                        id="change" 
                        rendered="#{webUserController.hasPrivilege('ChannelBookingChange')}">
                        <p:panelGrid columns="2" class="w-100">
                            <f:facet name="header" >
                                <p:outputLabel value="Change Current Patient with a new Patient" ></p:outputLabel>
                                <p:commandButton ajax="false" value="Change Patient" action="#{bookingController.changePatient()}" ></p:commandButton>
                            </f:facet>
                            <p:panel header="Current Patient for Booking" >
                                <ezcommon:patient patient="#{bookingController.selectedBillSession.bill.patient}" ></ezcommon:patient>
                            </p:panel>
                            <ezcommon:patient_details controller="#{bookingController}" ></ezcommon:patient_details>
                        </p:panelGrid>
                    </p:tab>

                    <p:tab 
                        title="Change Appointment Details"
                        id="changeNumber" 
                        rendered="#{webUserController.hasPrivilege('ChannelBookingChange')}">

                        <h:panelGrid columns="2" class="my-2">
                            <h:outputLabel value="Patient Title"/>
                            <p:selectOneMenu  value="#{bookingController.selectedBillSession.bill.patient.person.title}"  >
                                <f:selectItems value="#{billController.title}"/>
                            </p:selectOneMenu>
                            <p:outputLabel value="Patient Name"/>
                            <p:inputText autocomplete="off" 
                                         value="#{bookingController.selectedBillSession.bill.patient.person.name}" />
                            <p:outputLabel value="Patient Phoone Number"/>
                            <p:inputText autocomplete="off" value="#{bookingController.selectedBillSession.bill.patient.person.phone}" />
                            <p:outputLabel value="Current Appointment No"/>
                            <ui:repeat value="#{bookingController.selectedBillSession.bill.billItems}" var="bis" >
                                <p:outputLabel value="#{bis.billSession.serialNo}">                                        
                                </p:outputLabel>
                            </ui:repeat>
                            <p:outputLabel value="Appointment No"/>
                            <p:inputText autocomplete="off" value="#{bookingController.serealNo}">                                        
                            </p:inputText>
                        </h:panelGrid>
                        <h:panelGrid columns="6" class="my-2">
                            <p:commandButton ajax="false" value="Update Patient" action="#{bookingController.updatePatient}"
                                             disabled="#{bookingController.selectedBillSession.bill.cancelled==true
                                                         or bookingController.selectedBillSession.bill.refunded==true}" onclick="onSubmitButton();"/>

                            <p:commandButton ajax="false" value="Update Serial" action="#{bookingController.updateSerial()}"
                                             disabled="#{bookingController.selectedBillSession.bill.cancelled==true
                                                         or bookingController.selectedBillSession.bill.refunded==true}" />
                        </h:panelGrid>



                    </p:tab>

                    <p:tab title="Status" >
                        <p:outputLabel value="Mark As Present / Absent"/>
                        <p:selectBooleanButton onLabel="Absent" offLabel="Absent" disabled="#{channelBillController.billSession.bill.refunded==true
                                                                                              or channelBillController.billSession.bill.cancelled==true}"  value="#{bookingController.selectedBillSession.absent}" >
                            <p:ajax process="@this" listener="#{bookingController.updateSelectedBillSessionPatient()}" ></p:ajax>
                        </p:selectBooleanButton>

                    </p:tab>

                    <p:tab title="Search" rendered="false">

                        <p:calendar id="calFrom"  value="#{channelSearchController.fromDate}" pattern="dd MMMM yyyy" >   
                            <f:ajax event="dateSelect" execute="@this" render="bSessionSearch"/>
                        </p:calendar>
                        <p:calendar class="mx-2" id="calTo"  value="#{channelSearchController.toDate}" pattern="dd MMMM yyyy" >
                            <f:ajax event="dateSelect" execute="@this" render="bSessionSearch"/>
                        </p:calendar>

                        <p:inputText id="txtBsSearch" value="#{channelSearchController.txtSearch}" placeholder="ID" >
                        </p:inputText>

                        <p:commandButton id="btnBsSearch"
                                         class="ui-button-warning mx-2" icon="fas fa-search"
                                         value="Search" action="#{channelSearchController.searchForBillSessions}"
                                         ajax="false"
                                         process="txtBsSearch calFrom calTo btnBsSearch" 
                                         update="bSessionSearch">


                        </p:commandButton>

                        <p:dataTable id="bSessionSearch" value="#{channelSearchController.searchedBillSessions}" var='bs'
                                     filteredValue="#{channelSearchController.filteredbillSessions}">


                            <p:column headerText="Booking ID" filterBy="#{bs.bill.bookingId}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}"> #{bs.bill.bookingId}
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column headerText="Speciality" filterBy="#{bs.serviceSession.staff.speciality.name}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}">#{bs.serviceSession.staff.speciality.name}
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column headerText="Consultant" filterBy="#{bs.serviceSession.staff.person.nameWithTitle}" filterMatchMode="contains">

                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}">  #{bs.serviceSession.staff.person.nameWithTitle}
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column headerText="Session Name" filterBy="#{bs.serviceSession.name}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}">  #{bs.serviceSession.name}
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column headerText="No" filterBy="#{bs.serialNo}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}"> #{bs.serialNo}
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}"  value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column headerText="Patient Name" filterBy="#{bs.bill.patient.person.nameWithTitle}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}"> #{bs.bill.patient.person.nameWithTitle}
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column headerText="Paid or Not" filterBy="#{bs.bill.billType}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}"> <p:outputLabel rendered="#{bs.bill.billType eq 'ChannelCredit'}" value="Credit" style="color: red;"/>
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}"> <p:outputLabel rendered="#{bs.bill.billType eq 'ChannelPaid'}" value="Paid"/>
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column headerText="C/R" filterBy="#{bs.bill.billClass}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}">  <p:outputLabel value="Cancelled" rendered="#{bs.bill.cancelled==true}"/>
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}">  <p:outputLabel value="Refunded" rendered="#{bs.bill.refunded==true}"/>
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column>   
                            <p:column headerText="Agent" filterBy="#{bs.bill.fromInstitution.institutionCode}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}"> <p:outputLabel value="#{bs.bill.fromInstitution.institutionCode}"/>      
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column> 
                            <p:column headerText="Agent Ref No" filterBy="#{bs.billItem.agentRefNo}" filterMatchMode="contains">
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}"><p:outputLabel value="#{bs.billItem.agentRefNo}"/>     
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column> 
                            <p:column headerText="P/A" filterBy="#{bs.absent}" filterMatchMode="contains">                                      
                                <h:commandLink action="channel_booking" actionListener="#{bookingController.resetToStartFromSpeciality}"> <p:outputLabel value="Absent"  rendered="#{bs.absent}"/>  
                                    <f:setPropertyActionListener target="#{bookingController.speciality}" value="#{bs.serviceSession.staff.speciality}"/>
                                    <f:setPropertyActionListener target="#{bookingController.staff}" value="#{bs.serviceSession.staff}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession}" value="#{bs.serviceSession}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedBillSession}" value="#{bs}"/>
                                    <f:setPropertyActionListener target="#{bookingController.selectedServiceSession.sessionAt}" value="#{bs.sessionDate}"/>
                                </h:commandLink>
                            </p:column> 
                        </p:dataTable> 
                    </p:tab>


                    <p:tab title="Views">
                        <h:panelGrid columns="2">
                            <p:panel header="Selected Session">
                                <h:panelGrid columns="1">
                                    <p:commandButton value="Nurse View " 
                                                     action="#{bookingController.navigateToNurseView}" 
                                                     onclick="onSubmitButton();" >                                       
                                    </p:commandButton>
                                    <p:commandButton value="Doctor View " action="#{bookingController.navigateToDoctorView}" ajax="false" onclick="onSubmitButton();">                                        
                                    </p:commandButton>
                                    <p:commandButton value="Session View " action="#{bookingController.navigateToSessionView}" ajax="false" onclick="onSubmitButton();">                                        
                                    </p:commandButton>
                                    <p:commandButton value="Phone View " action="#{bookingController.navigateToPhoneView}" ajax="false" onclick="onSubmitButton();">                                        
                                    </p:commandButton>
                                    <p:commandButton value="User View " action="#{bookingController.navigateToUserView}" ajax="false" onclick="onSubmitButton();">                                        
                                    </p:commandButton>
                                </h:panelGrid>

                            </p:panel>
                            <p:panel header="Today's">
                                <h:panelGrid columns="1">
                                    <p:commandButton value="All Patient" action="channel_patient_view_today" ajax="false" onclick="onSubmitButton();">                                        
                                    </p:commandButton>
                                    <p:commandButton value="All Doctor" action="channel_doctor_view_today" ajax="false" onclick="onSubmitButton();">                                        
                                    </p:commandButton>
                                </h:panelGrid>                                    
                            </p:panel>
                        </h:panelGrid>

                    </p:tab>
                    <p:tab title="Doctor Payment">
                        <p:panel header="Selected Session">
                            <h:panelGrid columns="1">
                                <p:commandButton value="Pay Selected Doctor" action="#{bookingController.paySelectedDoctor}" 
                                                 ajax="false" onclick="onSubmitButton();" />                                        
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>

                    <p:tab title="Reshedule">
                        <p:panel>
                            <f:facet name="header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h:outputLabel value="Reshedule"/>
                                    <p:commandButton value="Reshedule" action="#{bookingController.sessionReschedule()}" ajax="false" >
                                    </p:commandButton>
                                </div>
                            </f:facet>
                            <h:panelGroup>
                                <div class="row">
                                    <div class="col-6">
                                        <p:panel header="Patient Details">
                                            <ezcommon:patient patient="#{bookingController.selectedBillSession.bill.patient}" ></ezcommon:patient>
                                        </p:panel>
                                    </div>
                                    <div class="col-6">
                                        <p:panel header="Other Sessions">
                                            <p:commandButton id="btnFill" class="m-1" value="FIll" action="#{bookingController.fillSessionInstanceByDoctor()}" process="btnFill" update="lstSelect" />
                                            <h:panelGroup id="lstSelect">
                                                <p:dataTable value="#{bookingController.sessionInstanceByDoctor}" var="myItem" selection="#{bookingController.selectedSessionInstanceForRechedule}" selectionMode="single"  rowKey="#{myItem.id}">
                                                    <p:column>
                                                        <f:facet name="header">Name</f:facet>
                                                            #{myItem.name}
                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="header">Consultant</f:facet>
                                                        <p:outputLabel value="#{myItem.staff.name}">
                                                            <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                        </p:outputLabel>

                                                    </p:column>
                                                    <p:column filterBy="#{myItem.sessionDate}" filterMatchMode="contains">
                                                        <f:facet name="header">Session Date</f:facet>
                                                        <p:outputLabel value="#{myItem.sessionDate}">
                                                            <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                        </p:outputLabel>

                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="header">Session TIme</f:facet>
                                                        <p:outputLabel value="#{myItem.startingTime}">
                                                            <f:convertDateTime pattern="HH:mm a"/>
                                                        </p:outputLabel>
                                                    </p:column>
                                                </p:dataTable>

                                            </h:panelGroup>
                                        </p:panel>
                                    </div>
                                </div>
                            </h:panelGroup>
                        </p:panel>
                    </p:tab>
                </p:tabView>
            </p:panel>

        </h:form>
    </ui:define>
</ui:composition>