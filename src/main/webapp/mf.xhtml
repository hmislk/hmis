<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp">
    <h:head>
        <title>Add Missing Fields</title>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"></link>
    </h:head>
    <h:body>

        <!-- Migration pending: open to everyone -->
        <h:panelGroup rendered="#{applicationController.databaseMigrationPending}">

            <div class="container mt-3">
                <div class="alert alert-warning" role="alert">
                    <strong>Database Migration Pending</strong> â€”
                    Please check for missing fields and run the migration below, then mark it as complete.
                </div>
            </div>

            <ez:midding_data_fields/>

            <div class="container mt-3 mb-5">
                <h:form id="migrationControlForm">
                    <p:commandButton value="Mark Migration as Complete"
                                     action="#{dataAdministrationController.markMigrationComplete()}"
                                     ajax="false"
                                     styleClass="btn btn-success me-2"/>
                    <p:commandButton value="Mark as Not Necessary"
                                     action="#{dataAdministrationController.markMigrationNotNecessary()}"
                                     ajax="false"
                                     styleClass="btn btn-secondary"/>
                </h:form>
            </div>

        </h:panelGroup>

        <!-- Not migration pending: admin only -->
        <h:panelGroup rendered="#{not applicationController.databaseMigrationPending}">

            <h:panelGroup rendered="#{webUserController.hasPrivilege('Admin')}">
                <ez:midding_data_fields/>
            </h:panelGroup>

            <h:panelGroup rendered="#{not webUserController.hasPrivilege('Admin')}">
                <div class="container mt-5">
                    <div class="alert alert-danger text-center" role="alert">
                        <h4 class="alert-heading">Access Denied</h4>
                        <p>This page is restricted to administrators. No database migration is currently pending.</p>
                    </div>
                </div>
            </h:panelGroup>

        </h:panelGroup>

        <p:growl id="growl" showDetail="true" life="3000"/>

    </h:body>
</html>
