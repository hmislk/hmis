<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:autocomplete="http://xmlns.jcp.org/jsf/composite/autocomplete">

    <h:body>

        <ui:composition template="/emr/admin/index.xhtml">

            <ui:define name="subcontent">

                <h:form >
                    <p:panel>
                        <f:facet name="header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h:outputText value="Manage Favourite Medicines By Age" />
                                <div>
                                    <p:commandButton value="Add New"
                                                     styleClass="ui-button-success ui-button-sm mr-2"
                                                     icon="fas fa-plus"
                                                     process="@this"
                                                     update="dlgFavioriteMedicines"
                                                     oncomplete="PF('dlg2').show()"
                                                     action="#{favouriteController.prepareAddingFavouriteItem()}" />
                                    <p:commandButton value="Fill"
                                                     styleClass="ui-button-info ui-button-sm"
                                                     icon="fas fa-fill-drip"
                                                     action="#{favouriteController.fillFavouriteMedicines()}"
                                                     update="favouriteTable">
                                        <f:setPropertyActionListener target="#{favouriteController.item}" value="#{favouriteController.item}" />
                                    </p:commandButton>
                                </div>
                            </div>
                        </f:facet>

                        <!-- Compact Filter Section -->
                        <div class="card mb-3">
                            <div class="card-body py-3">
                                <div class="row align-items-end">
                                    <div class="col-md-8">
                                        <h6 class="mb-2">Medicine Type Filter</h6>
                                        <div class="d-flex flex-wrap mb-2" style="gap: 0.5rem;">
                                            <p:selectBooleanButton id="vtmToggle"
                                                                   value="#{favouriteController.includeVtm}"
                                                                   onLabel="VTM"
                                                                   offLabel="VTM"
                                                                   styleClass="ui-button-sm">
                                                <p:ajax update="acItem,noTypesWarning,typeStatusText" event="change" />
                                            </p:selectBooleanButton>
                                            <p:selectBooleanButton id="atmToggle"
                                                                   value="#{favouriteController.includeAtm}"
                                                                   onLabel="ATM"
                                                                   offLabel="ATM"
                                                                   styleClass="ui-button-sm">
                                                <p:ajax update="acItem,noTypesWarning,typeStatusText" event="change" />
                                            </p:selectBooleanButton>
                                            <p:selectBooleanButton id="vmpToggle"
                                                                   value="#{favouriteController.includeVmp}"
                                                                   onLabel="VMP"
                                                                   offLabel="VMP"
                                                                   styleClass="ui-button-sm">
                                                <p:ajax update="acItem,noTypesWarning,typeStatusText" event="change" />
                                            </p:selectBooleanButton>
                                            <p:selectBooleanButton id="ampToggle"
                                                                   value="#{favouriteController.includeAmp}"
                                                                   onLabel="AMP"
                                                                   offLabel="AMP"
                                                                   styleClass="ui-button-sm">
                                                <p:ajax update="acItem,noTypesWarning,typeStatusText" event="change" />
                                            </p:selectBooleanButton>
                                        </div>
                                        <small id="typeStatusText" class="text-muted">#{favouriteController.selectedMedicineTypesText}</small>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="d-flex" style="gap: 0.5rem;">
                                            <p:commandButton value="All"
                                                             action="#{favouriteController.selectAllMedicineTypes}"
                                                             update="vtmToggle,atmToggle,vmpToggle,ampToggle,acItem,noTypesWarning,typeStatusText"
                                                             styleClass="ui-button-sm ui-button-outlined" />
                                            <p:commandButton value="None"
                                                             action="#{favouriteController.deselectAllMedicineTypes}"
                                                             update="vtmToggle,atmToggle,vmpToggle,ampToggle,acItem,noTypesWarning,typeStatusText"
                                                             styleClass="ui-button-sm ui-button-outlined" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Warning message -->
                                <p:panel id="noTypesWarning"
                                         styleClass="ui-panel-warning mt-2 mb-0"
                                         rendered="#{not favouriteController.includeVtm and not favouriteController.includeAtm and not favouriteController.includeVmp and not favouriteController.includeAmp}">
                                    <strong>Please select at least one medicine type to search.</strong>
                                </p:panel>

                                <div class="mt-3">
                                    <label class="form-label font-weight-bold">Select Medicine</label>
                                    <p:autoComplete id="acItem"
                                                    value="#{favouriteController.item}"
                                                    forceSelection="true"
                                                    styleClass="w-100"
                                                    inputStyleClass="w-100"
                                                    completeMethod="#{favouriteController.completeMedicineWithTypeFilter}"
                                                    var="vt" itemLabel="#{vt.name}" itemValue="#{vt}" >
                                        <p:column headerText="Item" >
                                            <h:outputLabel value="#{vt.name}"></h:outputLabel>
                                        </p:column>
                                        <p:ajax event="itemSelect" process="@this" update="tab"
                                                listener="#{favouriteController.onItemSelected}" />
                                    </p:autoComplete>
                                </div>
                            </div>
                        </div>
                        <p:dialog
                            id="dlgFavioriteMedicines"
                            header="Add Favourite Medicine" widgetVar="dlg2" modal="true" width="600px" responsive="true">
                            <h:panelGrid id="tab" columns="2" styleClass="w-100 p-3" columnClasses="p-2,p-2">

                                <!-- Medicine Information Section -->
                                <p:outputLabel value="Selected Medicine:" styleClass="font-weight-bold" />
                                <h:outputText value="#{favouriteController.item.name}" styleClass="text-primary font-weight-bold" />

                                <!-- AMP/VMP Information Section -->
                                <h:panelGroup rendered="#{favouriteController.selectedItemAmpOrVmp}">
                                    <p:outputLabel value="Medicine Type:" styleClass="font-weight-bold" />

                                </h:panelGroup>
                                <h:panelGroup rendered="#{favouriteController.selectedItemAmpOrVmp}">
                                    <h:panelGroup styleClass="bg-info text-white p-2 rounded w-100">
                                        <h:outputText value="#{favouriteController.item.medicineType}" styleClass="font-weight-bold" />
                                        <h:outputText value=" - Properties are read-only (taken from medicine definition)" styleClass="small" />
                                    </h:panelGroup>
                                </h:panelGroup>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Age Range Section -->
                                <p:outputLabel value="From Age:" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <h:panelGroup layout="block" styleClass="d-flex align-items-center mb-2" style="gap: 0.5rem;">
                                        <h:panelGroup>
                                            <p:inputNumber id="fromYears" value="#{favouriteController.fromYears}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="120"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateFromDays()}" update="fromTotalDays" />
                                            </p:inputNumber>
                                            <h:outputText value=" Years" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputNumber id="fromMonths" value="#{favouriteController.fromMonths}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="11"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateFromDays()}" update="fromTotalDays" />
                                            </p:inputNumber>
                                            <h:outputText value=" Months" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputNumber id="fromDaysComp" value="#{favouriteController.fromDaysComponent}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="29"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateFromDays()}" update="fromTotalDays" />
                                            </p:inputNumber>
                                            <h:outputText value=" Days" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                    <h:panelGroup id="fromTotalDays" layout="block" styleClass="text-info small mt-1">
                                        <h:outputText value="Total: " />
                                        <h:outputText value="#{favouriteController.current.fromDays}" styleClass="font-weight-bold">
                                            <f:convertNumber pattern="0" />
                                        </h:outputText>
                                        <h:outputText value=" days" />
                                    </h:panelGroup>
                                </h:panelGroup>

                                <p:outputLabel value="To Age:" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <h:panelGroup layout="block" styleClass="d-flex align-items-center mb-2" style="gap: 0.5rem;">
                                        <h:panelGroup>
                                            <p:inputNumber id="toYears" value="#{favouriteController.toYears}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="120"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateToDays()}" update="toTotalDays" />
                                            </p:inputNumber>
                                            <h:outputText value=" Years" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputNumber id="toMonths" value="#{favouriteController.toMonths}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="11"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateToDays()}" update="toTotalDays" />
                                            </p:inputNumber>
                                            <h:outputText value=" Months" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputNumber id="toDaysComp" value="#{favouriteController.toDaysComponent}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="29"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateToDays()}" update="toTotalDays" />
                                            </p:inputNumber>
                                            <h:outputText value=" Days" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                    <h:panelGroup id="toTotalDays" layout="block" styleClass="text-info small mt-1">
                                        <h:outputText value=" Total: " />
                                        <h:outputText value="#{favouriteController.current.toDays}" styleClass="font-weight-bold">
                                            <f:convertNumber pattern="0" />
                                        </h:outputText>
                                        <h:outputText value=" days" />
                                    </h:panelGroup>
                                </h:panelGroup>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Category Section -->
                                <p:outputLabel value="Medicine Category:" for="category" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <!-- Read-only display for AMP/VMP -->
                                    <h:outputText value="#{favouriteController.current.category.name}"
                                                  styleClass="w-100 form-control-plaintext text-muted"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.category != null}" />
                                    <h:outputText value="Not specified from selected medicine"
                                                  styleClass="w-100 form-control-plaintext text-muted font-italic"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.category == null}" />

                                    <!-- Editable dropdown for other types -->
                                    <p:selectOneMenu id="category" value="#{favouriteController.current.category}"
                                                     styleClass="w-100" autoWidth="false"
                                                     rendered="#{not favouriteController.selectedItemAmpOrVmp}">
                                        <f:selectItem itemLabel="Select Category" />
                                        <f:selectItems value="#{pharmaceuticalItemCategoryController.items}"
                                                       var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Dosage Section -->
                                <p:outputLabel value="Dose:" for="dose" styleClass="font-weight-bold" />
                                <p:inputText id="dose" value="#{favouriteController.current.dose}"
                                             styleClass="w-100" placeholder="Enter dose amount" />

                                <p:outputLabel value="Dose Unit:" for="doseUnit" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <!-- Read-only display for AMP/VMP -->
                                    <h:outputText value="#{favouriteController.current.doseUnit.name}"
                                                  styleClass="w-100 form-control-plaintext text-muted"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.doseUnit != null}" />
                                    <h:outputText value="Not specified from selected medicine"
                                                  styleClass="w-100 form-control-plaintext text-muted font-italic"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.doseUnit == null}" />

                                    <!-- Editable dropdown for other types -->
                                    <p:selectOneMenu id="doseUnit" value="#{favouriteController.current.doseUnit}"
                                                     styleClass="w-100" autoWidth="false"
                                                     rendered="#{not favouriteController.selectedItemAmpOrVmp}">
                                        <f:selectItem itemLabel="Select Dose Unit" />
                                        <f:selectItems value="#{measurementUnitController.items}"
                                                       var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Frequency Section -->
                                <p:outputLabel value="Frequency:" for="frequency" styleClass="font-weight-bold" />
                                <p:selectOneMenu id="frequency" value="#{favouriteController.current.frequencyUnit}"
                                                 styleClass="w-100" autoWidth="false">
                                    <f:selectItem itemLabel="Select Frequency" />
                                    <f:selectItems value="#{measurementUnitController.frequencyUnits}"
                                                   var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                </p:selectOneMenu>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Duration Section -->
                                <p:outputLabel value="Duration:" for="duration" styleClass="font-weight-bold" />
                                <p:inputText id="duration" value="#{favouriteController.current.duration}"
                                             styleClass="w-100" placeholder="Enter duration" />

                                <p:outputLabel value="Duration Unit:" for="durationUnit" styleClass="font-weight-bold" />
                                <p:selectOneMenu id="durationUnit" value="#{favouriteController.current.durationUnit}"
                                                 styleClass="w-100" autoWidth="false">
                                    <f:selectItem itemLabel="Select Duration Unit" />
                                    <f:selectItems value="#{measurementUnitController.durationUnits}"
                                                   var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                </p:selectOneMenu>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Issue Quantity Section -->
                                <p:outputLabel value="Issue Quantity:" for="issueQty" styleClass="font-weight-bold" />
                                <p:inputText id="issueQty" value="#{favouriteController.current.issue}"
                                             styleClass="w-100" placeholder="Enter quantity to issue" />

                                <p:outputLabel value="Issue Unit:" for="issueUnit" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <!-- Read-only display for AMP/VMP -->
                                    <h:outputText value="#{favouriteController.current.issueUnit.name}"
                                                  styleClass="w-100 form-control-plaintext text-muted"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.issueUnit != null}" />
                                    <h:outputText value="Not specified from selected medicine"
                                                  styleClass="w-100 form-control-plaintext text-muted font-italic"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.issueUnit == null}" />

                                    <!-- Editable dropdown for other types -->
                                    <p:selectOneMenu id="issueUnit" value="#{favouriteController.current.issueUnit}"
                                                     styleClass="w-100" autoWidth="false"
                                                     rendered="#{not favouriteController.selectedItemAmpOrVmp}">
                                        <f:selectItem itemLabel="Select Issue Unit" />
                                        <f:selectItems value="#{measurementUnitController.issueUnits}"
                                                       var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>

                            </h:panelGrid>
                            <f:facet name="footer">
                                <p:commandButton styleClass="ui-button-success" ajax="false"
                                                 icon="fas fa-save" value="Save Favourite Medicine"
                                                 action="#{favouriteController.saveFavMedicine}" />
                                <p:commandButton styleClass="ui-button-secondary ml-2"
                                                 icon="fas fa-times" value="Cancel"
                                                 onclick="PF('dlg2').hide(); return false;" />
                            </f:facet>
                        </p:dialog>

                        <!-- Edit Dialog -->
                        <p:dialog
                            id="dlgEditFavioriteMedicines"
                            header="Edit Favourite Medicine" widgetVar="dlgEdit" modal="true" width="600px" responsive="true"
                            styleClass="edit-dialog">
                            <h:panelGrid id="tabEdit" columns="2" styleClass="w-100 p-3" columnClasses="p-2,p-2">

                                <!-- Medicine Information Section -->
                                <p:outputLabel value="Selected Medicine:" styleClass="font-weight-bold" />
                                <h:outputText value="#{favouriteController.current.forItem.name}" styleClass="text-primary font-weight-bold" />

                                <!-- AMP/VMP Information Section -->
                                <h:panelGroup rendered="#{favouriteController.selectedItemAmpOrVmp}">
                                    <p:outputLabel value="Medicine Type:" styleClass="font-weight-bold" />
                                </h:panelGroup>

                                <h:panelGroup rendered="#{favouriteController.selectedItemAmpOrVmp}">
                                    <h:panelGroup styleClass="bg-info text-white p-2 rounded w-100">
                                        <h:outputText value="#{favouriteController.current.forItem.medicineType}" styleClass="font-weight-bold" />
                                        <h:outputText value=" - Properties are read-only (taken from medicine definition)" styleClass="small" />
                                    </h:panelGroup>
                                </h:panelGroup>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Age Range Section -->
                                <p:outputLabel value="From Age:" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <h:panelGroup layout="block" styleClass="d-flex align-items-center mb-2" style="gap: 0.5rem;">
                                        <h:panelGroup>
                                            <p:inputNumber id="fromYearsEdit" value="#{favouriteController.fromYears}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="120"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateFromDays()}" update="fromTotalDaysEdit" />
                                            </p:inputNumber>
                                            <h:outputText value=" Years" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputNumber id="fromMonthsEdit" value="#{favouriteController.fromMonths}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="11"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateFromDays()}" update="fromTotalDaysEdit" />
                                            </p:inputNumber>
                                            <h:outputText value=" Months" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputNumber id="fromDaysCompEdit" value="#{favouriteController.fromDaysComponent}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="29"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateFromDays()}" update="fromTotalDaysEdit" />
                                            </p:inputNumber>
                                            <h:outputText value=" Days" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                    <h:panelGroup id="fromTotalDaysEdit" layout="block" styleClass="text-info small mt-1">
                                        <h:outputText value=" Total: " />
                                        <h:outputText value="#{favouriteController.current.fromDays}" styleClass="font-weight-bold">
                                            <f:convertNumber pattern="0" />
                                        </h:outputText>
                                        <h:outputText value=" days" />
                                    </h:panelGroup>
                                </h:panelGroup>

                                <p:outputLabel value="To Age:" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <h:panelGroup layout="block" styleClass="d-flex align-items-center mb-2" style="gap: 0.5rem;">
                                        <h:panelGroup>
                                            <p:inputNumber id="toYearsEdit" value="#{favouriteController.toYears}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="120"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateToDays()}" update="toTotalDaysEdit" />
                                            </p:inputNumber>
                                            <h:outputText value=" Years" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputNumber id="toMonthsEdit" value="#{favouriteController.toMonths}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="11"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateToDays()}" update="toTotalDaysEdit" />
                                            </p:inputNumber>
                                            <h:outputText value=" Months" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputNumber id="toDaysCompEdit" value="#{favouriteController.toDaysComponent}"
                                                           styleClass="w-100" placeholder="0" minValue="0" maxValue="29"
                                                           decimalPlaces="0" inputStyle="width: 60px; text-align: center;">
                                                <p:ajax event="change" listener="#{favouriteController.calculateToDays()}" update="toTotalDaysEdit" />
                                            </p:inputNumber>
                                            <h:outputText value=" Days" styleClass="text-muted small ml-1" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                    <h:panelGroup id="toTotalDaysEdit" layout="block" styleClass="text-info small mt-1">
                                        <h:outputText value=" Total: " />
                                        <h:outputText value="#{favouriteController.current.toDays}" styleClass="font-weight-bold">
                                            <f:convertNumber pattern="0" />
                                        </h:outputText>
                                        <h:outputText value=" days" />
                                    </h:panelGroup>
                                </h:panelGroup>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Category Section -->
                                <p:outputLabel value="Medicine Category:" for="categoryEdit" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <!-- Read-only display for AMP/VMP -->
                                    <h:outputText value="#{favouriteController.current.category.name}"
                                                  styleClass="w-100 form-control-plaintext text-muted"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.category != null}" />
                                    <h:outputText value="Not specified from selected medicine"
                                                  styleClass="w-100 form-control-plaintext text-muted font-italic"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.category == null}" />

                                    <!-- Editable dropdown for other types -->
                                    <p:selectOneMenu id="categoryEdit" value="#{favouriteController.current.category}"
                                                     styleClass="w-100" autoWidth="false"
                                                     rendered="#{not favouriteController.selectedItemAmpOrVmp}">
                                        <f:selectItem itemLabel="Select Category" />
                                        <f:selectItems value="#{pharmaceuticalItemCategoryController.items}"
                                                       var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Dosage Section -->
                                <p:outputLabel value="Dose:" for="doseEdit" styleClass="font-weight-bold" />
                                <p:inputText id="doseEdit" value="#{favouriteController.current.dose}"
                                             styleClass="w-100" placeholder="Enter dose amount" />

                                <p:outputLabel value="Dose Unit:" for="doseUnitEdit" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <!-- Read-only display for AMP/VMP -->
                                    <h:outputText value="#{favouriteController.current.doseUnit.name}"
                                                  styleClass="w-100 form-control-plaintext text-muted"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.doseUnit != null}" />
                                    <h:outputText value="Not specified from selected medicine"
                                                  styleClass="w-100 form-control-plaintext text-muted font-italic"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.doseUnit == null}" />

                                    <!-- Editable dropdown for other types -->
                                    <p:selectOneMenu id="doseUnitEdit" value="#{favouriteController.current.doseUnit}"
                                                     styleClass="w-100" autoWidth="false"
                                                     rendered="#{not favouriteController.selectedItemAmpOrVmp}">
                                        <f:selectItem itemLabel="Select Dose Unit" />
                                        <f:selectItems value="#{measurementUnitController.items}"
                                                       var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Frequency Section -->
                                <p:outputLabel value="Frequency:" for="frequencyEdit" styleClass="font-weight-bold" />
                                <p:selectOneMenu id="frequencyEdit" value="#{favouriteController.current.frequencyUnit}"
                                                 styleClass="w-100" autoWidth="false">
                                    <f:selectItem itemLabel="Select Frequency" />
                                    <f:selectItems value="#{measurementUnitController.frequencyUnits}"
                                                   var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                </p:selectOneMenu>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Duration Section -->
                                <p:outputLabel value="Duration:" for="durationEdit" styleClass="font-weight-bold" />
                                <p:inputText id="durationEdit" value="#{favouriteController.current.duration}"
                                             styleClass="w-100" placeholder="Enter duration" />

                                <p:outputLabel value="Duration Unit:" for="durationUnitEdit" styleClass="font-weight-bold" />
                                <p:selectOneMenu id="durationUnitEdit" value="#{favouriteController.current.durationUnit}"
                                                 styleClass="w-100" autoWidth="false">
                                    <f:selectItem itemLabel="Select Duration Unit" />
                                    <f:selectItems value="#{measurementUnitController.durationUnits}"
                                                   var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                </p:selectOneMenu>

                                <!-- Section Separator -->
                                <h:outputText value="" styleClass="d-block mt-3" />
                                <h:outputText value="" styleClass="d-block mt-3" />

                                <!-- Issue Quantity Section -->
                                <p:outputLabel value="Issue Quantity:" for="issueQtyEdit" styleClass="font-weight-bold" />
                                <p:inputText id="issueQtyEdit" value="#{favouriteController.current.issue}"
                                             styleClass="w-100" placeholder="Enter quantity to issue" />

                                <p:outputLabel value="Issue Unit:" for="issueUnitEdit" styleClass="font-weight-bold" />
                                <h:panelGroup>
                                    <!-- Read-only display for AMP/VMP -->
                                    <h:outputText value="#{favouriteController.current.issueUnit.name}"
                                                  styleClass="w-100 form-control-plaintext text-muted"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.issueUnit != null}" />
                                    <h:outputText value="Not specified from selected medicine"
                                                  styleClass="w-100 form-control-plaintext text-muted font-italic"
                                                  rendered="#{favouriteController.selectedItemAmpOrVmp and favouriteController.current.issueUnit == null}" />

                                    <!-- Editable dropdown for other types -->
                                    <p:selectOneMenu id="issueUnitEdit" value="#{favouriteController.current.issueUnit}"
                                                     styleClass="w-100" autoWidth="false"
                                                     rendered="#{not favouriteController.selectedItemAmpOrVmp}">
                                        <f:selectItem itemLabel="Select Issue Unit" />
                                        <f:selectItems value="#{measurementUnitController.issueUnits}"
                                                       var="myItem" itemValue="#{myItem}" itemLabel="#{myItem.name}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>

                            </h:panelGrid>
                            <f:facet name="footer">
                                <p:commandButton styleClass="ui-button-warning"
                                                 icon="fas fa-save" value="Update Favourite Medicine"
                                                 action="#{favouriteController.updateFavMedicine}"
                                                 update="favouriteTable"
                                                 oncomplete="PF('dlgEdit').hide();" />
                                <p:commandButton styleClass="ui-button-secondary ml-2"
                                                 icon="fas fa-times" value="Cancel"
                                                 onclick="PF('dlgEdit').hide(); return false;" />
                            </f:facet>
                        </p:dialog>

                        <p:dataTable id="favouriteTable" value="#{favouriteController.items}" var="fi" styleClass="w-100 table-striped" paginator="true" rows="15" sortBy="#{fi.createdAt}">
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="From Age" />
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{fi.fromDays}" styleClass="font-weight-bold">
                                        <f:convertNumber pattern="0.#" />
                                    </h:outputText>
                                    <h:outputText value=" days" styleClass="text-muted" />
                                    <h:outputText value=" (" styleClass="text-muted small"
                                                  rendered="#{fi.fromDays >= 30}" />
                                    <h:outputText value="#{fi.fromDays / 365}" styleClass="text-muted small"
                                                  rendered="#{fi.fromDays >= 365}">
                                        <f:convertNumber pattern="0.0" />
                                    </h:outputText>
                                    <h:outputText value=" yrs" styleClass="text-muted small"
                                                  rendered="#{fi.fromDays >= 365}" />
                                    <h:outputText value="#{fi.fromDays / 30}" styleClass="text-muted small"
                                                  rendered="#{fi.fromDays >= 30 and fi.fromDays &lt; 365}">
                                        <f:convertNumber pattern="0.0" />
                                    </h:outputText>
                                    <h:outputText value=" mos" styleClass="text-muted small"
                                                  rendered="#{fi.fromDays >= 30 and fi.fromDays &lt; 365}" />
                                    <h:outputText value=")" styleClass="text-muted small"
                                                  rendered="#{fi.fromDays >= 30}" />
                                </h:panelGroup>
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="To Age" />
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{fi.toDays}" styleClass="font-weight-bold">
                                        <f:convertNumber pattern="0.#" />
                                    </h:outputText>
                                    <h:outputText value=" days" styleClass="text-muted" />
                                    <h:outputText value=" (" styleClass="text-muted small"
                                                  rendered="#{fi.toDays >= 30}" />
                                    <h:outputText value="#{fi.toDays / 365}" styleClass="text-muted small"
                                                  rendered="#{fi.toDays >= 365}">
                                        <f:convertNumber pattern="0.0" />
                                    </h:outputText>
                                    <h:outputText value=" yrs" styleClass="text-muted small"
                                                  rendered="#{fi.toDays >= 365}" />
                                    <h:outputText value="#{fi.toDays / 30}" styleClass="text-muted small"
                                                  rendered="#{fi.toDays >= 30 and fi.toDays &lt; 365}">
                                        <f:convertNumber pattern="0.0" />
                                    </h:outputText>
                                    <h:outputText value=" mos" styleClass="text-muted small"
                                                  rendered="#{fi.toDays >= 30 and fi.toDays &lt; 365}" />
                                    <h:outputText value=")" styleClass="text-muted small"
                                                  rendered="#{fi.toDays >= 30}" />
                                </h:panelGroup>
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Medicine" />
                                </f:facet>
                                <h:outputText value="#{fi.item.name}" styleClass="font-weight-bold text-primary" />
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Category" />
                                </f:facet>
                                <h:outputText value="#{fi.category}" />
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Dosage" />
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{fi.dose}">
                                        <f:convertNumber pattern="0.#" />
                                    </h:outputText>
                                    <h:outputText value=" " />
                                    <h:outputText value="#{fi.doseUnit.name}" styleClass="text-muted" />
                                </h:panelGroup>
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Frequency" />
                                </f:facet>
                                <h:outputText value="#{fi.frequencyUnit.name}" />
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Duration" />
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{fi.duration}">
                                        <f:convertNumber pattern="0.#" />
                                    </h:outputText>
                                    <h:outputText value=" " />
                                    <h:outputText value="#{fi.durationUnit.name}" styleClass="text-muted" />
                                </h:panelGroup>
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Issue Quantity" />
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{fi.issue}">
                                        <f:convertNumber pattern="0.#" />
                                    </h:outputText>
                                    <h:outputText value=" " />
                                    <h:outputText value="#{fi.issueUnit.name}" styleClass="text-muted" />
                                </h:panelGroup>
                            </p:column>

                            <p:column style="width: 100px; text-align: center;">
                                <f:facet name="header">
                                    <h:outputText value="Actions" />
                                </f:facet>
                                <h:panelGroup styleClass="d-flex justify-content-center" style="gap: 0.25rem;">
                                    <p:commandButton icon="fas fa-edit"
                                                     styleClass="ui-button-warning ui-button-sm"
                                                     title="Edit"
                                                     action="#{favouriteController.prepareEditFavouriteMedicine(fi)}"
                                                     oncomplete="PF('dlgEdit').show();"
                                                     update="@(.edit-dialog)">
                                        <f:setPropertyActionListener target="#{favouriteController.current}" value="#{fi}" />
                                    </p:commandButton>

                                    <p:commandButton icon="fas fa-trash"
                                                     styleClass="ui-button-danger ui-button-sm"
                                                     title="Delete"
                                                     action="#{favouriteController.removeFavouriteMedicine(fi)}"
                                                     update="favouriteTable"
                                                     onclick="return confirm('Are you sure you want to delete this favourite medicine?');">
                                        <f:setPropertyActionListener target="#{favouriteController.current}" value="#{fi}" />
                                    </p:commandButton>
                                </h:panelGroup>
                            </p:column>

                        </p:dataTable>

                    </p:panel>
                </h:form>
            </ui:define>

        </ui:composition>

    </h:body>
</html>
