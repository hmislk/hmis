name: Production Merge Validation

on:
  pull_request:
    types: [ opened, synchronize, reopened ]
    branches:
      - development

jobs:
  check-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Check source branch name
        run: |
          echo "Source branch: ${{ github.head_ref }}"
          echo "Target branch: ${{ github.base_ref }}"

          SOURCE="${{ github.head_ref }}"
          TARGET="${{ github.base_ref }}"

          if [[ "$TARGET" == *-prod ]]; then
            if [[ "$SOURCE" == *-dev || "$SOURCE" == *-stg || "$SOURCE" == "hims-qa1" || "$SOURCE" == "hims-qa2" || "$SOURCE" == "development" ]]; then
              echo "❌ Merging from $SOURCE to $TARGET is not allowed."
              exit 1
            fi
          fi

          echo "✅ Merge is allowed."
